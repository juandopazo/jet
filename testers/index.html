<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>New Web Project</title>
		<link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/2.8.1/build/fonts/fonts-min.css" />
		<style type="text/css">
			body {
				margin: 0;
				padding: 0;
			}
			
			.jet-spbar-container {
				display: inline-block;
				border: 1px solid #000;
				position: relative;
			}
			.jet-spbar-bar, .jet-spbar-text {
				position: absolute;
				top: 0px;
			}
			.jet-spbar-bar {
				left: 0px;
				width: 0%;
				background: url("http://yui.yahooapis.com/2.8.1/build/progressbar/assets/skins/sam/bar-h.png");
				z-index: 1;
			}
			.jet-spbar-text {
				width: 30px;
				right: -32px;
				text-align: center;
				z-index: 2;
				font-weight: bold;
			}
			.loading {
				background-image: url(ajax-loader.gif);
				background-position: center center;
				background-repeat: no-repeat;
				height: 80px;
			}
			
			.yui-dt-col-server .yui-dt-liner {
				text-align: center;
			}
		</style> 
    </head>
    <body>
    	<h1 style="display: none;">Últimas imágenes en Flickr</h1>
        <script type="text/javascript" src="http://jet-js.googlecode.com/svn/trunk/src/jet.js"></script>
        <script type="text/javascript">
        	jet({
				base: "http://jet-js.googlecode.com/svn/trunk/src"
			}).use('simple-progressbar', function ($) {
				
				var pbar = new $.SimpleProgressBar({
					text: true
				});
				pbar.render(document.body);
				
	            jet({
					base: "http://jet-js.googlecode.com/svn/trunk/src",
					onProgress: pbar.update
				}).use('container', 'datatable', 'imageloader', function ($) {
					
					$("div").hide();
					$("h1").show();
					
					var body = $(document.body).addClass("yui-skin-sam");
					
					var dataSource = new $.DataSource.Get({
						url: "http://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20flickr.photos.recent&format=json&diagnostics=true",
						jsonCallbackParam: "callback",
						responseType: $.DataSource.responseType.JSON,
						responseSchema: {
							resultList: "query.results.photo",
							fields: [
								{ key: "id" },
								{ key: "title" },
								{ key: "owner" },
								{ key: "server" },
								{ key: "secret" }
							]
						}
					});

					var button = new $.Button({
						text: "Update",
						on: {
							pressed: dataSource.sendRequest
						}
					});
					button.render($("<p/>").appendTo(body));
					
					var thumb = function (server, data, td) {
						td.addClass("loading");
						var img = new $.Image({
							src: 'http://farm5.static.flickr.com/' + server + "/" + data.id + "_" + data.secret + '_t.jpg',
							on: {
								load: function () {
									td.removeClass("loading").first().append(this.get("node"));
								}
							}
						});
						img.load();
						return '';
					};
					
					var dataTable = new $.DataTable({
						dataSource: dataSource,
						columnDefinitions: [
							{ key: "id", label: "Id", sortable: true },
							{ key: "title", label: "Titulo", sortable: true },
							{ key: "owner", label: "Dueño", sortable: true },
							{ key: "server", label: "Miniatura", formatter: thumb }
						]
					});
					dataTable.render(body);
					
					dataSource.on("update", dataTable.onDataReturnAddRows);
					
	            });
				
			});
        </script>
    </body>
</html>
