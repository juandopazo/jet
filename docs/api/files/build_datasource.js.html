<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Jet</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.3.0/build/cssgrids/grids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <script src="http://yui.yahooapis.com/3.3.0/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            <h1><a href="../index.html"><img src="../assets/css/jet.jpg">Jet</a></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.1.2</em>
        </div>
    </div>
    <div class="yui3-g">

        <div id="sidebar" class="yui3-u">
            <div id="modules" class="sidebox">
    <div class="hd">
        <h2 class="no-toc">Modules</h2>
    </div>
    <div class="bd">
        <ul>
            
                <li><a href="../modules/anim.html">anim</a>
                
                    <ul>
                        
                    </ul>
                
                </li>
            
                <li><a href="../modules/appview.html">appview</a>
                
                    <ul>
                        
                    </ul>
                
                </li>
            
                <li><a href="../modules/array-extras.html">array-extras</a>
                
                    <ul>
                        
                    </ul>
                
                </li>
            
                <li><a href="../modules/base.html">base</a>
                
                    <ul>
                        
                    </ul>
                
                </li>
            
                <li><a href="../modules/button.html">button</a>
                
                    <ul>
                        
                    </ul>
                
                </li>
            
                <li><a href="../modules/container.html">container</a>
                
                    <ul>
                        
                    </ul>
                
                </li>
            
                <li><a href="../modules/cookie.html">cookie</a>
                
                    <ul>
                        
                    </ul>
                
                </li>
            
                <li><a href="../modules/datasource.html">datasource</a>
                
                    <ul>
                        
                    </ul>
                
                </li>
            
                <li><a href="../modules/datatable.html">datatable</a>
                
                    <ul>
                        
                    </ul>
                
                </li>
            
                <li><a href="../modules/deferred.html">deferred</a>
                
                    <ul>
                        
                    </ul>
                
                </li>
            
                <li><a href="../modules/dragdrop.html">dragdrop</a>
                
                    <ul>
                        
                    </ul>
                
                </li>
            
                <li><a href="../modules/history.html">history</a>
                
                    <ul>
                        
                    </ul>
                
                </li>
            
                <li><a href="../modules/imageloader.html">imageloader</a>
                
                    <ul>
                        
                    </ul>
                
                </li>
            
                <li><a href="../modules/io.html">io</a>
                
                    <ul>
                        
                    </ul>
                
                </li>
            
                <li><a href="../modules/io-xdr.html">io-xdr</a>
                
                    <ul>
                        
                    </ul>
                
                </li>
            
                <li><a href="../modules/json.html">json</a>
                
                    <ul>
                        
                    </ul>
                
                </li>
            
                <li><a href="../modules/layout.html">layout</a>
                
                    <ul>
                        
                    </ul>
                
                </li>
            
                <li><a href="../modules/log.html">log</a>
                
                    <ul>
                        
                    </ul>
                
                </li>
            
                <li><a href="../modules/menu.html">menu</a>
                
                    <ul>
                        
                    </ul>
                
                </li>
            
                <li><a href="../modules/oop.html">oop</a>
                
                    <ul>
                        
                    </ul>
                
                </li>
            
                <li><a href="../modules/paginator.html">paginator</a>
                
                    <ul>
                        
                    </ul>
                
                </li>
            
                <li><a href="../modules/progressbar.html">progressbar</a>
                
                    <ul>
                        
                    </ul>
                
                </li>
            
                <li><a href="../modules/resize.html">resize</a>
                
                    <ul>
                        
                    </ul>
                
                </li>
            
                <li><a href="../modules/selector.html">selector</a>
                
                    <ul>
                        
                    </ul>
                
                </li>
            
                <li><a href="../modules/sizzle.html">sizzle</a>
                
                    <ul>
                        
                    </ul>
                
                </li>
            
                <li><a href="../modules/swf.html">swf</a>
                
                    <ul>
                        
                    </ul>
                
                </li>
            
                <li><a href="../modules/tabview.html">tabview</a>
                
                    <ul>
                        
                    </ul>
                
                </li>
            
                <li><a href="../modules/touch.html">touch</a>
                
                    <ul>
                        
                    </ul>
                
                </li>
            
                <li><a href="../modules/transition.html">transition</a>
                
                    <ul>
                        
                    </ul>
                
                </li>
            
                <li><a href="../modules/treeview.html">treeview</a>
                
                    <ul>
                        
                    </ul>
                
                </li>
            
                <li><a href="../modules/vector.html">vector</a>
                
                    <ul>
                        
                    </ul>
                
                </li>
            
                <li><a href="../modules/widget-alignment.html">widget-alignment</a>
                
                    <ul>
                        
                    </ul>
                
                </li>
            
                <li><a href="../modules/widget-parentchild.html">widget-parentchild</a>
                
                    <ul>
                        
                    </ul>
                
                </li>
            
                <li><a href="../modules/widget-sandbox.html">widget-sandbox</a>
                
                    <ul>
                        
                    </ul>
                
                </li>
            
                <li><a href="../modules/widget-stack.html">widget-stack</a>
                
                    <ul>
                        
                    </ul>
                
                </li>
            
        </ul>
    </div>
</div>

<div id="classes" class="sidebox">
    <div class="hd">
        <h2 class="no-toc">Classes</h2>
    </div>
    <div class="bd">
        <ul>
            
                <li><a href="../classes/AppView.html">AppView</a></li>
            
                <li><a href="../classes/Attribute.html">Attribute</a></li>
            
                <li><a href="../classes/Base.html">Base</a></li>
            
                <li><a href="../classes/BuiltClass.html">BuiltClass</a></li>
            
                <li><a href="../classes/Button.html">Button</a></li>
            
                <li><a href="../classes/ButtonGroup.html">ButtonGroup</a></li>
            
                <li><a href="../classes/Cell.html">Cell</a></li>
            
                <li><a href="../classes/CheckBox.html">CheckBox</a></li>
            
                <li><a href="../classes/CheckBoxGroup.html">CheckBoxGroup</a></li>
            
                <li><a href="../classes/Class.html">Class</a></li>
            
                <li><a href="../classes/Column.html">Column</a></li>
            
                <li><a href="../classes/ComboBox.html">ComboBox</a></li>
            
                <li><a href="../classes/ComboOption.html">ComboOption</a></li>
            
                <li><a href="../classes/Cookie.html">Cookie</a></li>
            
                <li><a href="../classes/DataSource.html">DataSource</a></li>
            
                <li><a href="../classes/DataSource.Ajax.html">DataSource.Ajax</a></li>
            
                <li><a href="../classes/DataSource.Get.html">DataSource.Get</a></li>
            
                <li><a href="../classes/DataSource.Local.html">DataSource.Local</a></li>
            
                <li><a href="../classes/DataSource.XDR.html">DataSource.XDR</a></li>
            
                <li><a href="../classes/DataTable.html">DataTable</a></li>
            
                <li><a href="../classes/Drag.html">Drag</a></li>
            
                <li><a href="../classes/DragDrop.html">DragDrop</a></li>
            
                <li><a href="../classes/Easing.html">Easing</a></li>
            
                <li><a href="../classes/EventFacade.html">EventFacade</a></li>
            
                <li><a href="../classes/EventTarget.html">EventTarget</a></li>
            
                <li><a href="../classes/FanLoader.html">FanLoader</a></li>
            
                <li><a href="../classes/Frame.html">Frame</a></li>
            
                <li><a href="../classes/History.html">History</a></li>
            
                <li><a href="../classes/Image.html">Image</a></li>
            
                <li><a href="../classes/ImageLoader.html">ImageLoader</a></li>
            
                <li><a href="../classes/IO.html">IO</a></li>
            
                <li><a href="../classes/jet~deferred.html">jet~deferred</a></li>
            
                <li><a href="../classes/JSON.html">JSON</a></li>
            
                <li><a href="../classes/Layout.html">Layout</a></li>
            
                <li><a href="../classes/LayoutPanel.html">LayoutPanel</a></li>
            
                <li><a href="../classes/LayoutPanelBase.html">LayoutPanelBase</a></li>
            
                <li><a href="../classes/Log.html">Log</a></li>
            
                <li><a href="../classes/Module.html">Module</a></li>
            
                <li><a href="../classes/Mouse.html">Mouse</a></li>
            
                <li><a href="../classes/NodeList.html">NodeList</a></li>
            
                <li><a href="../classes/Overlay.html">Overlay</a></li>
            
                <li><a href="../classes/Page.html">Page</a></li>
            
                <li><a href="../classes/Paginator.html">Paginator</a></li>
            
                <li><a href="../classes/Panel.html">Panel</a></li>
            
                <li><a href="../classes/PanelBase.html">PanelBase</a></li>
            
                <li><a href="../classes/ProgressBar.html">ProgressBar</a></li>
            
                <li><a href="../classes/Promise.html">Promise</a></li>
            
                <li><a href="../classes/RadioButton.html">RadioButton</a></li>
            
                <li><a href="../classes/RadioGroup.html">RadioGroup</a></li>
            
                <li><a href="../classes/Record.html">Record</a></li>
            
                <li><a href="../classes/RecordSet.html">RecordSet</a></li>
            
                <li><a href="../classes/Resize.html">Resize</a></li>
            
                <li><a href="../classes/Sandbox.html">Sandbox</a></li>
            
                <li><a href="../classes/Scrollable.html">Scrollable</a></li>
            
                <li><a href="../classes/SimpleDialog.html">SimpleDialog</a></li>
            
                <li><a href="../classes/StaticPanel.html">StaticPanel</a></li>
            
                <li><a href="../classes/Tab.html">Tab</a></li>
            
                <li><a href="../classes/TabView.html">TabView</a></li>
            
                <li><a href="../classes/TimeFrame.html">TimeFrame</a></li>
            
                <li><a href="../classes/ToggleButton.html">ToggleButton</a></li>
            
                <li><a href="../classes/Tooltip.html">Tooltip</a></li>
            
                <li><a href="../classes/TreeNode.html">TreeNode</a></li>
            
                <li><a href="../classes/TreeView.html">TreeView</a></li>
            
                <li><a href="../classes/Tween.html">Tween</a></li>
            
                <li><a href="../classes/Utility.html">Utility</a></li>
            
                <li><a href="../classes/Vector.html">Vector</a></li>
            
                <li><a href="../classes/Vector.Circle.html">Vector.Circle</a></li>
            
                <li><a href="../classes/Vector.Ellipse.html">Vector.Ellipse</a></li>
            
                <li><a href="../classes/Vector.Image.html">Vector.Image</a></li>
            
                <li><a href="../classes/Vector.Line.html">Vector.Line</a></li>
            
                <li><a href="../classes/Vector.Path.html">Vector.Path</a></li>
            
                <li><a href="../classes/Vector.Rectangle.html">Vector.Rectangle</a></li>
            
                <li><a href="../classes/Vector.RoundedRectangle.html">Vector.RoundedRectangle</a></li>
            
                <li><a href="../classes/Vector.Text.html">Vector.Text</a></li>
            
                <li><a href="../classes/VectorView.html">VectorView</a></li>
            
                <li><a href="../classes/Widget.html">Widget</a></li>
            
                <li><a href="../classes/WidgetAlignment.html">WidgetAlignment</a></li>
            
                <li><a href="../classes/WidgetChild.html">WidgetChild</a></li>
            
                <li><a href="../classes/WidgetParent.html">WidgetParent</a></li>
            
                <li><a href="../classes/WidgetStack.html">WidgetStack</a></li>
            
        </ul>
    </div>
</div>










<div id="fileTree" class="sidebox">
    <div class="hd">
        <h2 class="no-toc">Files</h2>
    </div>
    <div class="bd">
        <ul><li>build/<ul><li><a href="../files/build_anim.js.html">anim.js</a></li><li><a href="../files/build_appview.js.html">appview.js</a></li><li><a href="../files/build_array-extras.js.html">array-extras.js</a></li><li><a href="../files/build_base.js.html">base.js</a></li><li><a href="../files/build_button.js.html">button.js</a></li><li><a href="../files/build_container.js.html">container.js</a></li><li><a href="../files/build_cookie.js.html">cookie.js</a></li><li><a href="../files/build_datasource.js.html">datasource.js</a></li><li><a href="../files/build_datatable.js.html">datatable.js</a></li><li><a href="../files/build_deferred.js.html">deferred.js</a></li><li><a href="../files/build_dragdrop.js.html">dragdrop.js</a></li><li><a href="../files/build_history.js.html">history.js</a></li><li><a href="../files/build_imageloader.js.html">imageloader.js</a></li><li><a href="../files/build_io-xdr.js.html">io-xdr.js</a></li><li><a href="../files/build_io.js.html">io.js</a></li><li><a href="../files/build_json.js.html">json.js</a></li><li><a href="../files/build_layout.js.html">layout.js</a></li><li><a href="../files/build_log.js.html">log.js</a></li><li><a href="../files/build_menu.js.html">menu.js</a></li><li><a href="../files/build_oop.js.html">oop.js</a></li><li><a href="../files/build_paginator.js.html">paginator.js</a></li><li><a href="../files/build_progressbar.js.html">progressbar.js</a></li><li><a href="../files/build_resize.js.html">resize.js</a></li><li><a href="../files/build_selector.js.html">selector.js</a></li><li><a href="../files/build_sizzle.js.html">sizzle.js</a></li><li><a href="../files/build_swf.js.html">swf.js</a></li><li><a href="../files/build_tabview.js.html">tabview.js</a></li><li><a href="../files/build_touch.js.html">touch.js</a></li><li><a href="../files/build_transition.js.html">transition.js</a></li><li><a href="../files/build_treeview.js.html">treeview.js</a></li><li><a href="../files/build_vector.js.html">vector.js</a></li><li><a href="../files/build_widget-alignment.js.html">widget-alignment.js</a></li><li><a href="../files/build_widget-parentchild.js.html">widget-parentchild.js</a></li><li><a href="../files/build_widget-sandbox.js.html">widget-sandbox.js</a></li><li><a href="../files/build_widget-stack.js.html">widget-stack.js</a></li></ul></li></ul>
    </div>
</div>



        </div>

        <div id="main" class="yui3-u">
            <div class="content"><h4>build/datasource.js</h4>

<pre class="code prettyprint linenums">
/**
 * DataSources are different ways of accessing data and parsing it into an schema
 * @module datasource
 * @requires base
 * 
 * Copyright (c) 2011, Juan Ignacio Dopazo. All rights reserved.
 * Code licensed under the BSD License
 * https://github.com/juandopazo/jet/blob/master/LICENSE.md
*/
jet.add('datasource', function ($) {

			
var Lang = $.Lang,
	Hash = $.Hash,
	A = $.Array,
	Base = $.Base;

var RESPONSE_TYPE_JSON		= 'json',
	RESPONSE_TYPE_XML		= 'xml',
	RESPONSE_TYPE_JSARRAY	= 'jsarray',
	RESPONSE_TYPE_TEXT		= 'text';

var SOURCE_TYPE_XHR			= 'xhr',
	SOURCE_TYPE_JSONP		= 'jsonp',
	SOURCE_TYPE_LOCAL		= 'local';
	
var PARSER = "parser",
	REQUEST_LOGIC = "requestLogic",
	RESPONSE_TYPE = "responseType",
	URL = "url",
	ERROR = "error",
	REQUEST_FAILED_MSG = "Request failed",
	AMPERSAND = "&amp;",
	EQUAL_SIGN = "=",
	TIMEOUT = "timeout",
	TEMP_DATA = "tempData",
	INITIAL_REQUEST = "initialRequest";
	
var RecordNS = jet.namespace('Record');

if (!RecordNS.ids) {
	RecordNS.ids = 0;
}

/**
 * A record is a Hash width a unique id
 * @class Record
 * @constructor
 * @param {Object} An object literal
 */
var Record = function (data) {
	var id = RecordNS.ids++;
	
	/**
	 * Returns the id of the record. Each record has a unique id globally.alert
	 * This allows for easy filtering, ordering, etc of records.alert
	 * @method getId
	 * @return Number
	 */
	this.getId = function () {
		return id;
	};
	/**
	 * Returns the data of the record. Must be an object literal
	 * @method getData
	 */
	this.getData = function () {
		return data;
	};
	/**
	 * Shortcut for getting a value from the record's data
	 * @method get
	 * @param {String} key
	 */
	this.get = function (key) {
		return data[key];
	};
};
/**
 * Returns if an object is a Record
 * @method hasInstance
 * @static
 * @param {Object} o The object to check
 */
Record.hasInstance = function (o) {
	return o instanceof Record;
};

/**
 * A collections of Records
 * @class RecordSet
 * @constructor
 * @param {Array} data If data is passed, it is converted into several Records
 */
var RecordSet = function (data) {
	RecordSet.superclass.constructor.call(this);
	var records = [];
	var sortedBy = false;
	var order;
	
	var self = this;
	
	var toData = function (data) {
		if (RecordSet.hasInstance(data)) {
			data = data.getRecords();
		} else if (!Lang.isArray(data)) {
			data = [data];
		}
		return data;
	};
	
	A.each(data, function (recordData) {
		records[records.length] = new Record(recordData);
	});
	
	/**
	 * Returns all records in the set
	 * @method getRecords
	 */
	this.getRecords = function () {
		return records;
	};
			
	/**
	 * Sorts the records based on a key of the data they hold
	 * @method sortBy
	 * @param {String} key The data key that will be sorted
	 * @param {String} order the order in which to sort. May be "asc" or "desc"
	 * @chainable
	 */
	this.sortBy = function (key, newOrder) {
		if (records.length &gt; 1) {
			records = self._quicksortSet(records, key, newOrder);
			sortedBy = key;
			order = newOrder;
		}
		return self;
	};
	
	/**
	 * Replaces all records with new data
	 * @method replace
	 * @param {Array} data
	 * @chainable
	 */
	this.replace = function (data) {
		data = toData(data);
		self.fire('replace', { data: data });
		return sortedBy ? self.sortBy(sortedBy, order) : self;
	};
	
	/**
	 * Adds data to the set, creating new Records
	 * @method push
	 * @param {Array} data
	 * @chainable
	 */
	this.push = function (data) {
		records = records.concat(toData(data));
		self.fire('push', { records: records, data: data });
		return sortedBy ? self.sortBy(sortedBy, order) : self;
	};
};
$.extend(RecordSet, $.EventTarget, {
	
	_quicksortSet: function (set, key, order) {
		if (set.length &lt;= 1) {
			return set;
		}
		var lesser = [], greater = [];
		var pivot = set.splice(Math.round(set.length / 2), 1)[0];
		var length = set.length;
		for (var i = 0; i &lt; length; i++) {
			if (order == "asc") {
				if (set[i].get(key) &lt;= pivot.get(key)) {
					lesser[lesser.length] = set[i];
				} else {
					greater[greater.length] = set[i];
				}
			} else {
				if (set[i].get(key) &lt;= pivot.get(key)) {
					greater[greater.length] = set[i];
				} else {
					lesser[lesser.length] = set[i];
				}
			}
		}
		return this._quicksortSet(lesser, key, order).concat([pivot]).concat(this._quicksortSet(greater, key, order));
	},
	
	/**
	 * Returns the number of records in the set
	 * @method getCount
	 * @return Number
	 */
	getCount: function () {
		return this.getRecords().length;
	},
	
	getRecordById: function (id) {
		var requiredRecord;
		A.each(this.getRecords(), function (record) {
			if (record.getId() == id) {
				requiredRecord = record;
				return false;
			}
		});
		return requiredRecord;
	}
});
/**
 * Returns whether an object is a RecordSet
 * @method hasInstance
 * @static
 * @param {object} o The object to check
 */
RecordSet.hasInstance = function (o) {
	return o instanceof RecordSet;
};
/**
 * Base class for all data sources. The DataSource class shouldn't be used directly
 * @class DataSource
 * @extends Utility
 * @protected
 * @constructor
 * @param {Object} config Object literal specifying widget configuration properties
 */
var DataSource = Base.create('datasource', $.Utility, [], {
	ATTRS: {
		/**
		 * @attribute recordSet
		 * @description This datasource's associated recordset
		 * @type RecordSet
		 * @writeOnce
		 */
		recordSet: {
			writeOnce: true
		},
		/**
		 * @attribute responseType
		 * @description The expected response type ('xml', 'jsarray', 'json', 'text')
		 * @required
		 */
		responseType: {
			required: true
		},
		/**
		 * @attribute responseSchema
		 * @description &lt;p&gt;The schema by which to parse the response data. May be:&lt;/p&gt;
		 * &lt;p&gt;&lt;strong&gt;DataSource.responseType.JSARRAY schema&lt;/strong&gt;&lt;br/&gt;
		 * A JSARRAY response type assumes the following response shape:&lt;/p&gt;
		 * &lt;code&gt;//All records are listed as an array&lt;br/&gt;
		 * [&lt;br/&gt;
		 * &nbsp;&nbsp;&nbsp;&nbsp;['value1', 'value2', 'value3'], //one record&lt;br/&gt;
		 * &nbsp;&nbsp;&nbsp;&nbsp;['another1', 'another2', 'another3'] //another record&lt;br/&gt;
		 * ]&lt;/code&gt;
		 * &lt;p&gt;&lt;/p&gt;
		 * &lt;p&gt;&lt;strong&gt;DataSource.responseType.TEXT schema&lt;/strong&gt;&lt;br/&gt;
		 * This schema essentially splits the string and then acts as if it where a DataSource.responseType.JSARRAY.&lt;br/&gt;
		 * Must define a &lt;strong&gt;fieldDelim&lt;/strong&gt; property. Example (comma separated value):&lt;/p&gt;
		 * &lt;code&gt;responseSchema: {&lt;br/&gt;
		 * &nbsp;&nbsp;&nbsp;&nbsp;fieldDelim: ","&lt;br/&gt;
		 * &nbsp;&nbsp;&nbsp;&nbsp;fields: ["firstField", "secondField"]&lt;br/&gt;
		 * }&lt;/code&gt;
		 * &lt;p&gt;&lt;/p&gt;
		 * &lt;p&gt;&lt;strong&gt;DataSource.responseType.JSON schema&lt;/strong&gt;&lt;br/&gt;
		 * Example:&lt;/p&gt;
		 * &lt;code&gt;responseSchema = {&lt;br/&gt;
		 * &nbsp;&nbsp;&nbsp;&nbsp;resultList : "Response.Results", // String pointer to result data&lt;br/&gt;
		 * &nbsp;&nbsp;&nbsp;&nbsp;// Field order doesn't matter and not all data is required to have a field&lt;br/&gt;
		 * &nbsp;&nbsp;&nbsp;&nbsp;fields : [&lt;br/&gt;
		 * &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ key: "id" },                    // simple location&lt;br/&gt;
		 * &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ key: "obj" }&lt;br/&gt;
		 * &nbsp;&nbsp;&nbsp;&nbsp;]&lt;br/&gt;
		 * }&lt;/code&gt;
		 * &lt;p&gt;&lt;/p&gt;
		 * &lt;p&gt;&lt;strong&gt;DataSource.responseType.XML schema&lt;/strong&gt;&lt;br/&gt;
		 * Example:&lt;/p&gt; 
		 * &lt;code&gt;responseSchema: {&lt;br/&gt;
		 * &nbsp;&nbsp;&nbsp;&nbsp;resultNode: "rootNode", // every result field will be looked for between this node's children&lt;br/&gt;
		 * &nbsp;&nbsp;&nbsp;&nbsp;fields: [&lt;br/&gt;
		 * &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ key: "keyName", node: "nodeName" }, // in this case, the value of the field will be the node's value&lt;br/&gt;
		 * &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ key: "otherKey", node: "otherNode", attr: "type" }, // in this other case, the field value will be the "type" attribute&lt;br/&gt;
		 * &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ key: "aNumber", node: "someNode", parser: "parseFloat" } // this value will be parsed as a Float&lt;br/&gt;
		 * &nbsp;&nbsp;&nbsp;&nbsp;]&lt;br/&gt;
		 * }&lt;/code&gt;
		 * @type Hash
		 * @required
		 */
		responseSchema: {
			required: true
		},
		/**
		 * @attribute initialRequest
		 * @description Data to send in the automatic initial request
		 * @type Object
		 */
		initialRequest: {
			value: {}
		}
	}
}, {
	_parser: function (rawData) {
		var responseType = this.get(RESPONSE_TYPE);
		var responseSchema = this.get("responseSchema");
		
		var data = [];
		
		/*
		 * Text schema, ie: a comma separated value file.
		 * This essentially splits the string and then acts as if it where a RESPONSE_TYPE_ARRAY
		 */
		if (responseType == RESPONSE_TYPE_TEXT) {
			rawData = rawData.split(responseSchema.recordDelim);
			A.each(rawData, function (str, i) {
				rawData[i] = str.split(responseSchema.fieldDelim);
			});
			responseType = RESPONSE_TYPE_JSARRAY;
		}
		/*
		 * A JSARRAY response type assumes the following response shape:
		 * 
		 * //All records are listed as an array
		 * [
		 *     ['value1', 'value2', 'value3'], //one record
		 *     ['another1', 'another2', 'another3'] //another record
		 * ]
		 */
		if (responseType == RESPONSE_TYPE_JSARRAY) {
			var fields = responseSchema.fields;
			A.each(rawData, function (val, i) {
				data[i] = {};
				A.each(fields, function (fieldName, j) {
					data[i][fieldName] = rawData[i][j];
				});
			});
			
		/*
		 * A JSON Schema
		 * Example:
		 * 
		 *	responseSchema = {
			    resultsList : "Response.Results", // String pointer to result data
			    // Field order doesn't matter and not all data is required to have a field
			    fields : [
			        { key: "id" },                    // simple location
			        { key: "obj.nested" },            // dot notation works
			        { key: "['arr'][1]['nested 2']" } // bracket notation works
			    ]
			}
		 */
		} else if (responseType == RESPONSE_TYPE_JSON) {
			var found = true;
			var root = rawData;
			if (responseSchema.resultList) {
				var resultList = responseSchema.resultList.split(".");
				A.each(resultList, function (key) {
					if (!root[key]) {
						found = false;
					} else {
						root = root[key];
					}
				});
			}
			if (found) {
				A.each(root, function (record, i) {
					data[i] = {};
					A.each(responseSchema.fields, function (field) {
						/*
						 * A field key can be defined with dot notation
						 */
						var nested = field.key.split(".");
						var value = null;
						A.each(nested, function (key) {
							if (Lang.isValue(record[key])) {
								value = record[key];
							}
						});
						data[i][field.key] = value;
					});
				});
			} else {
				this.fire("parserError", { message: "Result list not found" });
			}
		}
		/*
		 * XML Schema.
		 * Example: 
		 * 
		 * responseSchema: {
		 *     resultNode: "rootNode", // every result field will be looked for between this node's children
		 *     fields: [
		 *         { key: "keyName", node: "nodeName" }, // in this case, the value of the field will be the node's value
		 *         { key: "otherKey", node: "otherNode", attr: "type" }, // in this other case, the field value will be the "type" attribute
		 *         { key: "aNumber", node: "someNode", parser: "Float" } // this value will be parsed as a Float
		 *     ]
		 * }
		 */
		else if (responseType == RESPONSE_TYPE_XML) {
			var doc = $.context;
			var de = rawData.documentElement; 
			var resultNode = de.nodeName == responseSchema.resultNode ? $(de) : $(de).find(responseSchema.resultNode).eq(0);
			resultNode.children().each(function (node) {
				var record = {};
				A.each(responseSchema.fields, function (field) {
					var value = node.nodeName != field.node ? $(node).find(field.node)[0] : node;
					var tmp;
					if (value) {
						if (field.attr) {
							value = value.getAttribute(field.attr);
						} else if (field.children) {
							tmp = [];
							$(value).children().each(function (child) {
								if (child.firstChild) {
									tmp.push(child.firstChild.nodeValue);
								}
							});
							value = tmp;
						} else {
							value = value.firstChild ? value.firstChild.nodeValue : "";
						}
						if (field.parser) {
							switch (field.parser.toLowerCase()) {
							case "float":
								value = parseFloat(value);
								break;
							case "10":
								value = parseInt(value, 10);
								break; 
							}
						}
					}
					record[field.key] = value;
				});
				data[data.length] = record;
			});
			$.context = doc;
		}
		return new RecordSet(data);
	},
	
	/**
	 * Sends a request
	 * @method sendRequest
	 * @param {Object} request
	 * @param {Boolean} ignoreCache
	 * @chainable
	 */
	sendRequest: function (request, ignoreCache) {
		var self = this;
		var internalEvents = this._dsEvents;
		this.handleRequest(request, function (rawData) {
			self.set(TEMP_DATA, rawData);
			var tempData = rawData;
			if (internalEvents.fire('beforeParse', { data: rawData })) {
				tempData = self._parser(self.get(TEMP_DATA));
			}
			self.set('recordSet', tempData);
			self.fire('update', { data: tempData, request: request });
			/*Hash.each(tempData, function (key, val) {
				if (!recordSet[key]) {
					recordSet[key] = val;
					self.fire("recordAdded", key, val);
				} else if (recordSet[key] != val || ignoreCache) {
					recordSet[key] = val;
					self.fire("recordUpdate", key, val);
				}
			});*/
			
		}, function (reason) {
			self.fire(ERROR, {
				message: REQUEST_FAILED_MSG,
				reason: reason
			});
		});
		return this;
	},
	
	/**
	 * @method handleRequest
	 * @description The logic for the chosen source type. Should be overwritten when extending the DataSourceClass
	 */
	handleRequest: function (request, success) {
		success(request);
	},
	
	/**
	 * Adds an event listener to the "beforeParse" event
	 * @method onBeforeParse
	 * @param {Function} callback
	 * @chainable
	 */
	onBeforeParse: function (callback) {
		var self = this;
		this._dsEvents.on("beforeParse", function (e) {
			self.set(TEMP_DATA, callback(e.data));
		});
		return this;
	},
	
	initializer: function () {
		this._dsEvents = new $.EventTarget();
		this.sendRequest(this.get(INITIAL_REQUEST));
	}
});
/**
 * A Get DataSource that uses JSON for getting data across domains
 * @class DataSource.Get
 * @extends DataSource
 * @constructor
 * @param {Object} config Object literal specifying configuration properties
 */
DataSource.Get = Base.create('datasource-get', DataSource, [], {
	ATTRS: {
		/**
		 * @attribute jsonCallbackParam
		 * @description Name of the URL parameter that defines the name of the JSONP callback
		 * @type String
		 * @default "p"
		 */
		jsonCallbackParam: {
			value: "p"
		},
		/**
		 * @attribute timeout
		 * @description Ms after which the request is considered to have timed out
		 * @type Number
		 * @default 10000
		 */
		timeout: {
			value: 10000
		},
		/**
		 * @attribute url
		 * @description Url from which to fetch the data
		 * @type String
		 * @required
		 */
		url: {
			required: true,
			setter: function (val) {
				return val.substr(val.length - 1) == "?" ? val : val + "?";
			}
		}
	}
}, {
	handleRequest: function (request, success, failure) {
		$.jsonp({
			url: this.get(URL),
			data: request,
			success: success,
			jsonCallbackParam: this.get("jsonCallbackParam"),
			error: failure,
			timeout: this.get(TIMEOUT)
		});
	}
});
/**
 * An AJAX DataSource
 * @class DataSource.Ajax
 * @extends DataSource
 * @constructor
 * @param {Object} config Object literal specifying widget configuration properties
 */
DataSource.Ajax = Base.create('datasource-ajax', DataSource, [], {
	ATTRS: {
		/**
		 * @attribute url
		 * @description Url from which to fetch the data
		 * @type String
		 * @required
		 */
		url: {
			required: true
		}
	}
}, {
	handleRequest: function (request, success, failure) {
		$.ajax({
			url: this.get(URL),
			data: request,
			dataType: this.get(RESPONSE_TYPE),
			success: success,
			error: failure
		});
	}
});
/**
 * Cross-domain data source
 * @class DataSource.XDR
 * @extends DataSource
 * @constructor
 * @param {Object} config Object literal specifying configuration properties
 */
DataSource.XDR = Base.create('datasource-xdr', DataSource, [], {
	ATTRS: {
		/**
		 * @attribute url
		 * @description Url from which to fetch the data
		 * @type String
		 * @required
		 */
		url: {
			required: true
		}
	}
}, {
	handleRequest: function (request, success, failure) {
		var type = this.get(RESPONSE_TYPE);
		$.flajax({
			url: this.get(URL),
			data: request,
			dataType: this.get(RESPONSE_TYPE),
			success: success,
			error: failure
		});
	}
});
/**
 * A Local DataSource uses local variables
 * @class DataSource.Local
 * @extends DataSource
 * @constructor
 * @param {Object} config Object literal specifying widget configuration properties
 */
DataSource.Local = Base.create('datasource-local', DataSource, [], {
	ATTRS: {
		/**
		 * @attribute localData
		 * @description The object to use as a datasource
		 * @required
		 */
		localData: {
			required: true
		}
	}
}, {
	handleRequest: function (request, success, failure) {
		var localData = this.get('localData');
		if (Lang.isFunction(localData)) {
			success(localData(request));
		} else {
			success(localData);
		}
	}
});

$.mix(DataSource, {
	responseType: {
		JSON: RESPONSE_TYPE_JSON,
		XML: RESPONSE_TYPE_XML,
		TEXT: RESPONSE_TYPE_TEXT,
		JSARRAY: RESPONSE_TYPE_JSARRAY
	}
});

$.add({
	DataSource: DataSource,
	Record: Record,
	RecordSet: RecordSet
});
			
});

</pre>

</div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/js/tabs.js"></script>
</body>
</html>
