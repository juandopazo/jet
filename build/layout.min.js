/**
 * @module layout
 * @requires base,resize,widget-parentchild
 * 
 * Copyright (c) 2011, Juan Ignacio Dopazo. All rights reserved.
 * Code licensed under the BSD License
 * https://github.com/juandopazo/jet/blob/master/LICENSE.md
*/
jet.add("layout",function(b){function f(){this.after("widthChange",this._onSizeChange);this.after("heightChange",this._onSizeChange)}f.Vertical="v";f.Horizontal="h";b.mix(f,{ATTRS:{direction:{value:f.Vertical,writeOnce:true},minSize:{value:0,wriceOnce:true},shim:{value:false,writeOnce:true},defaultChildType:{value:"LayoutPanel"}},EVENTS:{afterRender:"_uiLayoutRender",afterAddChild:"_setupChildResize",removeChild:"_destroyChildResize"},HTML_PARSER:{direction:function(a){return a.hasClass(this.getClassName(f.Horizontal))?
f.Horizontal:f.Vertical}}});f.prototype={_onSizeChange:function(a){if(this.size()>0&&b.Lang.isNumber(a.prevVal)&&b.Lang.isNumber(a.newVal)){for(var d=this.last(),e=this.get("direction")===f.Vertical?"height":"width",g=0,c=this.first();c!==d;){g+=c.get(e);c=c.next()}d.set(e,Math.floor(a.newVal-g))}},_uiLayoutRender:function(){var a=this.get("direction"),d=this.get("boundingBox"),e=a==f.Horizontal?"width":"height",g=0,c=0,i=this.get("children").length;i>0&&d.addClass(this.getClassName(a));this.each(function(h){g+=
h.get(e)||0});c=(d[e]()-g)/i;this.each(function(h){h.get(e)||h.set(e,c)})},_setupChildResize:function(a){var d=b.Resize,e=this.get("minSize"),g=this.get("direction"),c=a.child;if(a.index>0){c.resize=new d({node:c.get("boundingBox"),handles:[g==f.Horizontal?d.Left:d.Top],minWidth:e,minHeight:e,shim:this.get("shim")});c.resize.on("resize:start",this._onChildResizeStart,c);c.resize.on("resize",this._onChildResize,c)}c.get("boundingBox").addClass(c.getClassName("child",g))},_destroyChildResize:function(a){a.child.resize.destroy();
a.child.resize=null},_onChildResizeStart:function(){var a=this.previous(),d=a.get("boundingBox");a._originalWidth=d.width();a._originalHeight=d.height()},_onChildResize:function(a){var d=a.target,e=this.previous(),g=e.get("boundingBox");this.get("parent").get("direction")==f.Horizontal?g.width(d.get("originalWidth")-a.width+e._originalWidth):g.height(d.get("originalHeight")-a.height+e._originalHeight)}};b.LayoutPanelBase=f;b.LayoutPanel=b.Base.create("layout-panel",b.Widget,[b.LayoutPanelBase,b.WidgetParent,
b.WidgetChild],{},{CONTENT_TEMPLATE:null});b.Layout=b.Base.create("layout",b.Widget,[b.LayoutPanelBase,b.WidgetParent],{},{CONTENT_TEMPLATE:null})});
