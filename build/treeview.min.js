/*
 Copyright (c) 2010, Juan Ignacio Dopazo. All rights reserved.
 Code licensed under the BSD License
 http://code.google.com/p/jet-js/wiki/Licence
*/
jet().add("treeview",function(c){var p=c.Array,i=function(){i.superclass.constructor.apply(this,arguments);var f=c("<span/>"),a=this.addAttrs({children:{value:[]},parent:{},type:{value:"text"},label:{required:true,setter:function(e){f.html(e);return e}},expanded:{value:true},treeview:{writeOnce:true,required:true},className:{value:this.get("treeview").get("className")+"-node"}}),h=a.get("treeview"),j=c("<div/>"),g=c("<div/>"),q=function(e,k,b){a.get("boundingBox");e=b?"collapse":"expand";var d=a.get("classPrefix")+
a.get("className");b=d+"-control-";d=d+"-content-";if(a.get("children").length>0)if(a.fire(e)&&h.fire("node:"+e,a))if(k){g.addClass(b+"expanded").removeClass(b+"collapsed");j.addClass(d+"expanded").removeClass(d+"collapsed")}else{g.addClass(b+"collapsed").removeClass(b+"expanded");j.addClass(d+"collapsed").removeClass(d+"expanded")}};this.on("expandedChange",q).on("render",function(){var e=a.get("classPrefix"),k=a.get("className"),b=e+k,d=a.get("boundingBox"),m=[b,"control-expanded-hover"].join("-"),
n=[b,"control-collapsed-hover"].join("-"),r=function(){if(a.get("children").length>0)a.get("expanded")?g.addClass(m).removeClass(n):g.addClass(n).removeClass(m)};g.addClass(b+"-control").appendTo(d);f.addClass(b+"-label").html(a.get("label")).appendTo(d);f.link(g).on("click",function(l){a.fire("click")||l.preventDefault();a.toggle();r()}).on("mouseover",r).on("mouseout",function(){g.removeClass(m).removeClass(n)});j.addClass(b+"-content").appendTo(d);p.each(a.get("children"),function(l){c.mix(l,{parent:a,
treeview:h,classPrefix:e,className:k});(new i(l)).render(j)});b=a.get("expanded");q(b,b)})};c.extend(i,c.Widget,{expand:function(){return this.set("expanded",true)},collapse:function(){return this.set("expanded",false)},toggle:function(){return this.set("expanded",!this.get("expanded"))}});var o=function(){o.superclass.constructor.apply(this,arguments);var f=this.addAttrs({branches:{required:true},className:{value:"treeview"},classPrefix:{value:"jet-"}});this.on("render",function(){var a=f.get("boundingBox");
p.each(f.get("branches"),function(h){c.mix(h,{treeview:f,classPrefix:f.get("classPrefix")});(new i(h)).render(a)})})};c.extend(o,c.Widget);c.add({TreeView:o})});
