/**
 * @module treeview
 * @requires base,selector,widget-parentchild
 * 
 * Copyright (c) 2011, Juan Ignacio Dopazo. All rights reserved.
 * Code licensed under the BSD License
 * https://github.com/juandopazo/jet/blob/master/LICENSE.md
*/
jet.add("treeview",function(c){var e=c.Lang;c.TreeNode=c.Base.create("treenode",c.Widget,[c.WidgetParent,c.WidgetChild],{ATTRS:{type:{value:"text"},title:{value:""},label:{valueFn:function(){return this.get("labelNode").attr("innerHTML")}},controlNode:{setter:c},labelNode:{setter:c},defaultChildType:{value:"TreeNode"}},HTML_PARSER:{contentBox:function(){if(this.CONTENT_TEMPLATE){var a=this.get("boundingBox"),b=a.attr("id");b||a.attr("id",b=c.guid());return a.find(a.find("#"+b+" > ."+this.getClassName("content")))}},
labelNode:function(){return this.get("boundingBox").find("."+this.getClassName("label")).getDOMNode()},controlNode:function(){return this.get("boundingBox").find(".jet-treenode-control").getDOMNode()}}},{LABEL_TEMPLATE:"<span/>",CONTROL_TEMPLATE:"<span/>",_tnToggleSelectable:function(a){a.newVal&&this.get("labelNode").addClass(this.getClassName("label","selectable"))},_uiTNLabelChange:function(a){var b=this.get("labelNode");e.isString(a.newVal)?b.html(a.newVal):b.append(a.newVal)},_uiTNTitleChange:function(a){this.get("controlNode").attr("title",
a.newVal)},_uiTNClick:function(){this.set("selected",!this.get("selected"))},initializer:function(){this.get("labelNode")||this.set("labelNode",this.LABEL_TEMPLATE);this.get("controlNode")||this.set("controlNode",this.CONTROL_TEMPLATE);this.after("labelChange",this._uiTNLabelChange);this.after("titleChange",this._uiTNTitleChange);this.after("selectedChange",this._uiTNSelectedChange);this.after("selectableChange",this._tnToggleSelectable)},renderUI:function(a){this.get("contentBox");var b=this.get("labelNode").html(this.get("label")).addClass(this.getClassName("label")),
d=this.get("controlNode").addClass("jet-treenode-control");b.prependTo(a);d.prependTo(a)},bindUI:function(){this._handlers.push(this.get("labelNode").on("click",this._uiTNClick,this),this.get("controlNode").on("click",this._uiTNClick,this))},syncUI:function(){var a=this.get("title"),b=this.get("selected");a&&this.get("controlNode").attr("title",a);this._uiTNSelectedChange({newVal:b,prevVal:b})},_uiTNSelectedChange:function(a){var b=a.newVal;this.get("boundingBox");a=a.prevVal?"collapse":"expand";
var d=this.get("controlNode"),f=this.get("contentBox"),g=this.getClassName("content","expanded"),h=this.getClassName("content","collapsed");if(this.size()>0&&this.fire(a)&&this.get("root").fire("node:"+a,this)){d.toggleClass("jet-treenode-control-expanded",b).toggleClass("jet-treenode-control-collapsed",!b);f.toggleClass(g,b).toggleClass(h,!b)}}});c.TreeView=c.Base.create("treeview",c.Widget,[c.WidgetParent],{ATTRS:{defaultChildType:{value:"TreeNode"},multiple:{value:true,readOnly:true}}},{})});
