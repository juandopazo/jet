/*
 Copyright (c) 2010, Juan Ignacio Dopazo. All rights reserved.
 Code licensed under the BSD License
 http://code.google.com/p/jet-js/wiki/Licence
*/
jet().add("container",function(d){var i=d.Lang,w=d.Hash,s=d.Array,p=d.DOM,q=!d.UA.ie||d.UA.ie<8,m=function(){m.superclass.constructor.apply(this,arguments);var a=this,g={},h=function(b){return function(c){var e=g[b];e||(e=d("<div/>"));e.children().remove();i.isString(c)?e.html(c):e.append(c);return g[b]=e}};a.addAttrs({header:{setter:h("header"),validator:i.isValue},body:{value:"",setter:h("body"),validator:i.isValue},footer:{setter:h("footer"),validator:i.isValue}});a.set("className",m.NAME);a.on("render",
function(){var b=a.get("boundingBox");w.each(g,function(c,e){e.addClass(c).appendTo(b)})})};m.NAME="module";d.extend(m,d.Widget);var n=function(){n.superclass.constructor.apply(this,arguments);var a=this.addAttrs({center:{value:true},fixed:{value:false},width:{value:300,validator:i.isNumber},height:{value:0,validator:i.isNumber},top:{validator:i.isNumber,setter:function(b){a.unset("bottom");return b}},left:{validator:i.isNumber,setter:function(b){a.unset("right");return b}},bottom:{validator:i.isNumber,
setter:function(b){a.unset("top");return b}},right:{validator:i.isNumber,setter:function(b){a.unset("left");return b}},draggable:{validator:function(){return!!d.Drag},value:false},zIndex:{value:100},modal:{value:false}});a.set("className",n.NAME);var g=function(b){var c=p.screenSize(),e=a.get("rendered");b.css({left:(c.width-(e?b.width():a.get("width")))/2+"px",top:(c.height-(e?b.height():a.get("height")))/2+"px"})};s.each(["height","width"],function(b){a.on(b+"Change",function(c,e){var f=a.get("boundingBox")[b](e);
a.get("center")&&g(f)})});var h=function(b){var c=d(d.context.body).currentStyle();s.each(["left","top","bottom","right"],function(e){var f=e.substr(0,1).toUpperCase()+e.substr(1);f=d.pxToFloat(c["padding"+f])+d.pxToFloat(c["margin"+f]);if(q)b.css(e,a.isSet(e)?a.get(e)-f+"px":"auto");else{var j=p.screenSize();if(e=="bottom")b.css("top",a.isSet(e)?j.height-a.get("height")-f+b.scrollTop()+"px":"auto");else e=="right"?b.css("left",a.isSet(e)?j.width-a.get("width")-f+b.scrollLeft()+"px":"auto"):b.css(e,
a.isSet(e)?a.get(e)-f+"px":"auto")}})};a.on("render",function(){var b=d(d.win),c=a.get("boundingBox"),e=a.get("header"),f=a.get("body"),j=a.get("footer"),r=a.get("fixed")&&q?"fixed":"absolute",l=a.get("height"),u=p.screenSize(),t=d("<div/>").css({position:"fixed",top:"0px",left:"0px",background:"#000",visibility:!a.get("modal")?"hidden":"",zIndex:a.get("zIndex")-1,opacity:0.4}).width(u.width).height(u.height).appendTo(d.context.body);b.on("resize",function(){var v=p.screenSize();t.width(v.width).height(v.height)});
a.on("hide",function(){t.hide()}).on("show",function(){a.get("modal")&&t.show()});e&&c.append(e);f&&c.append(f);j&&c.append(j);c.css("position",r).css("zIndex",a.get("zIndex")).width(a.get("width"));l&&c.height(l);h(c)});a.on("afterRender",function(){var b=a.get("boundingBox"),c=d(d.win),e=a.get("header"),f=a.get("fixed");if(a.get("draggable"))a.dd=new d.Drag({node:b,handlers:e});if(a.get("center")){g(b);c.on("resize",function(){g(a.get("boundingBox"))});if(f||!q)d(d.win).on("scroll",function(){g(a.get("boundingBox"))});
a.on("afterShow",function(){g(b)})}else if(f&&!q){c.on("scroll",function(){h(a.get("boundingBox"))});c.on("resize",function(){h(a.get("boundingBox"))})}})};n.NAME="overlay";d.extend(n,m);var k=function(){k.superclass.constructor.apply(this,arguments);var a=this.set("className",k.NAME).addAttrs({contentBox:{readOnly:true,value:d("<div/>")},underlay:{readOnly:true,value:d("<div/>").addClass("underlay")},shadow:{value:true}}).on("heightChange",function(b,c){a.get("contentBox").height(c)}),g=function(b){a.fire("close")&&
a.hide();b.preventDefault()},h=d("<a/>").attr("href","#").addClass("container-close").on("click",g);d(d.context).on("keyup",function(b){b.keyCode==27&&a.get("focused")&&g(b)});a.addAttr("close",{value:true,validator:i.isBoolean,setter:function(b){b?h.show():h.hide();return b}}).on("render",function(){var b=a.get("height"),c=a.get("contentBox");b&&c.height(b);b=a.get("classPrefix");for(var e=a.get("boundingBox").addClass(b+k.NAME+"-container"),f=a.get("header"),j=a.get("body"),r=a.get("footer"),l=
k;l.NAME;){c.addClass(b+l.NAME);l=l.superclass.constructor}f&&c.append(f.remove(true));j&&c.append(j.remove(true));r&&c.append(r.remove(true));a.get("close")&&h.appendTo(c);c.appendTo(e).css("visibility","inherit");e.append(a.get("underlay"));a.get("shadow")&&e.addClass("shadow")})};k.NAME="panel";d.extend(k,n);var o=function(){o.superclass.constructor.apply(this,arguments);var a=this;a.addAttrs({footer:{readOnly:true,value:d("<div/>").addClass("footer")},buttons:{validator:i.isArray,value:[]}}).set("className",
o.NAME);a.on("render",function(){a.get("boundingBox").addClass(a.get("classPrefix")+o.NAME);var g=d("<div/>").addClass("button-group");s.each(a.get("buttons"),function(h,b){var c=new d.Button(h);b===0&&c.get("boundingBox").addClass("default");c.on("pressed",function(){a.hide()}).render(g)});a.get("footer").append(g)})};o.NAME="dialog";d.extend(o,k);d.add({Module:m,Overlay:n,Panel:k,SimpleDialog:o})});
