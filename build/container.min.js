/*
 Copyright (c) 2010, Juan Ignacio Dopazo. All rights reserved.
 Code licensed under the BSD License
 http://code.google.com/p/jet-js/wiki/Licence
*/
jet().add("container",function(c){var i=c.Lang,y=c.Hash,q=c.Array,r=c.DOM,s=!c.UA.ie||c.UA.ie<8,n=function(){n.superclass.constructor.apply(this,arguments);var a=this,j={},h=function(f){return function(b){var d=j[f];d||(d=c("<div/>"));d.children().remove();i.isString(b)?d.html(b):d.append(b);return j[f]=d}};a.addAttrs({header:{setter:h("header"),validator:i.isValue},body:{value:"",setter:h("body"),validator:i.isValue},footer:{setter:h("footer"),validator:i.isValue}});a.set("className",n.NAME);a.on("render",
function(){var f=a.get("boundingBox");y.each(j,function(b,d){d.addClass(b).appendTo(f)})})};n.NAME="module";c.extend(n,c.Widget);if(!jet.overlays)jet.overlays=[];if(!i.isNumber(jet.ovZindex))jet.ovZindex=10;var m=function(){m.superclass.constructor.apply(this,arguments);var a=this.addAttrs({center:{value:true},fixed:{value:false},width:{value:300,validator:i.isNumber},height:{value:0,validator:i.isNumber},top:{validator:i.isNumber,setter:function(b){a.unset("bottom");return b}},left:{validator:i.isNumber,
setter:function(b){a.unset("right");return b}},bottom:{validator:i.isNumber,setter:function(b){a.unset("top");return b}},right:{validator:i.isNumber,setter:function(b){a.unset("left");return b}},draggable:{validator:function(){return!!c.Drag},value:false},modal:{value:false}});a.set("className",m.NAME);jet.overlays.push(this);var j=jet.overlays.length-1,h=function(b){var d=r.screenSize(),e=a.get("rendered");b.css({left:(d.width-(e?b.width():a.get("width")))/2+"px",top:(d.height-(e?b.height():a.get("height")))/
2+"px"})};q.each(["height","width"],function(b){a.on(b+"Change",function(d,e){var g=a.get("boundingBox")[b](e);a.get("center")&&h(g)})});var f=function(b){var d=c(c.context.body).currentStyle();q.each(["left","top","bottom","right"],function(e){var g=e.substr(0,1).toUpperCase()+e.substr(1);g=c.pxToFloat(d["padding"+g])+c.pxToFloat(d["margin"+g]);if(s)b.css(e,a.isSet(e)?a.get(e)-g+"px":"auto");else{var k=r.screenSize();if(e=="bottom")b.css("top",a.isSet(e)?k.height-a.get("height")-g+b.scrollTop()+
"px":"auto");else e=="right"?b.css("left",a.isSet(e)?k.width-a.get("width")-g+b.scrollLeft()+"px":"auto"):b.css(e,a.isSet(e)?a.get(e)-g+"px":"auto")}})};a.on("render",function(){var b=c(c.win),d=a.get("boundingBox"),e=a.get("header"),g=a.get("body"),k=a.get("footer"),o=a.get("fixed")&&s?"fixed":"absolute",v=a.get("height"),w=r.screenSize(),t=c("<div/>").css({position:"fixed",top:"0px",left:"0px",background:"#000",visibility:!a.get("modal")?"hidden":"",zIndex:jet.ovZindex+j-1,opacity:0.4}).width(w.width).height(w.height).appendTo(c.context.body);
b.on("resize",function(){var x=r.screenSize();t.width(x.width).height(x.height)});a.on("hide",function(){t.hide()}).on("show",function(){a.get("modal")&&t.show()});e&&d.append(e);g&&d.append(g);k&&d.append(k);d.css("position",o).css("zIndex",jet.ovZindex+j).width(a.get("width")).on("mousedown",function(){a.focus()});v&&d.height(v);f(d)});a.on("afterRender",function(){var b=a.get("boundingBox"),d=c(c.win),e=a.get("header"),g=a.get("fixed");if(a.get("draggable"))a.dd=new c.Drag({node:b,handlers:e});
if(a.get("center")){h(b);d.on("resize",function(){h(a.get("boundingBox"))});if(g||!s)c(c.win).on("scroll",function(){h(a.get("boundingBox"))});a.on("afterShow",function(){h(b)})}else if(g&&!s){d.on("scroll",function(){f(a.get("boundingBox"))});d.on("resize",function(){f(a.get("boundingBox"))})}});this.on("focus",function(){q.remove(a,jet.overlays);jet.overlays.push(a);var b=jet.overlays,d,e=b.length;for(d=0;d<e;d++)b[d].get("boundingBox").css("zIndex",jet.ovZindex+d)})};m.NAME="overlay";c.extend(m,
n);var u=function(){u.superclass.constructor.apply(this,arguments);this.addAttrs({position:{value:"r"},fadeIn:{value:false,validator:function(){return!!c.Tween}}});this.on("render",function(){this.hide().set("body",this.get("body")||this.get("srcNode").attr("title"));this.get("srcNode").on("mouseover",this.show).on("mouseout",this.hide)});this.on("show",function(){var a=this.get("srcNode").offset();this.set("left",a.left).set("top",a.top+a.height);this.get("fadeIn")&&this.get("boundingBox").css("opacity",
0).fadeIn(this.get("fadeIn"))})};c.extend(u,m);var l=function(){l.superclass.constructor.apply(this,arguments);var a=this.set("className",l.NAME).addAttrs({contentBox:{readOnly:true,value:c("<div/>")},underlay:{readOnly:true,value:c("<div/>").addClass("underlay")},shadow:{value:true}}).on("heightChange",function(f,b){a.get("contentBox").height(b)}),j=function(f){a.fire("close")&&a.hide();f.preventDefault()},h=c("<a/>").attr("href","#").addClass("container-close").on("click",j);c(c.context).on("keyup",
function(f){f.keyCode==27&&a.get("focused")&&j(f)});a.addAttr("close",{value:true,validator:i.isBoolean,setter:function(f){f?h.show():h.hide();return f}}).on("render",function(){var f=a.get("height"),b=a.get("contentBox");f&&b.height(f);f=a.get("classPrefix");for(var d=a.get("boundingBox").addClass(f+l.NAME+"-container"),e=a.get("header"),g=a.get("body"),k=a.get("footer"),o=l;o.NAME;){b.addClass(f+o.NAME);o=o.superclass.constructor}e&&b.append(e.remove(true));g&&b.append(g.remove(true));k&&b.append(k.remove(true));
a.get("close")&&h.appendTo(b);b.appendTo(d).css("visibility","inherit");d.append(a.get("underlay"));a.get("shadow")&&d.addClass("shadow")})};l.NAME="panel";c.extend(l,m);var p=function(){p.superclass.constructor.apply(this,arguments);var a=this;a.addAttrs({footer:{readOnly:true,value:c("<div/>").addClass("footer")},buttons:{validator:i.isArray,value:[]}}).set("className",p.NAME);a.on("render",function(){a.get("boundingBox").addClass(a.get("classPrefix")+p.NAME);var j=c("<div/>").addClass("button-group");
q.each(a.get("buttons"),function(h,f){var b=new c.Button(h);f===0&&b.get("boundingBox").addClass("default");b.on("pressed",function(){a.hide()}).render(j)});a.get("footer").append(j)})};p.NAME="dialog";c.extend(p,l);c.add({Module:n,Overlay:m,Tooltip:u,Panel:l,SimpleDialog:p})});
