/*
 Copyright (c) 2010, Juan Ignacio Dopazo. All rights reserved.
 Code licensed under the BSD License
 http://code.google.com/p/jet-js/wiki/Licence
*/
jet().add("container",function(c){var j=c.Lang,x=c.Hash,r=c.Array,p=c.DOM,q=!c.UA.ie||c.UA.ie<8,m=function(){m.superclass.constructor.apply(this,arguments);var a=this,i={},e=function(f){return function(b){var d=i[f];d||(d=c("<div/>"));d.children().remove();j.isString(b)?d.html(b):d.append(b);return i[f]=d}};a.addAttrs({header:{setter:e("header"),validator:j.isValue},body:{value:"",setter:e("body"),validator:j.isValue},footer:{setter:e("footer"),validator:j.isValue}});a.set("className",m.NAME);a.on("render",
function(){var f=a.get("boundingBox");x.each(i,function(b,d){d.addClass(b).appendTo(f)})})};m.NAME="module";c.extend(m,c.Widget);var n=function(){n.superclass.constructor.apply(this,arguments);var a=this.addAttrs({center:{value:true},fixed:{value:false},width:{value:300,validator:j.isNumber},height:{value:0,validator:j.isNumber},top:{validator:j.isNumber,setter:function(b){a.unset("bottom");return b}},left:{validator:j.isNumber,setter:function(b){a.unset("right");return b}},bottom:{validator:j.isNumber,
setter:function(b){a.unset("top");return b}},right:{validator:j.isNumber,setter:function(b){a.unset("left");return b}},draggable:{validator:function(){return!!c.Drag},value:false},zIndex:{value:100},modal:{value:false}});a.set("className",n.NAME);var i=false;a.on("rendered",function(){i=true});var e=function(b){var d=p.screenSize();b.css({left:(d.width-(i?b.width():a.get("width")))/2+"px",top:(d.height-(i?b.height():a.get("height")))/2+"px"})};r.each(["height","width"],function(b){a.on(b+"Change",
function(d,g){var h=a.get("boundingBox")[b](g);a.get("center")&&e(h)})});var f=function(b){var d=c(c.context.body).currentStyle();r.each(["left","top","bottom","right"],function(g){var h=g.substr(0,1).toUpperCase()+g.substr(1);h=c.pxToFloat(d["padding"+h])+c.pxToFloat(d["margin"+h]);if(q)b.css(g,a.isSet(g)?a.get(g)-h+"px":"auto");else{var k=p.screenSize();if(g=="bottom")b.css("top",a.isSet(g)?k.height-a.get("height")-h+b.scrollTop()+"px":"auto");else g=="right"?b.css("left",a.isSet(g)?k.width-a.get("width")-
h+b.scrollLeft()+"px":"auto"):b.css(g,a.isSet(g)?a.get(g)-h+"px":"auto")}})};a.on("render",function(){var b=c(c.win),d=a.get("boundingBox"),g=a.get("header"),h=a.get("body"),k=a.get("footer"),s=a.get("fixed"),y=s&&q?"fixed":"absolute",u=a.get("height"),v=p.screenSize(),t=c("<div/>").css({position:"fixed",top:"0px",left:"0px",background:"#000",visibility:!a.get("modal")?"hidden":"",zIndex:a.get("zIndex")-1,opacity:0.4}).width(v.width).height(v.height).appendTo(c.context.body);b.on("resize",function(){var w=
p.screenSize();t.width(w.width).height(w.height)});a.on("hide",function(){t.hide()}).on("show",function(){a.get("modal")&&t.show()});g&&d.append(g);h&&d.append(h);k&&d.append(k);d.css("position",y).css("zIndex",a.get("zIndex")).width(a.get("width"));u&&d.height(u);f(d);if(a.get("center")){e(d);b.on("resize",function(){e(a.get("boundingBox"))});if(s||!q)c(c.win).on("scroll",function(){e(a.get("boundingBox"))})}else if(s&&!q){b.on("scroll",function(){f(a.get("boundingBox"))});b.on("resize",function(){f(a.get("boundingBox"))})}});
a.on("afterRender",function(){if(a.get("draggable")){var b=a.get("header");a.dd=new c.Drag({node:a.get("boundingBox")});b&&a.dd.addHandler(b)}})};n.NAME="overlay";c.extend(n,m);var l=function(){l.superclass.constructor.apply(this,arguments);var a=this.set("className",l.NAME).addAttrs({contentBox:{readOnly:true,value:c("<div/>")},underlay:{readOnly:true,value:c("<div/>").addClass("underlay")},shadow:{value:true}}).on("heightChange",function(e,f){a.get("contentBox").height(f)}),i=c("<a/>").attr("href",
"#").addClass("container-close").on("click",function(e){a.fire("close")&&a.hide();e.preventDefault()});a.addAttr("close",{value:true,validator:j.isBoolean,setter:function(e){e?i.show():i.hide();return e}}).on("render",function(){var e=a.get("height"),f=a.get("contentBox");e&&f.height(e);e=a.get("classPrefix");for(var b=a.get("boundingBox").addClass(e+l.NAME+"-container"),d=a.get("header"),g=a.get("body"),h=a.get("footer"),k=l;k.NAME;){f.addClass(e+k.NAME);k=k.superclass.constructor}d&&f.append(d.remove(true));
g&&f.append(g.remove(true));h&&f.append(h.remove(true));a.get("close")&&i.appendTo(f);f.appendTo(b).css("visibility","inherit");b.append(a.get("underlay"));a.get("shadow")&&b.addClass("shadow")})};l.NAME="panel";c.extend(l,n);var o=function(){o.superclass.constructor.apply(this,arguments);var a=this;a.addAttrs({footer:{readOnly:true,value:c("<div/>").addClass("footer")},buttons:{validator:j.isArray,value:[]}}).set("className",o.NAME);a.on("render",function(){a.get("boundingBox").addClass(a.get("classPrefix")+
o.NAME);var i=c("<div/>").addClass("button-group");r.each(a.get("buttons"),function(e,f){var b=new c.Button(e);f===0&&b.get("boundingBox").addClass("default");b.on("pressed",function(){a.hide()}).render(i)});a.get("footer").append(i)})};o.NAME="dialog";c.extend(o,l);c.add({Module:m,Overlay:n,Panel:l,SimpleDialog:o})});
