/**
 * @module container
 * @requires base,widget-alignment,widget-stack
 * 
 * Copyright (c) 2011, Juan Ignacio Dopazo. All rights reserved.
 * Code licensed under the BSD License
 * https://github.com/juandopazo/jet/blob/master/LICENSE.md
*/
jet.add("container",function(b){var f=b.Lang,j=b.Array,k=b.DOM,g=b.Base,h=b.Widget,i=jet;b.Module=g.create("module",h,[],{ATTRS:{header:{value:"<div/>",setter:b},body:{value:"<div/>",setter:b},footer:{value:"<div/>",setter:b},headerContent:{validator:f.isValue},bodyContent:{value:"",validator:f.isValue},footerContent:{validator:f.isValue}}},{CONTENT_TEMPLATE:null,initializer:function(){this.set("header",this.get("header"));this.set("body",this.get("body"));this.set("footer",this.get("footer"))},_uiHeaderChange:function(a){this.get("header").setContent(a.newVal)},
_uiBodyChange:function(a){this.get("body").setContent(a.newVal)},_uiFooterChange:function(a){this.get("footer").setContent(a.newVal)},renderUI:function(){var a=this,c=this.get("contentBox");j.each(["header","body","footer"],function(d){var e=a.get(d+"Content");d=a.get(d).addClass(d);if(f.isValue(e)){if(e.nodeType)e=b(e);e instanceof b.NodeList?d.append(e):d.html(e);d.appendTo(c)}})},bindUI:function(){j.each(["Header","Body","Footer"],function(a){this.after(a.toLowerCase()+"ContentChange",this["_ui"+
a+"Change"])},this)}});if(!i.overlays)i.overlays=[];if(!f.isNumber(i.ovZindex))i.ovZindex=10;b.Overlay=g.create("overlay",b.Module,[b.WidgetAlignment,b.WidgetStack],{ATTRS:{draggable:{validator:function(){return!!b.Drag},value:false,writeOnce:true},modal:{value:false,writeOnce:true},startZIndex:{getter:function(){return i.overlays.length-1},readOnly:true},modalBox:{setter:b}}},{MODAL_TEMPLATE:"<div/>",_resizeModal:function(){var a=k.screenSize();this.get("modalBox").width(a.width).height(a.height)},
_showModal:function(){this.get("modal")&&this.get("modalBox").show()},_hideModal:function(){this.get("modalBox").hide()},initializer:function(){this.get("modalBox")||this.set("modalBox",this.MODAL_TEMPLATE)},renderUI:function(){var a=k.screenSize();this.get("startZIndex");this.get("modalBox").css({position:"absolute",top:"0px",left:"0px",background:"#000",visibility:!this.get("modal")?"hidden":"",zIndex:this.get("zIndex")-1,opacity:0.4}).width(a.width).height(a.height).appendTo(b.config.doc.body)},
bindUI:function(){this.after("show",this._showModal);this.after("hide",this._hideModal);this.on("mousedown",this.focus);this._handlers.push(b(b.config.win).on("resize",this._resizeModal,this))},syncUI:function(a){var c=this.get("header");if(this.get("draggable"))this.dd=new b.Drag({node:a,handlers:c})},destructor:function(){this.dd&&this.dd.destroy()}});b.Tooltip=g.create("tooltip",h,[b.WidgetAlignment],{ATTRS:{align:{value:{points:["tl","bl"]}},fadeIn:{value:false,validator:function(){return!!b.Tween}}}},
{_uiShowTooltip:function(){var a=this.get("srcNode").offset(),c=this.get("fadeIn");this.set("left",a.left).set("top",a.top+a.height);c&&this.get("boundingBox").css("opacity",0).fadeIn(c)},renderUI:function(){this.set("align",{node:this.get("srcNode"),points:this.get("align").points})},bindUI:function(){var a=this.get("srcNode");this.after("show",this._uiShowTooltip);this._handlers.push(a.on("mouseover",this.show,this),a.on("mouseout",this.hide,this))},syncUI:function(){this.hide().set("bodyContent",
this.get("bodyContent")||this.get("srcNode").attr("title"))}});h=b.mix(function(){},{ATTRS:{close:{value:true,validator:f.isBoolean},underlay:{setter:b},shadow:{value:true},closeButton:{value:"<a/>",setter:b}},EVENTS:{render:function(){this.get("height");var a=this.get("contentBox"),c=this.get("closeButton").addClass("container-close"),d=this.get("boundingBox");c.on("click",this._onCloseButton,this);c.appendTo(a);d.append(this.get("underlay"));this.get("shadow")&&d.addClass("shadow");this._handlers.push(b(b.config.doc).on("keyup",
this._onContextKeyUp,this))},afterCloseChange:function(a){this.get("closeButton").toggle(a.newVal)}}});h.prototype={CONTENT_TEMPLATE:"<div/>",CLOSE_TEMPLATE:"<a/>",_onCloseButton:function(a){a.preventDefault();this.fire("close")&&this.hide()},_onContextKeyUp:function(a){a.keyCode==27&&this.get("focused")&&this._onCloseButton(a)}};b.Panel=g.create("panel",b.Overlay,[h],{},{initializer:function(){this.set("closeButton",this.get("closeButton"));this.set("underlay",b("<div/>").addClass("underlay"))},
bindUI:function(){this.after("heightChange",function(a){this.get("contentBox").height(a.newVal)},this)}});b.StaticPanel=g.create("panel",b.Module,[h],{},{initializer:function(){this.set("closeButton",this.get("closeButton"));this.set("underlay",b("<div/>").addClass("underlay"))},bindUI:function(){this.after("heightChange",function(a){this.get("contentBox").height(a.newVal)},this)}});b.SimpleDialog=g.create("dialog",b.Panel,[],{ATTRS:{buttons:{value:[]},footerContent:{value:" ",readOnly:true}}},{_bgVisibleChange:function(a){var c=
a.newVal?"show":"hide";this.bg[c]();this.bg.each(function(d){d[c]()})},renderUI:function(){var a=this.bg=new b.ButtonGroup({children:this.get("buttons")});a.render(this.get("footer"));a.get("boundingBox").css("visibility","inherit")},bindUI:function(){this.after("visibleChange",this._bgVisibleChange)}})});
