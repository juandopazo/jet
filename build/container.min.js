/*
 Copyright (c) 2010, Juan Ignacio Dopazo. All rights reserved.
 Code licensed under the BSD License
 http://code.google.com/p/jet-js/wiki/Licence
*/
jet().add("container",function(d){var i=d.Lang,x=d.Hash,q=d.Array,r=d.DOM,s=!d.UA.ie||d.UA.ie<8,m=function(){m.superclass.constructor.apply(this,arguments);var a=this,j={},h=function(f){return function(b){var c=j[f];c||(c=d("<div/>"));c.children().remove();i.isString(b)?c.html(b):c.append(b);return j[f]=c}};a.addAttrs({header:{setter:h("header"),validator:i.isValue},body:{value:"",setter:h("body"),validator:i.isValue},footer:{setter:h("footer"),validator:i.isValue}});a.set("className",m.NAME);a.on("render",
function(){var f=a.get("boundingBox");x.each(j,function(b,c){c.addClass(b).appendTo(f)})})};m.NAME="module";d.extend(m,d.Widget);if(!jet.overlays)jet.overlays=[];if(!i.isNumber(jet.ovZindex))jet.ovZindex=10;var n=function(){n.superclass.constructor.apply(this,arguments);var a=this.addAttrs({center:{value:true},fixed:{value:false},width:{value:300,validator:i.isNumber},height:{value:0,validator:i.isNumber},top:{validator:i.isNumber,setter:function(b){a.unset("bottom");return b}},left:{validator:i.isNumber,
setter:function(b){a.unset("right");return b}},bottom:{validator:i.isNumber,setter:function(b){a.unset("top");return b}},right:{validator:i.isNumber,setter:function(b){a.unset("left");return b}},draggable:{validator:function(){return!!d.Drag},value:false},modal:{value:false}});a.set("className",n.NAME);jet.overlays.push(this);var j=jet.overlays.length-1,h=function(b){var c=r.screenSize(),e=a.get("rendered");b.css({left:(c.width-(e?b.width():a.get("width")))/2+"px",top:(c.height-(e?b.height():a.get("height")))/
2+"px"})};q.each(["height","width"],function(b){a.on(b+"Change",function(c,e){var g=a.get("boundingBox")[b](e);a.get("center")&&h(g)})});var f=function(b){var c=d(d.context.body).currentStyle();q.each(["left","top","bottom","right"],function(e){var g=e.substr(0,1).toUpperCase()+e.substr(1);g=d.pxToFloat(c["padding"+g])+d.pxToFloat(c["margin"+g]);if(s)b.css(e,a.isSet(e)?a.get(e)-g+"px":"auto");else{var k=r.screenSize();if(e=="bottom")b.css("top",a.isSet(e)?k.height-a.get("height")-g+b.scrollTop()+
"px":"auto");else e=="right"?b.css("left",a.isSet(e)?k.width-a.get("width")-g+b.scrollLeft()+"px":"auto"):b.css(e,a.isSet(e)?a.get(e)-g+"px":"auto")}})};a.on("render",function(){var b=d(d.win),c=a.get("boundingBox"),e=a.get("header"),g=a.get("body"),k=a.get("footer"),o=a.get("fixed")&&s?"fixed":"absolute",u=a.get("height"),v=r.screenSize(),t=d("<div/>").css({position:"fixed",top:"0px",left:"0px",background:"#000",visibility:!a.get("modal")?"hidden":"",zIndex:jet.ovZindex+j-1,opacity:0.4}).width(v.width).height(v.height).appendTo(d.context.body);
b.on("resize",function(){var w=r.screenSize();t.width(w.width).height(w.height)});a.on("hide",function(){t.hide()}).on("show",function(){a.get("modal")&&t.show()});e&&c.append(e);g&&c.append(g);k&&c.append(k);c.css("position",o).css("zIndex",jet.ovZindex+j).width(a.get("width")).on("mousedown",function(){a.focus()});u&&c.height(u);f(c)});a.on("afterRender",function(){var b=a.get("boundingBox"),c=d(d.win),e=a.get("header"),g=a.get("fixed");if(a.get("draggable"))a.dd=new d.Drag({node:b,handlers:e});
if(a.get("center")){h(b);c.on("resize",function(){h(a.get("boundingBox"))});if(g||!s)d(d.win).on("scroll",function(){h(a.get("boundingBox"))});a.on("afterShow",function(){h(b)})}else if(g&&!s){c.on("scroll",function(){f(a.get("boundingBox"))});c.on("resize",function(){f(a.get("boundingBox"))})}});this.on("focus",function(){q.remove(a,jet.overlays);jet.overlays.push(a);var b=jet.overlays,c,e=b.length;for(c=0;c<e;c++)b[c].get("boundingBox").css("zIndex",jet.ovZindex+c)})};n.NAME="overlay";d.extend(n,
m);var l=function(){l.superclass.constructor.apply(this,arguments);var a=this.set("className",l.NAME).addAttrs({contentBox:{readOnly:true,value:d("<div/>")},underlay:{readOnly:true,value:d("<div/>").addClass("underlay")},shadow:{value:true}}).on("heightChange",function(f,b){a.get("contentBox").height(b)}),j=function(f){a.fire("close")&&a.hide();f.preventDefault()},h=d("<a/>").attr("href","#").addClass("container-close").on("click",j);d(d.context).on("keyup",function(f){f.keyCode==27&&a.get("focused")&&
j(f)});a.addAttr("close",{value:true,validator:i.isBoolean,setter:function(f){f?h.show():h.hide();return f}}).on("render",function(){var f=a.get("height"),b=a.get("contentBox");f&&b.height(f);f=a.get("classPrefix");for(var c=a.get("boundingBox").addClass(f+l.NAME+"-container"),e=a.get("header"),g=a.get("body"),k=a.get("footer"),o=l;o.NAME;){b.addClass(f+o.NAME);o=o.superclass.constructor}e&&b.append(e.remove(true));g&&b.append(g.remove(true));k&&b.append(k.remove(true));a.get("close")&&h.appendTo(b);
b.appendTo(c).css("visibility","inherit");c.append(a.get("underlay"));a.get("shadow")&&c.addClass("shadow")})};l.NAME="panel";d.extend(l,n);var p=function(){p.superclass.constructor.apply(this,arguments);var a=this;a.addAttrs({footer:{readOnly:true,value:d("<div/>").addClass("footer")},buttons:{validator:i.isArray,value:[]}}).set("className",p.NAME);a.on("render",function(){a.get("boundingBox").addClass(a.get("classPrefix")+p.NAME);var j=d("<div/>").addClass("button-group");q.each(a.get("buttons"),
function(h,f){var b=new d.Button(h);f===0&&b.get("boundingBox").addClass("default");b.on("pressed",function(){a.hide()}).render(j)});a.get("footer").append(j)})};p.NAME="dialog";d.extend(p,l);d.add({Module:m,Overlay:n,Panel:l,SimpleDialog:p})});
