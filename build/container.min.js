/**
 * @module container
 * @requires base,widget-alignment,widget-stack
 * 
 * Copyright (c) 2012, Juan Ignacio Dopazo. All rights reserved.
 * Code licensed under the BSD License
 * https://github.com/juandopazo/jet/blob/master/LICENSE.md
*/
jet.add("container",function(b){function g(){this.set("closeButton",this.get("closeButton"));this.set(h,this.get(h));this.after("closeChange",this._uiCloseChange)}var d=b.Lang,i=b.Array,k=b.DOM,e=b.Base,l=b.Widget,f=jet,h="underlay";b.Module=e.create("module",l,[],{ATTRS:{header:{value:"<div/>",setter:b},body:{value:"<div/>",setter:b},footer:{value:"<div/>",setter:b},headerContent:{validator:d.isValue},bodyContent:{value:"",validator:d.isValue},footerContent:{validator:d.isValue}}},{CONTENT_TEMPLATE:null,
initializer:function(){this.set("header",this.get("header"));this.set("body",this.get("body"));this.set("footer",this.get("footer"));i.each(["header","body","footer"],function(a){var c=this.get(a+"Content");a=this.get(a);if(d.isValue(c)){if(c.nodeType)c=b(c);c instanceof b.NodeList?a.append(c):a.html(c)}},this);i.each(["Header","Body","Footer"],function(a){this.after(a.toLowerCase()+"ContentChange",this["_ui"+a+"Change"])},this)},_uiHeaderChange:function(a){this.get("header").setContent(a.newVal)},
_uiBodyChange:function(a){this.get("body").setContent(a.newVal)},_uiFooterChange:function(a){this.get("footer").setContent(a.newVal)},renderUI:function(){var a=this.get("contentBox");i.each(["header","body","footer"],function(c){var j=this.get(c+"Content");c=this.get(c).addClass(c);d.isValue(j)&&c.appendTo(a)},this)}});if(!f.overlays)f.overlays=[];if(!d.isNumber(f.ovZindex))f.ovZindex=10;b.Overlay=e.create("overlay",b.Module,[b.WidgetAlignment,b.WidgetStack],{ATTRS:{draggable:{validator:function(){return!!b.Drag},
value:false,writeOnce:true},modal:{value:false,writeOnce:true},startZIndex:{getter:function(){return f.overlays.length-1},readOnly:true},modalBox:{setter:b}}},{MODAL_TEMPLATE:"<div/>",_resizeModal:function(){var a=k.screenSize();this.get("modalBox").width(a.width).height(a.height)},_showModal:function(){this.get("modal")&&this.get("modalBox").show()},_hideModal:function(){this.get("modalBox").hide()},initializer:function(){this.get("modalBox")||this.set("modalBox",this.MODAL_TEMPLATE)},renderUI:function(){var a=
k.screenSize();this.get("startZIndex");this.get("modalBox").css({position:"absolute",top:"0px",left:"0px",background:"#000",visibility:!this.get("modal")?"hidden":"",zIndex:this.get("zIndex")-1,opacity:0.4}).width(a.width).height(a.height).appendTo(b.config.doc.body)},bindUI:function(){this.after("show",this._showModal);this.after("hide",this._hideModal);this.on("mousedown",this.focus);this._handlers.push(b(b.config.win).on("resize",this._resizeModal,this))},syncUI:function(a){var c=this.get("header");
if(this.get("draggable"))this.dd=new b.Drag({node:a,handlers:c})},destructor:function(){this.dd&&this.dd.destroy()}});b.Tooltip=e.create("tooltip",l,[b.WidgetAlignment],{ATTRS:{align:{value:{points:["tl","bl"]}},fadeIn:{value:false,validator:function(){return!!b.Tween}}}},{_uiShowTooltip:function(){var a=this.get("srcNode").offset(),c=this.get("fadeIn");this.set("left",a.left).set("top",a.top+a.height);c&&this.get("boundingBox").css("opacity",0).fadeIn(c)},renderUI:function(){this.set("align",{node:this.get("srcNode"),
points:this.get("align").points})},bindUI:function(){var a=this.get("srcNode");this.after("show",this._uiShowTooltip);this._handlers.push(a.on("mouseover",this.show,this),a.on("mouseout",this.hide,this))},syncUI:function(){this.hide().set("bodyContent",this.get("bodyContent")||this.get("srcNode").attr("title"))}});g.ATTRS={close:{value:true,validator:d.isBoolean},underlay:{value:"<div/>",setter:b},shadow:{value:true},closeButton:{value:"<a/>",setter:b}};g.prototype={CONTENT_TEMPLATE:"<div/>",CLOSE_TEMPLATE:"<a/>",
_uiCloseChange:function(a){this.get("closeButton").toggle(a.newVal)},_onCloseButton:function(a){a.preventDefault();this.fire("close")&&this.hide()},_onContextKeyUp:function(a){a.keyCode==27&&this.get("focused")&&this._onCloseButton(a)},renderUI:function(a,c){this.get("closeButton").addClass("container-close").appendTo(c);a.append(this.get(h).addClass(h));this.get("shadow")&&a.addClass("shadow")},bindUI:function(){this._handlers.push(b(b.config.doc).on("keyup",this._onContextKeyUp,this),this.get("closeButton").on("click",
this._onCloseButton,this))}};b.Panel=e.create("panel",b.Overlay,[g]);b.StaticPanel=e.create("panel",b.Module,[g]);b.SimpleDialog=e.create("dialog",b.Panel,[],{ATTRS:{buttons:{value:[]},footerContent:{value:" ",readOnly:true}}},{_bgVisibleChange:function(a){var c=a.newVal?"show":"hide";this.bg[c]();this.bg.each(function(j){j[c]()})},renderUI:function(){var a=this.bg=new b.ButtonGroup({children:this.get("buttons")});a.render(this.get("footer"));a.get("boundingBox").css("visibility","inherit")},bindUI:function(){this.after("visibleChange",
this._bgVisibleChange)}})});
