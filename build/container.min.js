/**
 * @module container
 * @requires base,widget-alignment,widget-stack
 * 
 * Copyright (c) 2011, Juan Ignacio Dopazo. All rights reserved.
 * Code licensed under the BSD License
 * https://github.com/juandopazo/jet/blob/master/LICENSE.md
*/
jet.add("container",function(b){var g=b.Lang,j=b.Array,k=b.DOM,h=b.Base,i=b.Widget,e=jet;b.Module=h.create("module",i,[],{ATTRS:{header:{value:"<div/>",setter:b},body:{value:"<div/>",setter:b},footer:{value:"<div/>",setter:b},headerContent:{validator:g.isValue},bodyContent:{value:"",validator:g.isValue},footerContent:{validator:g.isValue}},EVENTS:{render:function(){var a=this,c=this.get("contentBox");j.each(["header","body","footer"],function(d){var f=a.get(d+"Content");d=a.get(d).addClass(d);if(g.isValue(f)){if(f.nodeType)f=
b(f);f instanceof b.NodeList?d.append(f):d.html(f);d.appendTo(c)}})},headerContentChange:function(a,c){this.get("header").setContent(c)},bodyContentChange:function(a,c){this.get("body").setContent(c)},footerContentChange:function(a,c){this.get("footer").setContent(c)}}},{CONTENT_TEMPLATE:null,initializer:function(){this.set("header",this.get("header"));this.set("body",this.get("body"));this.set("footer",this.get("footer"))}});if(!e.overlays)e.overlays=[];if(!g.isNumber(e.ovZindex))e.ovZindex=10;b.Overlay=
h.create("overlay",b.Module,[b.WidgetAlignment,b.WidgetStack],{ATTRS:{draggable:{validator:function(){return!!b.Drag},value:false,writeOnce:true},modal:{value:false,writeOnce:true},startZIndex:{getter:function(){return e.overlays.length-1},readOnly:true},modalBox:{setter:b}},EVENTS:{render:function(){var a=b(this.get("win")),c=this.get("boundingBox"),d=k.screenSize(),f=this.get("startZIndex");this.get("modalBox").css({position:"absolute",top:"0px",left:"0px",background:"#000",visibility:!this.get("modal")?
"hidden":"",zIndex:e.ovZindex+f-1,opacity:0.4}).width(d.width).height(d.height).appendTo(b.config.doc.body);this._handlers.push(a.on("resize",this._resizeModal,this));c.css("zIndex",e.ovZindex+f);this.on("mousedown",this.focus,this)},afterRender:function(){var a=this.get("boundingBox"),c=this.get("header");if(this.get("draggable"))this.dd=new b.Drag({node:a,handlers:c})},focus:function(){j.remove(this,e.overlays);e.overlays.push(this);var a=e.overlays,c,d=a.length;for(c=0;c<d;c++)a[c].get("boundingBox").css("zIndex",
e.ovZindex+c)},hide:function(){this.get("modalBox").hide()},show:function(){this.get("modal")&&this.get("modalBox").show()},destroy:function(){var a=b(this.get("win")).unbind("resize",this._centerUI).unbind("scroll",this._centerUI);a.unbind("resize",this._repositionUI);a.unbind("scroll",this._repositionUI);this.dd&&this.dd.destroy();this.get("boundingBox").unbind("mousedown",this.focus)}}},{MODAL_TEMPLATE:"<div/>",_resizeModal:function(){var a=k.screenSize();this.get("modalBox").width(a.width).height(a.height)},
initializer:function(){e.overlays.push(this);this.set("modalBox",this.MODAL_TEMPLATE)}});b.Tooltip=h.create("tooltip",i,[b.WidgetAlignment],{ATTRS:{align:{points:["tl","bl"]},fadeIn:{value:false,validator:function(){return!!b.Tween}}},EVENTS:{render:function(){var a=this.get("srcNode"),c=this.get("align").points;this.set("align",{node:a,points:c});this.hide().set("bodyContent",this.get("bodyContent")||a.attr("title"));a.on("mouseover",this.show).on("mouseout",this.hide)},show:function(){var a=this.get("srcNode").offset(),
c=this.get("fadeIn");this.set("left",a.left).set("top",a.top+a.height);c&&this.get("boundingBox").css("opacity",0).fadeIn(c)}}});i=b.mix(function(){},{ATTRS:{close:{value:true,validator:g.isBoolean},underlay:{setter:b},shadow:{value:true},closeButton:{value:"<a/>",setter:b}},EVENTS:{render:function(){this.get("height");var a=this.get("contentBox"),c=this.get("closeButton").attr("href","#").addClass("container-close"),d=this.get("boundingBox");c.on("click",this._onCloseButton,this);c.appendTo(a);d.append(this.get("underlay"));
this.get("shadow")&&d.addClass("shadow");b(this.get("doc")).on("keyup",this._onContextKeyUp)},destroy:function(){b(this.get("doc")).unbind("keyup",this._onContextKeyUp)},afterCloseChange:function(a,c){var d=this.get("closeButton");c?d.show():d.hide()}}});i.prototype={CONTENT_TEMPLATE:"<div/>",CLOSE_TEMPLATE:"<a/>",_onCloseButton:function(a){a.preventDefault();this.fire("close")&&this.hide()},_onContextKeyUp:function(a){a.keyCode==27&&this.get("focused")&&this._onCloseButton(a)}};b.Panel=h.create("panel",
b.Overlay,[i],{},{initializer:function(){var a=this;this.set("closeButton",this.get("closeButton"));this.on("heightChange",function(c,d){a.get("contentBox").height(d)});this.set("underlay",b("<div/>").addClass("underlay"))}});b.StaticPanel=h.create("panel",b.Module,[i],{},{initializer:function(){var a=this;this.set("closeButton",this.get("closeButton"));this.on("heightChange",function(c,d){a.get("contentBox").height(d)});this.set("underlay",b("<div/>").addClass("underlay"))}});b.SimpleDialog=h.create("dialog",
b.Panel,[],{ATTRS:{buttons:{value:[]},footerContent:{value:" ",readOnly:true}},EVENTS:{render:function(){var a=this.bg=new b.ButtonGroup({children:this.get("buttons")});a.render(this.get("footer"));a.get("boundingBox").css("visibility","inherit")},afterHide:function(){this.bg.hide();this.bg.each(function(a){a.hide()})},afterShow:function(){this.bg.show();this.bg.each(function(a){a.show()})}}})});
