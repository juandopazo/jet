/*
 Copyright (c) 2010, Juan Ignacio Dopazo. All rights reserved.
 Code licensed under the BSD License
 http://code.google.com/p/jet-js/wiki/Licence
*/
jet().add("container",function(c){var j=c.Lang,z=c.Hash,s=c.Array,p=c.DOM,t=c.UA.support.fixed,n=function(){n.superclass.constructor.apply(this,arguments);var a=this,i={},h=function(d){return function(b){var e=i[d];e||(e=c("<div/>"));e.children().remove();j.isString(b)?e.html(b):e.append(b);return i[d]=e}};a.addAttrs({header:{setter:h("header"),validator:j.isValue},body:{value:"",setter:h("body"),validator:j.isValue},footer:{setter:h("footer"),validator:j.isValue}});a.set("className",n.NAME);a.on("render",
function(){var d=a.get("boundingBox");z.each(i,function(b,e){e.addClass(b).appendTo(d)})})};n.NAME="module";c.extend(n,c.Widget);if(!jet.overlays)jet.overlays=[];if(!j.isNumber(jet.ovZindex))jet.ovZindex=10;var o=function(){o.superclass.constructor.apply(this,arguments);var a=this;this.addAttrs({center:{value:true},fixed:{value:false},width:{value:300,validator:j.isNumber},height:{value:0,validator:j.isNumber},top:{validator:j.isNumber,setter:function(b){a.unset("bottom");return b}},left:{validator:j.isNumber,
setter:function(b){a.unset("right");return b}},bottom:{validator:j.isNumber,setter:function(b){a.unset("top");return b}},right:{validator:j.isNumber,setter:function(b){a.unset("left");return b}},draggable:{validator:function(){return!!c.Drag},value:false},modal:{value:false}});a.set("className",o.NAME);jet.overlays.push(this);var i=jet.overlays.length-1,h=function(b){var e=p.screenSize(),f=a.get("rendered");b.css({left:(e.width-(f?b.width():a.get("width")))/2+"px",top:(e.height-(f?b.height():a.get("height")))/
2+"px"})};s.each(["height","width"],function(b){a.on(b+"Change",function(e,f){var g=a.get("boundingBox")[b](f);a.get("center")&&h(g)})});var d=function(){var b=a.get("boundingBox"),e=c(c.context.body).currentStyle();s.each(["left","top","bottom","right"],function(f){var g=f.substr(0,1).toUpperCase()+f.substr(1);g=c.pxToFloat(e["padding"+g])+c.pxToFloat(e["margin"+g]);if(t)b.css(f,a.isSet(f)?a.get(f)-g+"px":"auto");else{var l=p.screenSize();switch(f){case "bottom":b.css(a.isSet(f)?"top":"bottom",a.isSet(f)?
l.height-a.get("height")-g+b.scrollTop()+"px":"auto");break;case "right":b.css(a.isSet(f)?"left":"right",a.isSet(f)?l.width-a.get("width")-g+b.scrollLeft()+"px":"auto");break;case "left":b.css(f,a.isSet(f)?a.get(f)+p.scrollLeft()-g+"px":"auto");break;case "top":b.css(f,a.isSet(f)?a.get(f)+p.scrollTop()-g+"px":"auto");break}}})};a.on("render",function(){var b=c(c.win),e=a.get("boundingBox"),f=a.get("header"),g=a.get("body"),l=a.get("footer"),k=a.get("fixed")&&t?"fixed":"absolute",w=a.get("height"),
x=p.screenSize(),u=c("<div/>").css({position:k,top:"0px",left:"0px",background:"#000",visibility:!a.get("modal")?"hidden":"",zIndex:jet.ovZindex+i-1,opacity:0.4}).width(x.width).height(x.height).appendTo(c.context.body);b.on("resize",function(){var y=p.screenSize();u.width(y.width).height(y.height)});a.on("hide",function(){u.hide()}).on("show",function(){a.get("modal")&&u.show()});f&&e.append(f);g&&e.append(g);l&&e.append(l);e.css({position:k,zIndex:jet.ovZindex+i}).width(a.get("width")).on("mousedown",
function(){a.focus()});w&&e.height(w);d()});a.on("afterRender",function(){var b=a.get("boundingBox"),e=c(c.win),f=a.get("header"),g=a.get("fixed");if(a.get("draggable"))a.dd=new c.Drag({node:b,handlers:f});if(a.get("center")){h(b);e.on("resize",function(){h(a.get("boundingBox"))});if(g||!t)c(c.win).on("scroll",function(){h(a.get("boundingBox"))});a.on("afterShow",function(){h(b)})}else g&&!t&&e.on("scroll",d).on("resize",d)});this.on("focus",function(){s.remove(a,jet.overlays);jet.overlays.push(a);
var b=jet.overlays,e,f=b.length;for(e=0;e<f;e++)b[e].get("boundingBox").css("zIndex",jet.ovZindex+e)})};o.NAME="overlay";c.extend(o,n);var v=function(){v.superclass.constructor.apply(this,arguments);this.addAttrs({position:{value:"r"},fadeIn:{value:false,validator:function(){return!!c.Tween}}});this.on("render",function(){this.hide().set("body",this.get("body")||this.get("srcNode").attr("title"));this.get("srcNode").on("mouseover",this.show).on("mouseout",this.hide)});this.on("show",function(){var a=
this.get("srcNode").offset();this.set("left",a.left).set("top",a.top+a.height);this.get("fadeIn")&&this.get("boundingBox").css("opacity",0).fadeIn(this.get("fadeIn"))})};c.extend(v,o);var m=function(){m.superclass.constructor.apply(this,arguments);var a=this.set("className",m.NAME).addAttrs({contentBox:{readOnly:true,value:c("<div/>")},underlay:{readOnly:true,value:c("<div/>").addClass("underlay")},shadow:{value:true}}).on("heightChange",function(d,b){a.get("contentBox").height(b)}),i=function(d){a.fire("close")&&
a.hide();d.preventDefault()},h=c("<a/>").attr("href","#").addClass("container-close").on("click",i);c(c.context).on("keyup",function(d){d.keyCode==27&&a.get("focused")&&i(d)});a.addAttr("close",{value:true,validator:j.isBoolean,setter:function(d){d?h.show():h.hide();return d}}).on("render",function(){var d=a.get("height"),b=a.get("contentBox");d&&b.height(d);d=a.get("classPrefix");for(var e=a.get("boundingBox").addClass(d+m.NAME+"-container"),f=a.get("header"),g=a.get("body"),l=a.get("footer"),k=
m;k.NAME;){b.addClass(d+k.NAME);k=k.superclass.constructor}f&&b.append(f.remove(true));g&&b.append(g.remove(true));l&&b.append(l.remove(true));a.get("close")&&h.appendTo(b);b.appendTo(e).css("visibility","inherit");e.append(a.get("underlay"));a.get("shadow")&&e.addClass("shadow")})};m.NAME="panel";c.extend(m,o);var q=function(){q.superclass.constructor.apply(this,arguments);var a=this.set("className",q.NAME).addAttrs({contentBox:{readOnly:true,value:c("<div/>")},underlay:{readOnly:true,value:c("<div/>").addClass("underlay")},
shadow:{value:true}}).on("heightChange",function(d,b){a.get("contentBox").height(b)}),i=function(d){a.fire("close")&&a.hide();d.preventDefault()},h=c("<a/>").attr("href","#").addClass("container-close").on("click",i);c(c.context).on("keyup",function(d){d.keyCode==27&&a.get("focused")&&i(d)});a.addAttr("close",{value:true,validator:j.isBoolean,setter:function(d){d?h.show():h.hide();return d}}).on("render",function(){var d=a.get("height"),b=a.get("contentBox");d&&b.height(d);d=a.get("classPrefix");
for(var e=a.get("boundingBox").addClass(d+m.NAME+"-container"),f=a.get("header"),g=a.get("body"),l=a.get("footer"),k=q;k.NAME;){b.addClass(d+k.NAME);k=k.superclass.constructor}f&&b.append(f.remove(true));g&&b.append(g.remove(true));l&&b.append(l.remove(true));a.get("close")&&h.appendTo(b);b.appendTo(e).css("visibility","inherit");e.append(a.get("underlay"));a.get("shadow")&&e.addClass("shadow")})};q.NAME="panel";c.extend(q,n);var r=function(){r.superclass.constructor.apply(this,arguments);var a=this;
a.addAttrs({footer:{readOnly:true,value:c("<div/>").addClass("footer")},buttons:{validator:j.isArray,value:[]}}).set("className",r.NAME);a.on("render",function(){a.get("boundingBox").addClass(a.get("classPrefix")+r.NAME);var i=c("<div/>").addClass("button-group");s.each(a.get("buttons"),function(h,d){var b=new c.Button(h);d===0&&b.get("boundingBox").addClass("default");b.on("pressed",function(){a.hide()}).render(i)});a.get("footer").append(i)})};r.NAME="dialog";c.extend(r,m);c.add({Module:n,Overlay:o,
Tooltip:v,Panel:m,StaticPanel:q,SimpleDialog:r})});
