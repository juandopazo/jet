/*
 Copyright (c) 2010, Juan Ignacio Dopazo. All rights reserved.
 Code licensed under the BSD License
 http://code.google.com/p/jet-js/wiki/Licence
*/
jet().add("dragdrop",function(b){var o=b.Array,r=b.Lang,l=function(){l.superclass.constructor.apply(this,arguments);var a=this.addAttrs({node:{required:true,setter:function(f){return b(f)}},cursor:{value:"move"},tracking:{value:false}});a.addAttr("handlers",{setter:function(f){return b(f)}});var g,c,h,i,j,k,d=new b.utils.Mouse({shim:a.get("shim")}),m=function(f){f.css("cursor",a.get("cursor")).on("mousedown",function(e){e.preventDefault();g=e.clientX;c=e.clientY;if(a.fire("drag:start",g,c)){e=b(this).offset();
h=e.left;i=e.top;d.set("tracking",true)}})};a.addHandler=function(f){m(b(f));return a};var p=a.get("handlers");p?m(p):m(a.get("node"));b(b.context).on("mouseup",function(){d.set("tracking",false)});var q=true;d.on("trackingChange",function(f,e){!q&&e===false&&a.fire("drag:end",j,k);q=false});var s=a.get("node");d.on("mousemove",function(f,e,t){j=h+e-g;k=i+t-c;a.fire("drag",j,k)&&s.css({left:j+"px",top:k+"px"})})};l.NAME="drag";b.extend(l,b.Base);var n=function(){n.superclass.constructor.apply(this,
arguments);var a=this.addAttrs({targets:{validator:r.isArray,value:[],setter:function(c){o.each(c,function(h,i){c[i]=b(h)});return c}}}),g=[];a.addTarget=function(c){g[g.length]=b(c);return a};a.on("end",function(c,h,i){c=a.get("targets").concat(g);var j=false;o.each(c,function(k){var d=k.offset();if(h>d.left&&h<d.left+d.width&&i>d.top&&i<d.top+d.height){a.fire("drop:hit",k);j=true}});j||a.fire("drop:miss")})};b.extend(n,l);b.add({Drag:l,DragDrop:n})});
