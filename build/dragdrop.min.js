/**
 * @module dragdrop
 * @requires base
 * 
 * Copyright (c) 2011, Juan Ignacio Dopazo. All rights reserved.
 * Code licensed under the BSD License
 * https://github.com/juandopazo/jet/blob/master/LICENSE.md
*/
jet.add("dragdrop",function(b){var o=b.Array,r=b.Lang,l=function(){l.superclass.constructor.apply(this,arguments);var a=this.addAttrs({node:{required:true,setter:function(f){return b(f)}},cursor:{value:"move"},tracking:{value:false},context:{value:b.context}});a.addAttr("handlers",{setter:function(f){return b(f)}});var g,c,h,i,j,k,e=new b.Mouse({shim:a.get("shim"),context:a.get("context")}),m=function(f){f.css("cursor",a.get("cursor")).on("mousedown",function(d){d.preventDefault();g=d.clientX;c=d.clientY;
if(a.fire("drag:start",g,c)){d=b(this).offset();h=d.left;i=d.top;e.set("tracking",true)}})};a.addHandler=function(f){m(b(f));return a};var p=a.get("handlers");p?m(p):m(a.get("node"));var q=true;e.on("trackingChange",function(f,d){!q&&d===false&&a.fire("drag:end",j,k);q=false});var s=a.get("node");e.on("mousemove",function(f,d,t){j=h+d-g;k=i+t-c;a.fire("drag",j,k)&&s.css({left:j+"px",top:k+"px"})});a.on("contextChange",function(f,d){e.set("context",d)})};l.NAME="drag";b.extend(l,b.Base);var n=function(){n.superclass.constructor.apply(this,
arguments);var a=this.addAttrs({targets:{validator:r.isArray,value:[],setter:function(c){o.each(c,function(h,i){c[i]=b(h)});return c}}}),g=[];a.addTarget=function(c){g[g.length]=b(c);return a};a.on("end",function(c,h,i){c=a.get("targets").concat(g);var j=false;o.each(c,function(k){var e=k.offset();if(h>e.left&&h<e.left+e.width&&i>e.top&&i<e.top+e.height){a.fire("drop:hit",k);j=true}});j||a.fire("drop:miss")})};b.extend(n,l);b.add({Drag:l,DragDrop:n})});
