/**
 * @module progressbar
 * @requires base
 * 
 * Copyright (c) 2011, Juan Ignacio Dopazo. All rights reserved.
 * Code licensed under the BSD License
 * https://github.com/juandopazo/jet/blob/master/LICENSE.md
*/
jet.add("progressbar",function(d){d.ProgressBar=d.Base.create("progressbar",d.Widget,[],{ATTRS:{minValue:{value:0},maxValue:{value:100},value:{value:0},width:{value:200},height:{value:20},direction:{value:"ltr",writeOnce:true},animate:{value:false,writeOnce:true,validator:function(){return!!d.Tween}},easing:{},duration:{value:500},bar:{readOnly:true,value:d("<span/>")}}},{_afterValueChange:function(a){this.fire("progress",{value:a.newVal})?this._update(a.newVal):a.preventDefault()},_afterDirectionChange:function(a){this.get("boundingBox").removeClass(this.getClassName(a.prevVal)).addClass(this.getClassName(a.newVal))},
renderUI:function(a,c){var b=this.get("direction"),e=this.get("bar").appendTo(c).addClass(this.getClassName("bar"));this._text.addClass(this.getClassName("text")).appendTo(c);a.addClass(this.getClassName(b));b=="ltr"?e.height(this.get("height")):e.width(this.get("width"))},_onTween:function(a){this.fire("progress",{value:a.value})||a.preventDefault()},_onTweenEnd:function(){this.fire("end")},_update:function(a){var c=this.get("minValue");a=(a-c)/(this.get("maxValue")-c);var b=this.get("bar");c=this.get("width");
var e=this.get("height"),f=this.get("direction"),g=this.get("easing"),h=this.get("duration");this._text.html(Math.round(a*100)+"%");if(this.get("animate")){if(this._tween){this._tween.unbind("tween",this._onTween);this._tween.unbind("end",this._onTweenEnd);this._tween.destroy()}b=this._tween=new d.Tween({node:b,duration:h,easing:g});b.on("tween",this._onTween,this);b.on("end",this._onTweenEnd,this);switch(f){case "ttb":case "btt":b.set("to",{height:e*a});break;default:b.set("to",{width:c*a})}b.play()}else{switch(f){case "ttb":case "btt":a*=
e;b.height(a);break;default:a*=c;b.width(a)}this.fire("progress",{value:a});this.fire("end")}},initializer:function(){this._text=d("<span/>").html("0%");this.after("valueChange",this._afterValueChange);this.after("directionChange",this._afterDirectionChange);this.after("textChange",this._afterTextChange)}})});
