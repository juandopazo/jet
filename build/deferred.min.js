/**
 * @module deferred
 * @requires oop
 * 
 * Copyright (c) 2011, Juan Ignacio Dopazo. All rights reserved.
 * Code licensed under the BSD License
 * https://github.com/juandopazo/jet/blob/master/LICENSE.md
*/
jet.add("deferred",function(g){function e(a,b){this._done=this._spread(a);this._fail=this._spread(b)}function j(){}var h=g.Lang,k=Array.prototype,d=k.slice,i=k.push;e.prototype={_spread:function(a){a=h.isArray(a)?a:[a];for(var b=0;b<a.length;)if(h.isArray(a[b])){i.apply(a,a[b]);a.splice(b,1)}else if(h.isValue(a[b]))b++;else a.splice(b,1);return a},then:function(a,b){i.apply(this._done,this._spread(a));i.apply(this._fail,this._spread(b));return this},done:function(){return this.then(d.call(arguments))},
fail:function(){return this.then(null,d.call(arguments))},resolve:function(){return this._notify(this._done,d.call(arguments))},reject:function(){return this._notify(this._fail,d.call(arguments))},resolveWith:function(a){return this._notify(this._done,d.call(arguments,1),a)},rejectWith:function(a){return this._notify(this._fail,d.call(arguments,1),a)},_notify:function(a,b,c){for(var f=0,l=a.length;f<l;f++)a[f].apply(c||this,b);return this}};j.prototype={then:function(a,b){this._promise?this._promise.then(a,
b):this._notify(a);return this},done:e.prototype.done,fail:e.prototype.fail,promise:function(a){function b(){f._currPromise=c}var c=new e,f=this;if(this._promise)this._promise.then([g.bind(a,c,c),b],b);else{a.call(c,c);this._currPromise=c}this._promise=c;return this},resolve:function(){var a=this._currPromise;a&&a.resolve.apply(a,arguments)},reject:function(){var a=this._currPromise;a&&a.reject.apply(a,arguments)},_notify:e.prototype._notify};g.Deferred=j});
