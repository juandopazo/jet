/*
 Copyright (c) 2010, Juan Ignacio Dopazo. All rights reserved.
 Code licensed under the BSD License
 http://code.google.com/p/jet-js/wiki/Licence
*/
jet().add("vector",function(d){var x=d.Lang,E=d.Hash,i=d.Array,y=Array.prototype.slice,e=!d.UA.ie||d.UA.ie>8,z=function(a){var b=parseInt(a,10);return x.isValue(b)?b:a},F=function(a){return a.toString(16)},G=function(a){return parseInt(a,16)},n;try{document.namespaces.vml||document.namespaces.add("vml","urn:schemas-microsoft-com:vml");n=function(a){return d.context.createElement("<vml:"+a+' class="vml">')}}catch(L){n=function(a){return d.context.createElement("<"+a+' xmlns="urn:schemas-microsoft.com:vml" class="vml">')}}if(!e){var m=
d.context.createStyleSheet();m.addRule(".vml","behavior:url(#default#VML)");m.addRule(".vml","display:inline-block")}var q={},r=["width","height","left","top"];m=["x","y","rx","ry","xmlns","version","fill","opacity"].concat(r);var j={fill:"fillcolor",x:"left",y:"top",cx:"left",cy:"top"};if(e)m=m.concat(r);var k=function(a){return e?function(){return z(this.get("node").getAttribute(a))}:i.inArray(a,r)?function(){return z(this.get("node").style[a])}:function(){return z(this.get("node")[a])}},o=function(a){return e?
function(b){this.get("node").setAttribute(a,b);return b}:i.inArray(a,r)?function(b){return this.get("node").style[a]=b}:function(b){return this.get("node")[a]=b}};i.each(m,function(a){var b=!e&&j[a]?j[a]:a;q[a]={getter:k(b),setter:o(b)}});var A={stroke:"color","stroke-width":"weight","stroke-opacity":"opacity","stroke-linecap":"endcap","stroke-linejoin":"joinstyle","stroke-miterlimit":"miterlimit","stroke-dasharray":"dashstyle"},I=function(a){return e?function(){this.get("node").getAttribute(a)}:
function(){return this.get("stroke")[A[a]]}},J=function(a){return e?function(b){this.get("node").setAttribute(a,b);return b}:function(b){var c=this.get("stroke-node");c.on=true;return c[A[a]]=b}};E.each(A,function(a){q[a]={getter:I(a),setter:J(a)}});var h=e?function(){h.superclass.constructor.apply(this,arguments);var a=this,b;a.addAttr("node",{required:true,writeOnce:true,getter:function(){return b},setter:function(c){return b=c.nodeType?c:d.context.createElementNS("http://www.w3.org/2000/svg",c)}});
b=a.get("node");i.each(["on","unbind","unbindAll"],function(c){a[c]=function(f,g){d(b)[c](f,g);return a}});a.addAttrs(q).addAttr("fill-opacity",{getter:function(){return this.get("node").getAttribute("fill-opacity")},setter:function(c){this.get("node").setAttribute("opacity",c);return c}})}:function(){h.superclass.constructor.apply(this,arguments);var a=this;a.addAttr("node",{required:true,writeOnce:true,getter:function(){return a.node},setter:function(g){a.node=g.nodeType?g:n(g);return a.node}});
var b=n("stroke");b.on=false;a.set("stroke-node",b);var c=n("fill");a.set("fill-node",c);var f=a.get("node");f.style.position="absolute";f.appendChild(b);f.appendChild(c);i.each(["on","unbind","unbindAll"],function(g){a[g]=function(B,K){d(f)[g](B,K);return a}});a.addAttrs(q).addAttr("fill-opacity",{getter:function(){return this.get("fill-node").opacity},setter:function(g){return this.get("fill-node").opacity=g}})};d.extend(h,d.Attribute,{translate:function(){},scale:function(){},append:function(a){this.get("node").appendChild(a.get("node"));
return this},appendTo:function(a){a=a instanceof d.NodeList?a[0]:a instanceof h?a.get("node"):a;a.appendChild(this.get("node"));return this},remove:function(){var a=this.get("node");a.parentNode&&a.parentNode.removeChild(a);d(a).unbindAll();return this},detach:function(){var a=this.get("node");a.parentNode&&a.parentNode.removeChild(a);return this},css:function(a,b){var c=this.get("node"),f={};if(x.isHash(a))f=a;else if(x.isValue(b))f[a]=b;else return d(c).currentStyle()[a];E.each(f,function(g,B){c.style[g]=
B});return this},hide:function(){var a=this.get("node"),b=a.style.display;if(!a.JET_oDisplay&&b!="none")a.JET_oDisplay=b;a.style.display="none";return this},show:function(){var a=this.get("node");a.style.display=a.JET_oDisplay||"";return this},hasClass:function(a){a=this.get("node");a=e?a.getAttribute("class"):a.className;return i.inArray(a,a?a.split(" "):[])},removeClass:function(){var a=y.call(arguments),b=this.get("node"),c=e?b.getAttribute("class"):b.className,f=c?c.split(" "):[];i.each(a,function(g){i.remove(g,
f)});if(e)b.setAttribute("class",f.join(" "));else b.className=f.join(" ");return this},addClass:function(){var a=y.call(arguments),b=this.get("node"),c=e?b.getAttribute("class"):b.className,f=c?c.split(" "):[];i.each(a,function(g){i.inArray(g,f)||(f[f.length]=g)});if(e)b.setAttribute("class",f.join(" "));else b.className=f.join(" ");return this},toggleClass:function(a){y.call(arguments);var b=this.get("node"),c=e?b.getAttribute("class"):b.className;c=c?c.split(" "):[];if(i.inArray(a,c))i.remove(a,
c);else c[c.length]=a;if(e)b.setAttribute("class",c.join(" "));else b.className=c.join(" ");return this}});var p=function(a){a.node=a.node&&a.node=="roundrect"?"roundrect":"rect";p.superclass.constructor.apply(this,arguments)};d.extend(p,h,{rotate:e?function(a){this.node.setAttribute("transform","rotate("+a+" "+(this.get("x")+this.get("width")/2)+" "+(this.get("y")+this.get("height")/2)+")");return this}:function(){}});var H=function(a){a.node=e?"rect":"roundrect";H.superclass.constructor.apply(this,
arguments)};d.extend(H,p);var C=function(a){a.node=a.node&&a.node=="circle"?"circle":e?"ellipse":"oval";C.superclass.constructor.apply(this,arguments);var b=this.addAttrs({rx:{getter:e?function(){return this.get("node").getAttribute("rx")}:function(){return d.pxToFloat(this.get("node").style.width)/2},setter:e?function(c){this.get("node").setAttribute("rx",c);return c}:function(c){this.get("node").style.width=c*2;return c}},ry:{getter:e?function(){return this.get("node").getAttribute("ry")}:function(){return d.pxToFloat(this.get("node").style.width)/
2},setter:e?function(c){this.get("node").setAttribute("ry",c);return c}:function(c){this.get("node").style.height=c*2;return c}}});b.addAttrs({cx:{getter:k(!e&&j.cx?j.cx:"cx"),setter:e?function(c){this.get("node").setAttribute("cx",c);return c}:function(c){this.get("node").style.left=c-d.pxToFloat(b.get("rx"))+"px";return c}},cy:{getter:k(!e&&j.cy?j.cy:"cy"),setter:e?function(c){this.get("node").setAttribute("cy",c);return c}:function(c){this.get("node").style.top=c-d.pxToFloat(b.get("ry"))/2+"px";
return c}}})};d.extend(C,h);var s=function(a){a.node=e?"circle":"oval";s.superclass.constructor.apply(this,arguments);var b=this.addAttrs({r:{getter:e?function(){return this.get("node").getAttribute("r")}:function(){return this.get("node").style.width},setter:e?function(c){this.get("node").setAttribute("r",c);return c}:function(c){var f=this.get("node").style;f.width=c*2;f.height=c*2;return c}}}).addAttrs({cx:{getter:k(!e&&j.cx?j.cx:"cx"),setter:e?function(c){this.get("node").setAttribute("cx",c);
return c}:function(c){this.get("node").style.left=c-d.pxToFloat(b.get("r"))/2+"px";return c}},cy:{getter:k(!e&&j.cy?j.cy:"cy"),setter:e?function(c){this.get("node").setAttribute("cy",c);return c}:function(c){this.get("node").style.top=c-d.pxToFloat(b.get("r"))/2+"px";return c}}})};d.extend(s,h);var D=function(a){a.node="line";D.superclass.constructor.apply(this,arguments);this.addAttrs({x1:{getter:k("x1"),setter:o("x1")},x2:{getter:k("x2"),setter:o("x2")},y1:{getter:k("y1"),setter:o("y1")},y2:{getter:k("y2"),
setter:o("y2")}})};d.extend(D,h);var t=function(){t.superclass.constructor.call(this,"Image")};d.extend(t,h);var u=function(a){u.superclass.constructor.call(this,"text");this.attr(a)};d.extend(u,h);var v=function(){v.superclass.constructor.call(this,"path")};d.extend(v,h);var w=e?function(){w.superclass.constructor.apply(this,arguments);var a=new h({node:"svg",xmlns:"http://www.w3.org/2000/svg",version:"1.1"});this.addAttrs({width:{setter:function(b){a.set("width",b);return b}},height:{setter:function(b){a.set("height",
b);return b}},boundingBox:{readOnly:true,getter:function(){return a}},className:{value:"vectorview"}})}:function(){w.superclass.constructor.apply(this,arguments);var a=d("<div/>").css({position:"relative",overflow:"hidden"});this.addAttrs({width:{setter:function(b){a.css("width",b);return b}},height:{setter:function(b){a.css("height",b);return b}},boundingBox:{readOnly:true,getter:function(){return a}},className:{value:"vectorview"}})},l=function(a,b){return a.set("vector",b).appendTo(b.get("boundingBox"))};
d.extend(w,d.Widget,{rectangle:function(a){return l(new p(a),this)},circle:function(a){return l(new s(a),this)},ellipse:function(a){return l(new C(a),this)},image:function(a){return l(new t(a),this)},text:function(a){return l(new u(a),this)},line:function(a){return l(new D(a),this)},path:function(a){return l(new v(a),this)},clear:function(){this.get("boundingBox").children().remove()}});d.mix(h,{Circle:s,Rectangle:p,Image:t,Text:u,Path:v,decToHex:F,hexToDec:G,colorHexToArray:function(a){if(a.substr(0,
1)=="#")a=a.substr(1);a=a.length==3?[a.substr(0,1)+a.substr(0,1),a.substr(1,1)+a.substr(1,1),a.substr(2,1)+a.substr(2,1)]:[a.substr(0,2),a.substr(2,2),a.substr(4,2)];i.each(a,function(b,c){a[c]=G(b)});return a},colorArrayToHex:function(a){for(var b=0;b<3;b++){a[b]=F(a[b]);if(a[b]<10)a[b]="0"+a[b]}return"#"+a.join("")}});d.add({VectorView:w,Vector:h})});
