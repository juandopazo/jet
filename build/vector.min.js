/*
 Copyright (c) 2010, Juan Ignacio Dopazo. All rights reserved.
 Code licensed under the BSD License
 http://code.google.com/p/jet-js/wiki/Licence
*/
jet().add("vector",function(d){var E=d.Lang,F=d.Hash,k=d.Array,e=!d.UA.ie||d.UA.ie>8,G=d.NodeList.prototype,x=function(a){var b=parseInt(a,10);return E.isValue(b)?b:a},B=function(a){return a.toString(16)},C=function(a){return parseInt(a,16)},n;try{document.namespaces.vml||document.namespaces.add("vml","urn:schemas-microsoft-com:vml");n=function(a){return d.context.createElement("<vml:"+a+' class="vml">')}}catch(L){n=function(a){return d.context.createElement("<"+a+' xmlns="urn:schemas-microsoft.com:vml" class="vml">')}}if(!e){var m=
d.context.createStyleSheet();m.addRule(".vml","behavior:url(#default#VML)");m.addRule(".vml","display:inline-block")}var q={},r=["width","height","left","top"];m=["x","y","rx","ry","xmlns","version","fill","opacity"].concat(r);var g={fill:"fillcolor",x:"left",y:"top",cx:"left",cy:"top"};if(e)m=m.concat(r);var i=function(a){return e?function(){return x(this.node.getAttribute(a))}:k.inArray(a,r)?function(){return x(this.node.style[a])}:function(){return x(this.node[a])}},o=function(a){return e?function(b){this.node.setAttribute(a,
b);return b}:k.inArray(a,r)?function(b){return this.node.style[a]=b}:function(b){return this.node[a]=b}};k.each(m,function(a){var b=!e&&g[a]?g[a]:a;q[a]={getter:i(b),setter:o(b)}});var y={stroke:"color","stroke-width":"weight","stroke-opacity":"opacity","stroke-linecap":"endcap","stroke-linejoin":"joinstyle","stroke-miterlimit":"miterlimit","stroke-dasharray":"dashstyle"},H=function(a){return e?function(){this.node.getAttribute(a)}:function(){return this.get("stroke")[y[a]]}},I=function(a){return e?
function(b){this.node.setAttribute(a,b);return b}:function(b){var c=this.get("stroke-node");c.on=true;return c[y[a]]=b}};F.each(y,function(a){q[a]={getter:H(a),setter:I(a)}});var f=e?function(){f.superclass.constructor.apply(this,arguments);var a=this,b;a.addAttr("node",{required:true,writeOnce:true,getter:function(){return b},setter:function(c){return b=c.nodeType?c:d.context.createElementNS("http://www.w3.org/2000/svg",c)}});b=a.get("node");k.each(["on","unbind","unbindAll"],function(c){a[c]=function(j,
h){d(b)[c](j,h);return a}});a.addAttrs(q).addAttr("fill-opacity",{getter:function(){return this.get("node").getAttribute("fill-opacity")},setter:function(c){this.get("node").setAttribute("opacity",c);return c}})}:function(){f.superclass.constructor.apply(this,arguments);var a=this;a.addAttr("node",{required:true,writeOnce:true,getter:function(){return a.node},setter:function(h){a.node=h.nodeType?h:n(h);return a.node}});var b=n("stroke");b.on=false;a.set("stroke-node",b);var c=n("fill");a.set("fill-node",
c);var j=a.get("node");j.style.position="absolute";j.appendChild(b);j.appendChild(c);k.each(["on","unbind","unbindAll"],function(h){a[h]=function(J,K){d(j)[h](J,K);return a}});a.addAttrs(q).addAttr("fill-opacity",{getter:function(){return this.get("fill-node").opacity},setter:function(h){return this.get("fill-node").opacity=h}})};d.extend(f,d.Attribute,{translate:function(){},scale:function(){}});k.each(["append","appendTo","remove","css","hide","show","children"],function(a){f.prototype[a]=function(){var b=
G[a].apply(d(this.get("node")),arguments);return d.NodeList.is(b)?this:b}});var p=function(a){a.node=a.node&&a.node=="roundrect"?"roundrect":"rect";p.superclass.constructor.apply(this,arguments)};d.extend(p,f,{rotate:e?function(a){this.node.setAttribute("transform","rotate("+a+" "+(this.get("x")+this.get("width")/2)+" "+(this.get("y")+this.get("height")/2)+")");return this}:function(){}});var D=function(a){a.node=e?"rect":"roundrect";D.superclass.constructor.apply(this,arguments)};d.extend(D,p);var z=
function(a){a.node=a.node&&a.node=="circle"?"circle":e?"ellipse":"oval";z.superclass.constructor.apply(this,arguments);var b=this.addAttrs({rx:{getter:e?function(){return this.node.getAttribute("rx")}:function(){return d.pxToFloat(this.node.style.width)/2},setter:e?function(c){this.node.setAttribute("rx",c);return c}:function(c){this.node.style.width=c*2;return c}},ry:{getter:e?function(){return this.node.getAttribute("ry")}:function(){return d.pxToFloat(this.node.style.width)/2},setter:e?function(c){this.node.setAttribute("ry",
c);return c}:function(c){this.node.style.height=c*2;return c}}});b.addAttrs({cx:{getter:i(!e&&g.cx?g.cx:"cx"),setter:e?function(c){this.node.setAttribute("cx",c);return c}:function(c){this.node.style.left=c-d.pxToFloat(b.get("rx"))+"px";return c}},cy:{getter:i(!e&&g.cy?g.cy:"cy"),setter:e?function(c){this.node.setAttribute("cy",c);return c}:function(c){this.node.style.top=c-d.pxToFloat(b.get("ry"))/2+"px";return c}}})};d.extend(z,f);var s=function(a){a.node=e?"circle":"oval";s.superclass.constructor.apply(this,
arguments);var b=this.addAttrs({r:{getter:e?function(){return this.node.getAttribute("r")}:function(){return this.node.style.width},setter:e?function(c){this.node.setAttribute("r",c);return c}:function(c){var j=this.node.style;j.width=c*2;j.height=c*2;return c}}});b.addAttrs({cx:{getter:i(!e&&g.cx?g.cx:"cx"),setter:e?function(c){this.node.setAttribute("cx",c);return c}:function(c){this.node.style.left=c-d.pxToFloat(b.get("r"))/2+"px";return c}},cy:{getter:i(!e&&g.cy?g.cy:"cy"),setter:e?function(c){this.node.setAttribute("cy",
c);return c}:function(c){this.node.style.top=c-d.pxToFloat(b.get("r"))/2+"px";return c}}})};d.extend(s,f);var A=function(a){a.node="line";A.superclass.constructor.apply(this,arguments);this.addAttrs({x1:{getter:i("x1"),setter:o("x1")},x2:{getter:i("x2"),setter:o("x2")},y1:{getter:i("y1"),setter:o("y1")},y2:{getter:i("y2"),setter:o("y2")}})};d.extend(A,f);var t=function(){t.superclass.constructor.call(this,"Image")};d.extend(t,f);var u=function(a){u.superclass.constructor.call(this,"text");this.attr(a)};
d.extend(u,f);var v=function(){v.superclass.constructor.call(this,"path")};d.extend(v,f);var w=e?function(){w.superclass.constructor.apply(this,arguments);var a=new f({node:"svg",xmlns:"http://www.w3.org/2000/svg",version:"1.1"});this.addAttrs({srcNode:{required:true,setter:d},width:{setter:function(b){a.set("width",b);return b}},height:{setter:function(b){a.set("height",b);return b}},boundingBox:{readOnly:true,getter:function(){return a}}}).get("srcNode").append(a)}:function(){w.superclass.constructor.apply(this,
arguments);var a=d("<div/>").css({position:"relative",overflow:"hidden"});this.addAttrs({srcNode:{required:true,setter:function(b){return d(b)}},width:{setter:function(b){a.css("width",b);return b}},height:{setter:function(b){a.css("height",b);return b}},boundingBox:{readOnly:true,getter:function(){return a}}}).get("srcNode").append(a)},l=function(a,b){return a.set("vector",b).appendTo(b.get("boundingBox"))};d.extend(w,d.TimeFrame,{rectangle:function(a){return l(new p(a),this)},circle:function(a){return l(new s(a),
this)},ellipse:function(a){return l(new z(a),this)},image:function(a){return l(new t(a),this)},text:function(a){return l(new u(a),this)},line:function(a){return l(new A(a),this)},path:function(a){return l(new v(a),this)},clear:function(){this.get("boundingBox").children().remove()}});d.mix(f,{Circle:s,Rectangle:p,Image:t,Text:u,Path:v,decToHex:B,hexToDec:C,colorHexToArray:function(a){if(a.substr(0,1)=="#")a=a.substr(1);a=a.length==3?[a.substr(0,1)+a.substr(0,1),a.substr(1,1)+a.substr(1,1),a.substr(2,
1)+a.substr(2,1)]:[a.substr(0,2),a.substr(2,2),a.substr(4,2)];k.each(a,function(b,c){a[c]=C(b)});return a},colorArrayToHex:function(a){for(var b=0;b<3;b++){a[b]=B(a[b]);if(a[b]<10)a[b]="0"+a[b]}return"#"+a.join("")}});d.add({VectorView:w,Vector:f})});
