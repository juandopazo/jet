/**
 * @module anim
 * @requires node
 * 
 * Copyright (c) 2011, Juan Ignacio Dopazo. All rights reserved.
 * Code licensed under the BSD License
 * https://github.com/juandopazo/jet/blob/master/LICENSE.md
*/
jet.add("anim",function(g){var j=g.Lang,q=g.Hash,r=g.Base,t=g.Array,m=function(a){return!j.isString(a)?a:a.substr(-2,a.length)=="px"?parseFloat(a.substr(0,a.length-2)):parseFloat(a)},n={linear:function(a,b,d,c){return(d-b)*a/c+b},easein:function(a,b,d,c,e){return d-(d-b)*Math.pow((d>=b?-1:1)*(a/c-1),e)},easeout:function(a,b,d,c,e){return b+(d-b)*Math.pow(a/c,e)},sling:function(a,b,d,c,e){b=[b,b+(d<b?1:-1)*e,d];a=a/c;c=b.length;d=[];for(e=0;e<c;++e)d[e]=b[e];for(b=1;b<c;++b)for(e=0;e<c-b;++e)d[e]=
(1-a)*d[e]+a*d[parseInt(e+1,10)];return d[0]}};if(!jet.TimeFrame){var u=function(){var a=[],b,d=false;return{fps:50,play:function(){var c=this;if(!d){b&&clearInterval(b);b=setInterval(function(){c.fire("enterFrame",{time:(new Date).getTime()})},Math.round(1E3/c.fps));d=true}return c},stop:function(){b&&clearInterval(b);d=false;return this},addTween:function(c){a[a.length]=c;return this},removeTween:function(c){t.remove(c,a);return a.length===0?this.stop():this}}}();g.mix(new g.EventTarget,u)}var s=
r.create("tween",r,[],{ATTRS:{node:{setter:g},from:{attribute:false},to:{required:true},easing:{value:n.linear,setter:function(a){return j.isFunction(a)?a:n[a]}},easingStrength:{value:2,validator:function(a){return a>=0}},duration:{value:1E3,setter:function(a){return a=="fast"?500:a=="slow"?4E3:j.isNumber(a)?a:1E3}},playing:{value:false,validator:j.isBoolean},startTime:{value:0},previousTime:{value:0}}},{_enterFrame:function(a){a=a.time;if(this.get("playing")){this.get("startTime")||this.set("startTime",
a);var b=this,d=this.get("easing"),c=this.get("to"),e=this.get("from"),h=this.get("duration"),f=this.get("easingStrength"),o=this.get("node"),p=a-this.get("startTime")+this.get("previousTime");if(p<h)q.each(c,function(k,i){var l=d(p,e[k],i,h,f);if(i>e[k]&&l>i||i<e[k]&&l<i)l=i;if(b.fire("tween",{property:k,value:l}))o.css(k,l);else p=h});else{b.stop();setTimeout(function(){b.fire("end")},0)}}},play:function(){var a=this.get("node"),b=a.currentStyle(),d=this.get("from")||{},c=this.get("to"),e,h=jet.TimeFrame;
if(c.left||c.top)e=a.offset();q.each(c,function(f,o){c[f]=m(o);if(!d[f])switch(f){case "left":d[f]=e.left;break;case "top":d[f]=e.top;break;case "width":d[f]=a.attr("offsetWidth");break;case "height":d[f]=a.attr("offsetHeight");break;default:d[f]=j.isNumber(m(b[f]))?m(b[f]):0}});this.set("from",d);if(this.fire("start")){this.set("playing",true);h.on("enterFrame",this._enterFrame,this);h.addTween(this).play()}return this},stop:function(){this.set("playing",false);var a=jet.TimeFrame;a.removeTween(this);
a.unbind("enterFrame",this._enterFrame);this.set("previousTime",0);return this.set("startTime",0)},pause:function(){this.set("playing",false);var a=jet.TimeFrame;a.removeTween(this);a.unbind("enterFrame",this._enterFrame);return this.set("previousTime",(new Date).getTime()-this.get("startTime"))},reverse:function(){var a=this.get("from");return this.set("from",this.get("to")).set("to",a)}});g.mix(g.NodeList.prototype,{animate:function(a,b,d,c){this.tw=(new s({node:this,to:a,duration:b,easing:d})).on("end",
c).play();return this},fadeIn:function(a,b,d){return this.animate({opacity:1},a,b,d)},fadeOut:function(a,b,d){return this.animate({opacity:0},a,b,d)},fadeToggle:function(a,b,d){return this.each(function(c){c=g(c);c.css("opacity")==1?c.fadeOut(a,b,d):c.fadeIn(a,b,d)})},slideDown:function(a,b,d){var c=this,e=c.css("overflow");return c.css("overflow","hidden").animate({height:c.oHeight},a,b,function(){c.css("overflow",e);d.call(c)})},slideUp:function(a,b,d){var c=this,e=c.css("overflow");return c.css("overflow",
"hidden").animate({height:0},a,b,function(){c.css("overflow",e);d.call(c)})},stop:function(){this.tw&&this.tw.stop();return this}});g.add({Tween:s,Easing:n})});
