/**
 * @module anim
 * @requires node
 * 
 * Copyright (c) 2011, Juan Ignacio Dopazo. All rights reserved.
 * Code licensed under the BSD License
 * https://github.com/juandopazo/jet/blob/master/LICENSE.md
*/
jet.add("anim",function(g){var j=g.Lang,q=g.Hash,r=g.Base,t=g.Array,m=function(a){return!j.isString(a)?a:a.substr(-2,a.length)=="px"?parseFloat(a.substr(0,a.length-2)):parseFloat(a)},n={linear:function(a,d,b,c){return(b-d)*a/c+d},easein:function(a,d,b,c,e){return b-(b-d)*Math.pow((b>=d?-1:1)*(a/c-1),e)},easeout:function(a,d,b,c,e){return d+(b-d)*Math.pow(a/c,e)},sling:function(a,d,b,c,e){d=[d,d+(b<d?1:-1)*e,b];a=a/c;c=d.length;b=[];for(e=0;e<c;++e)b[e]=d[e];for(d=1;d<c;++d)for(e=0;e<c-d;++e)b[e]=
(1-a)*b[e]+a*b[parseInt(e+1,10)];return b[0]}};if(!jet.TimeFrame){var u=function(){var a=[],d,b=false;return{fps:50,play:function(){var c=this;if(!b){d&&clearInterval(d);d=setInterval(function(){c.fire("enterFrame",(new Date).getTime())},Math.round(1E3/c.fps));b=true}return c},stop:function(){d&&clearInterval(d);b=false;return this},addTween:function(c){a[a.length]=c;return this},removeTween:function(c){t.remove(c,a);return a.length===0?this.stop():this}}}();jet.TimeFrame=g.mix(new g.EventTarget,
u)}var s=r.create("tween",r,[],{ATTRS:{node:{setter:g},from:{attribute:false},to:{required:true},easing:{value:n.linear,setter:function(a){return j.isFunction(a)?a:n[a]}},easingStrength:{value:2,validator:function(a){return a>=0}},duration:{value:1E3,setter:function(a){return a=="fast"?500:a=="slow"?4E3:j.isNumber(a)?a:1E3}},playing:{value:false,validator:j.isBoolean},startTime:{value:0},previousTime:{value:0}}},{_enterFrame:function(a,d){if(this.get("playing")){this.get("startTime")||this.set("startTime",
d);var b=this,c=this.get("easing"),e=this.get("to"),h=this.get("from"),f=this.get("duration"),o=this.get("easingStrength"),v=this.get("node"),p=d-this.get("startTime")+this.get("previousTime");if(p<f)q.each(e,function(l,i){var k=c(p,h[l],i,f,o);if(i>h[l]&&k>i||i<h[l]&&k<i)k=i;if(b.fire("tween",k))v.css(l,k);else p=f});else{b.stop();setTimeout(function(){b.fire("end")},0)}}},play:function(){var a=this.get("node"),d=a.currentStyle(),b=this.get("from")||{},c=this.get("to"),e,h=jet.TimeFrame;if(c.left||
c.top)e=a.offset();q.each(c,function(f,o){c[f]=m(o);if(!b[f])switch(f){case "left":b[f]=e.left;break;case "top":b[f]=e.top;break;case "width":b[f]=a.attr("offsetWidth");break;case "height":b[f]=a.attr("offsetHeight");break;default:b[f]=j.isNumber(m(d[f]))?m(d[f]):0}});this.set("from",b);if(this.fire("start")){this.set("playing",true);h.on("enterFrame",this._enterFrame,this);h.addTween(this).play()}return this},stop:function(){this.set("playing",false);var a=jet.TimeFrame;a.removeTween(this);a.unbind("enterFrame",
this._enterFrame);this.set("previousTime",0);return this.set("startTime",0)},pause:function(){this.set("playing",false);var a=jet.TimeFrame;a.removeTween(this);a.unbind("enterFrame",this._enterFrame);return this.set("previousTime",(new Date).getTime()-this.get("startTime"))},reverse:function(){var a=this.get("from");return this.set("from",this.get("to")).set("to",a)}});g.mix(g.NodeList.prototype,{animate:function(a,d,b,c){this.tw=(new s({node:this,to:a,duration:d,easing:b})).on("end",c).play();return this},
fadeIn:function(a,d,b){return this.animate({opacity:1},a,d,b)},fadeOut:function(a,d,b){return this.animate({opacity:0},a,d,b)},fadeToggle:function(a,d,b){return this.each(function(c){c=g(c);c.css("opacity")==1?c.fadeOut(a,d,b):c.fadeIn(a,d,b)})},slideDown:function(a,d,b){var c=this,e=c.css("overflow");return c.css("overflow","hidden").animate({height:c.oHeight},a,d,function(){c.css("overflow",e);b.call(c)})},slideUp:function(a,d,b){var c=this,e=c.css("overflow");return c.css("overflow","hidden").animate({height:0},
a,d,function(){c.css("overflow",e);b.call(c)})},stop:function(){this.tw&&this.tw.stop();return this}});g.add({Tween:s,Easing:n})});
