/*
 Copyright (c) 2010, Juan Ignacio Dopazo. All rights reserved.
 Code licensed under the BSD License
 http://code.google.com/p/jet-js/wiki/Licence
*/
jet().add("anim",function(g){var p=g.Lang,s=g.Hash,y=g.Array,t=function(b){return!p.isString(b)?b:b.substr(-2,b.length)=="px"?parseFloat(b.substr(0,b.length-2)):parseFloat(b)},u={linear:function(b,c,a,d){return(a-c)*b/d+c},easein:function(b,c,a,d,e){return a-(a-c)*Math.pow((a>=c?-1:1)*(b/d-1),e)},easeout:function(b,c,a,d,e){return c+(a-c)*Math.pow(b/d,e)},sling:function(b,c,a,d,e){c=[c,c+(a<c?1:-1)*e,a];b=b/d;d=c.length;a=[];for(e=0;e<d;++e)a[e]=c[e];for(c=1;c<d;++c)for(e=0;e<d-c;++e)a[e]=(1-b)*a[e]+
b*a[parseInt(e+1,10)];return a[0]}};if(!jet.TimeFrame){var z=function(){var b=[],c,a=false;return{fps:50,play:function(){var d=this;if(!a){c&&clearInterval(c);c=setInterval(function(){d.fire("enterFrame",(new Date).getTime())},Math.round(1E3/d.fps));a=true}return d},stop:function(){c&&clearInterval(c);a=false;return this},addTween:function(d){b[b.length]=d;return this},removeTween:function(d){y.remove(d,b);return b.length===0?this.stop():this}}}();jet.TimeFrame=g.mix(new g.EventTarget,z)}var q=function(){q.superclass.constructor.apply(this,
arguments);var b=jet.TimeFrame,c=false,a=this.addAttrs({node:{writeOnce:true,required:true,setter:function(h){return g(h)}},from:{value:false},to:{required:true},easing:{value:u.linear},easingStrength:{value:2,validator:function(h){return h>=0}},duration:{value:1E3,setter:function(h){return h=="fast"?500:h=="slow"?4E3:p.isNumber(h)?h:1E3}}}),d=a.get("node"),e,j,n,v=0,k,r,x,w=function(h,i){if(c){n||(n=i);var f=i-n+v;s.keys(j);s.each(j,function(l,m){var o=k(f,e[l],m,r,x);if(m>e[l]&&o>m||m<e[l]&&o<m)o=
m;if(a.fire("tween",o))d.css(l,o);else f=r});if(f>=r){a.stop();setTimeout(function(){a.fire("end")},0)}}};a.play=function(){var h=d.currentStyle();c=true;e=a.get("from")||{};j=a.get("to");var i=d.offset();s.each(j,function(f,l){j[f]=t(l);if(!e[f])switch(f){case "left":e[f]=i.left;break;case "top":e[f]=i.top;break;case "width":e[f]=i.width;break;case "height":e[f]=i.height;break;default:e[f]=p.isNumber(t(h[f]))?t(h[f]):0}});k=a.get("easing");k=p.isFunction(k)?k:u[k];r=a.get("duration");x=a.get("easingStrength");
if(a.fire("start")){b.on("enterFrame",w);b.addTween(a).play()}return a};a.stop=function(){c=false;b.removeTween(a);b.unbind("enterFrame",w);v=n=0;return a};a.pause=function(){c=false;b.removeTween(a);b.unbind("enterFrame",w);v=(new Date).getTime()-n;return a};a.reverse=function(){return a.set("from",j).set("to",e)}};g.extend(q,g.Base);g.augment(g.NodeList,{animate:function(b,c,a,d){this.tw=(new q({node:this,to:b,duration:c,easing:a})).on("end",d).play();return this},fadeIn:function(b,c,a){return this.animate({opacity:1},
b,c,a)},fadeOut:function(b,c,a){return this.animate({opacity:0},b,c,a)},fadeToggle:function(b,c,a){return this.each(function(d){d=g(d);d.css("opacity")==1?d.fadeOut(b,c,a):d.fadeIn(b,c,a)})},slideDown:function(b,c,a){var d=this,e=d.css("overflow");return d.css("overflow","hidden").animate({height:d.oHeight},b,c,function(){d.css("overflow",e);a.call(d)})},slideUp:function(b,c,a){var d=this,e=d.css("overflow");return d.css("overflow","hidden").animate({height:0},b,c,function(){d.css("overflow",e);a.call(d)})},
stop:function(){this.tw&&this.tw.stop();return this}});g.add({Tween:q,Easing:u})});
