jet().add("datasource",function(d){if(!jet.DataSource)jet.DataSource={};if(!jet.DataSource.jsonp)jet.DataSource.jsonp={};if(!jet.DataSource.jsonp.callbacks)jet.DataSource.jsonp.callbacks=[];var n=d.Lang,m=d.Hash,i=function(){i.superclass.constructor.apply(this,arguments);var a=this.addAttrs({responseType:{required:true},responseSchema:{required:true},schema:{required:true},parser:{writeOnce:true},requestLogic:{writeOnce:true},internalEvents:{readOnly:true,value:new d.EventTarget}});a.sendRequest=
function(b,h){a.get("requestLogic")(b,function(c){a.set("tempData",c);var e=c;if(internal.fire("beforeParse",c))e=a.get("parser")(a.get("tempData"));a.fire("update",e);m.each(e,function(f,g){if(recordSet[f]){if(recordSet[f]!=g||h){recordSet[f]=g;a.fire("recordUpdate",f,g)}}else{recordSet[f]=g;a.fire("recordAdded",f,g)}})},function(c){a.fire("error",{message:"Request failed",reason:c})})};a.onBeforeParse=function(b){a.get("internalEvents").on("beforeParse",function(h,c){a.set("tempData",b(c))})}};
d.extend(i,d.Utility);var j=function(){j.superclass.constructor.apply(this,arguments);var a={},b=this.addAttrs({recordSet:{readOnly:true,getter:function(){return a}},responseType:{value:2},url:{required:true}});b.set("requestLogic",function(h,c,e){d.ajax({url:b.get("url"),data:h,dataType:b.get("responseType")==2?"xml":"json",success:c,failure:e})});b.set("parser",function(){switch(b.get("responseType")){case 1:break;case 2:break}})};d.extend(j,i);var k=function(){k.superclass.constructor.apply(this,
arguments);var a={},b=this.addAttrs({recordSet:{readOnly:true,getter:function(){return a}},jsonCallbackParam:{value:"p"},timeout:{value:1E4},url:{required:true}}),h=function(c){var e=[];if(n.isHash(c)){m.each(c,function(f,g){e[e.length]=f+"="+g});c=e.join("&")}return c};b.set("requestLogic",function(c,e){var f=jet.DataSource.jsonp.callbacks.length,g=false;jet.DataSource.jsonp.callbacks[f]=function(o){g=true;e(o)};d.Get.script(b.get("url")+h(c)+"&"+b.get("jsonCallbackParam")+"=jet.DataSource.jsonp.callbacks["+
f+"]");setTimeout(function(){g||b.fire("error",{message:"Request failed",reason:"timeout"})},b.get("timeout"))});b.set("parser",function(){})};d.extend(k,i);var l=function(){l.superclass.constructor.apply(this,arguments);var a={},b=this.addAttrs({recordSet:{readOnly:true,getter:function(){return a}},localData:{required:true},responseType:{value:3}});b.set("requestLogic",function(h,c){c(a)});b.set("parser",function(){})};d.extend(l,i);d.DataSource={sourceType:{XHR:1,JSONP:2,LOCAL:3},responseType:{JSON:1,
XML:2,JSARRAY:3},XHR:j,JSONP:k,Local:l}});
