/**
 * @module node
 * @requires 
 * 
 * Copyright (c) 2011, Juan Ignacio Dopazo. All rights reserved.
 * Code licensed under the BSD License
 * https://github.com/juandopazo/jet/blob/master/LICENSE.md
*/
jet.add("node",function(g){function v(a){this._handlers=a||[]}function r(a){return new RegExp("(^|\\s)"+a+"(\\s|$)")}function o(a,b){o.superclass.constructor.apply(this,arguments);var c=0,d;b=b||g.config.doc;a=h.isValue(a)?a:[];if(h.isArray(a._items))a=a._items;else if(h.isString(a))a=[b.createElement(a)];else if(a.nodeType||a.body||a.navigator)a=[a];else if(h.isArray(a))for(;c<a.length;)if(!a[c]||!(a[c].nodeType||a[c].body||a[c].navigator))a.splice(c,1);else c++;else if(h.isNumber(a.length)){d=[];
for(c=0;c<a.length;c++)d[c]=a[c];a=d}this._items=a}var h=g.Lang,s=g.Object,l=g.Array,t=Array.prototype.slice,y=/^(?:body|html)$/i,p,k=g.namespace("Event").Cache=function(){var a={},b=function(d){a[d]||(a[d]=[]);return a[d]},c=function(d,f,e){c=d.detachEvent?function(i,j,m){i.detachEvent("on"+j,m)}:function(i,j,m){i.removeEventListener(j,m,false)};c(d,f,e)};return{add:function(d,f,e,i){if(d.nodeType){f=b(f);f[f.length]={obj:d,callback:e,listener:i}}},remove:function(d,f,e){for(var i=b(f),j=0;j<i.length;)if(i[j].obj==
d&&i[j].callback==e){c(d,f,i[j].listener);i.splice(j,1)}else j++},clear:function(d,f){var e,i=0;if(f)for(e=b(f);i<e.length;)if(e[i].obj==d){c(d,f,e[i].listener);e.splice(i,1)}else i++;else for(f in a)if(a.hasOwnProperty(f)){e=a[f];for(i=0;i<e.length;)if(e[i].obj==d){c(d,f,e[i].listener);e.splice(i,1)}else i++}},flush:function(){for(var d in a)a.hasOwnProperty(d)&&k.clear(d)}}}(),z=function(a,b){return function(c){c=c||g.config.win.Event;c.target=c.srcElement;c.preventDefault=function(){c.returnValue=
false};c.stopPropagation=function(){c.cancelBubble=true};c.halt=function(){c.stopPropagation();c.preventDefault()};a.call(b||c.srcElement,c)}},n=function(a,b,c,d){if(a.addEventListener)n=function(f,e,i,j){var m=function(q){q.halt=function(){q.stopPropagation();q.preventDefault()};i.call(j||this,q)};f.addEventListener(e,m,false);k.add(f,e,i,m);return{obj:f,type:e,fn:m}};else if(a.attachEvent)n=function(f,e,i,j){j=z(i,j);f.attachEvent("on"+e,j);k.add(f,e,i,j);return{obj:f,type:e,fn:j}};return n(a,b,
c,d)},u=function(a,b,c){u=g.config.doc.createEvent?function(d,f,e){f=d.ownerDocument.createEvent("Events");f.initEvent(event,true,true);g.mix(f,e);d.dispatchEvent(f)}:function(d,f,e){var i=d.ownerDocument.createEventObject();g.mix(i,e);d.fireEvent("on"+f,i)};u(a,b,c)};g.UA.ie&&g.UA.ie<7&&n(g.config.win,"unload",k.flush);g.DOMEventHandler=g.mix(v.prototype,{detach:function(){for(var a=this._handlers,b=0,c=a.length;b<c;b++)k.remove(a[b].obj,a[b].type,a[b].callback);this._handlers=[]}});var w=g.DOM=
{getWindowFromDocument:function(a){a=a||g.config.doc;return a.defaultView||a.parentWindow||g.config.win},scrollLeft:function(a){if(h.isValue(a))g.config.win.scrollTo(a,this.scrollTop());else{a=g.config.doc;var b=a.defaultView;return Math.max(a.documentElement.scrollLeft,a.body.scrollLeft,b?b.pageXOffset:0)}return this},scrollTop:function(a){if(h.isValue(a))g.config.win.scrollTo(this.scrollTop(),a);else{a=g.config.doc;var b=a.defaultView;return Math.max(a.documentElement.scrollTop,a.body.scrollTop,
b?b.pageYOffset:0)}return this},screenSize:function(a){var b=a?a.document:g.config.doc;a=b.documentElement;b=b.body;return{height:a.clientHeight||g.config.win.innerHeight||b.clientHeight,width:a.clientWidth||g.config.win.innerWidth||b.clientWidth}},pageSize:function(a){a=a||g.config.win;var b=a.document,c=a.innerWidth;a=a.innerHeight;var d=b.compatMode!="CSS1Compat"?b.body:b.documentElement;if(b.compatMode&&!g.UA.opera){c=d.clientWidth;a=d.clientHeight}return{width:Math.max(d.scrollWidth,c),height:Math.max(d.scrollHeight,
a)}}},x=function(a){var b=this.getDOMNode();(b.ownerDocument||b).body?a.call(this):setTimeout(function(){x(a)},13);return this};g.NodeList=g.extend(o,g.ArrayList,{item:function(a){return new this.constructor([this._items[a]])},getDOMNodes:function(){return this._items},getDOMNode:function(a){return this._items[a||0]},hide:function(){return this.each(function(a){var b=a.style.display;if(!a.JET_oDisplay&&b!="none")a.JET_oDisplay=b;a.style.display="none"})},show:function(){return this.each(function(a){a.style.display=
a.JET_oDisplay||""})},toggle:function(a){return this.each(function(b){var c=b.style;b=b.LIB_oDisplay||"";c.display=h.isBoolean(a)?a?b:"none":c.display!="none"?"none":b?b:""})},hasClass:function(a){return r(a).test(this.getDOMNode().className)},removeClass:function(){var a=arguments;return this.each(function(b){l.forEach(t.call(a),function(c){b.className=h.trim(b.className.replace(r(c)," "))})})},addClass:function(){var a=arguments;return this.each(function(b){l.forEach(t.call(a),function(c){r(c).test(b.className)||
(b.className+=(b.className?" ":"")+c)})})},toggleClass:function(a,b){return this.each(function(c){c=g(c);h.isBoolean(b)||(b=!c.hasClass(a));c[b?"addClass":"removeClass"](a)})},setClass:function(a){return this.each(function(b){b.className=a})},_getPosition:function(){var a=this.getDOMNode(),b={left:0,top:0},c=a.ownerDocument;try{if(a.getBoundingClientRect){var d=a.getBoundingClientRect(),f=c.body,e=c.documentElement;b.left=d.left+w.scrollLeft()-(e.clientLeft||f.clientLeft||0);b.top=d.top+w.scrollTop()-
(e.clientTop||f.clientTop||0)}else if(a.offsetParent){do{b.left+=a.offsetLeft;b.top+=a.offsetTop;a=a.offsetParent}while(a)}}catch(i){}return b},_setPosition:function(a,b){return this.each(function(c){c=g(c);var d=c.offsetParent().position();h.isNumber(a)&&c.css("left",a-d.left);h.isNumber(b)&&c.css("top",b-d.top)})},position:function(a,b){return h.isNumber(a)||h.isNumber(b)?this._setPosition(a,b):this._getPosition()},offset:function(){return g.mix(this.position(),{width:this.width(),height:this.height()})},
width:function(a){var b=this.getDOMNode();if(h.isNumber(a))a+="px";if(h.isString(a))return this.css("width",a);return b.offsetWidth},height:function(a){var b=this.getDOMNode();if(h.isNumber(a))a+="px";if(h.isString(a))return this.css("height",a);return b.offsetHeight},offsetParent:function(){return this.map(function(a){var b;try{b=a.offsetParent}catch(c){}if(!b)b=g.config.doc.body;for(;b&&!y.test(b.nodeName)&&g(b).css("position")==="static";)b=b.offsetParent;return b})},append:function(a){var b=this.getDOMNode();
g(a).each(function(c){b.appendChild(c)});return this},appendTo:function(a){g(a).append(this);return this},prepend:function(a){var b=this.getDOMNode();a=g(a);a.getDOMNodes().reverse();a.each(function(c){b.insertBefore(c,b.firstChild)});return this},prependTo:function(a){g(a).prepend(this);return this},insertBefore:function(a){a=g(a).getDOMNode();return this.each(function(b){a.parentNode.insertBefore(b,a)})},inDoc:function(){this.getDOMNode();for(var a=this.parent();a.getDOMNode();){if(a.getDOMNode().nodeName.toLowerCase()==
"html")return true;a=a.parent()}return false},parent:function(){return this.map(function(a){if(a.parentNode)return a.parentNode})},ancestor:function(a){return this.map(function(b){for(;b;){if(a(b))break;b=b.parentNode}return b})},first:function(){return this.children(0)},last:function(){return this.children().getDOMNodes().shift()},html:function(a){return h.isValue(a)?this.each(function(b){b.innerHTML=a}):this.getDOMNode()?this.getDOMNode().innerHTML:""},attr:function(a,b){a=a||{};var c={};if(h.isObject(a))c=
a;else if(h.isValue(b))c[a]=b;else return this.getDOMNode()[a];return this.each(function(d){s.each(c,function(f,e){d[f]=e})})},css:function(a,b){var c={};if(h.isObject(a))c=a;else if(h.isValue(b))c[a]=b;else return g(this.getDOMNode()).currentStyle()[a];return this.each(function(d){s.each(c,function(f,e){if(f=="opacity"&&g.UA.ie)d.style.filter="alpha(opacity="+Math.ceil(e*100)+")";else{if(h.isNumber(e))e+=f!="zIndex"&&f!="zoom"&&f!="opacity"?"px":"";if(h.isString(e))d.style[f]=e}})})},find:function(a){return this.map(function(b){return g(a,
b)})},children:function(a){a=!h.isValue(a)?false:h.isString(a)?a.toUpperCase():a;var b=[];this.each(function(c){c=c.childNodes;for(var d=[],f=c.length,e=0;e<f;e++)if(c[e].nodeType===1)d[d.length]=c[e];if(a!==false){f=d.length;for(e=0;e<f;e++)if(e==a||d[e].nodeName==a)b.push(d[e])}else b.push.apply(b,d)});return new this.constructor(b)},on:function(a,b,c){var d=[];h.isObject(a,true)?s.each(a,function(f,e){this.each(function(i){d.push(n(i,f,e,c))})},this):this.each(function(f){d.push(n(f,a,b,c))});
return new v(d)},removeListener:function(a,b){return this.each(function(c){b?k.remove(c,a,b):k.clear(c,a)})},trigger:function(a,b){return this.each(function(c){u(c,a,b)})},remove:function(a){return this.each(function(b){a&&g.walkTheDOM(b,k.clear);b.parentNode&&b.parentNode.removeChild(b)})},setContent:function(a){this.children().removeListener().remove();return this.html(a)},ownerDoc:function(){return this.map(function(a){return a.ownerDocument})},contentDoc:function(){return this.map(function(a){if(a.nodeName==
"IFRAME")return a.contentDocument||a.contentWindow.document||a.document})},currentStyle:function(){var a=this.getDOMNode();return g.config.win.getComputedStyle?g.config.win.getComputedStyle(a,null):a.currentStyle?a.currentStyle:a.style},ready:x,link:function(){var a=[];this.each(function(b){a.push(b)});l.forEach(t.call(arguments),function(b){g(b).each(function(c){a.push(c)})});return new this.constructor(a)},value:function(a){return this.attr("value",a)},contains:function(a){if(h.isString(a))return this.find(a).size()>
0;else{a=g(a).getDOMNode();if(a.nodeType){var b=false;this.children().each(function(c){g.walkTheDOM(c,function(d){if(d===a){b=true;return false}});if(b)return false});return b}}return false}});o.prototype.unbind=o.prototype.removeListener;p=o.prototype;l.forEach(["blur","focus"],function(a){p[a]=function(){return this.each(function(b){try{b[a]()}catch(c){}})}});l.forEach(["next","previous"],function(a){p[a]=function(){return this.map(function(b){do b=b[a+"Sibling"];while(b&&b.nodeType!==1);return b})}});
l.forEach(["Width","Height"],function(a){var b=a.toLowerCase();p[b]=function(c){if(h.isValue(c)){if(h.isNumber(c)&&c<0)c=0;c=h.isString(c)?c:c+"px";return this.each(function(d){d.style[b]=c})}return this.getDOMNode()?this.getDOMNode()["offset"+a]:null}});l.forEach(["Left","Top"],function(a){p["offset"+a]=function(b){return h.isValue(b)?a=="Left"?this.offset(b):this.offset(null,b):this.offset()[a.toLowerCase()]}});g.pxToFloat=function(a){return h.isNumber(parseFloat(a))?parseFloat(a):h.isString(a)?
parseFloat(a.substr(0,a.length-2)):a}});
