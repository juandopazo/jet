/**
 * @module node
 * @requires ua
 * 
 * Copyright (c) 2011, Juan Ignacio Dopazo. All rights reserved.
 * Code licensed under the BSD License
 * https://github.com/juandopazo/jet/blob/master/LICENSE.md
*/
jet.add("node",function(g){function q(a){return RegExp("(^|\\s)"+a+"(\\s|$)")}function k(a,b){var c=0,d;b=b||g.context;a=h.isValue(a)?a:[];if(h.isArray(a._nodes))a=a._nodes;else if(h.isString(a))a=[b.createElement(a)];else if(a.nodeType||a.body||a.navigator)a=[a];else if(h.isArray(a))for(;c<a.length;)if(a[c].nodeType||a[c].body||a[c].navigator)c++;else a.splice(c,1);else if(h.isNumber(a.length)){d=[];for(c=0;c<a.length;c++)d[c]=a[c];a=d}else g.error("Wrong argument for NodeList");this._nodes=a}var h=
g.Lang,s=g.Hash,m=g.Array,t=Array.prototype.slice,l=function(){var a={},b=function(d){b=d.detachEvent?function(e){var f,i,j;for(f in a)if(a.hasOwnProperty(f)){i=a[f];for(j=0;j<i.length;)if(i[j].obj==e){i[j].obj.detachEvent("on"+f,i[j].fn);i.splice(j,1)}else j++}}:function(e){var f,i,j;for(f in a)if(a.hasOwnProperty(f)){i=a[f];for(j=0;j<i.length;)if(i[j].obj==e){i[j].obj.removeEventListener(f,i[j].fn,false);i.splice(j,1)}else j++}};b(d)},c=function(d){a[d]||(a[d]=[]);return a[d]};return{add:function(d,
e,f){if(d.nodeType){e=c(e);e[e.length]={obj:d,fn:f}}},remove:function(d,e,f){m.remove(c(e),{obj:d,fn:f})},clear:b,flush:function(){for(var d in a)a.hasOwnProperty(d)&&b(d)}}}(),o=function(a,b,c,d){if(a.addEventListener)o=function(e,f,i,j){if(j)i=g.bind(i,j);e.addEventListener(f,i,false);l.add(e,f,i);return{obj:e,type:f,fn:i}};else if(a.attachEvent)o=function(e,f,i,j){e.attachEvent("on"+f,function(n){n.target=n.srcElement;n.preventDefault=function(){n.returnValue=false};n.stopPropagation=function(){n.cancelBubble=
true};i.call(j||e,n)});l.add(e,f,i);return{obj:e,type:f,fn:i}};return o(a,b,c,d)},p=function(a,b,c){if(a.removeEventListener)p=function(d,e,f){d.removeEventListener(e,f,false);l.remove(d,e,f)};else if(a.detachEvent)p=function(d,e,f){d.detachEvent("on"+e,f);l.remove(d,e,f)};p(a,b,c)},v=/^(?:body|html)$/i,r={getWindowFromDocument:function(a){a=a||g.context;return a.defaultView||a.parentWindow||g.win},scrollLeft:function(a){if(h.isValue(a))g.win.scrollTo(a,this.scrollTop());else{a=g.context;var b=a.defaultView;
return Math.max(a.documentElement.scrollLeft,a.body.scrollLeft,b?b.pageXOffset:0)}return this},scrollTop:function(a){if(h.isValue(a))g.win.scrollTo(this.scrollTop(),a);else{a=g.context;var b=a.defaultView;return Math.max(a.documentElement.scrollTop,a.body.scrollTop,b?b.pageYOffset:0)}return this},screenSize:function(){var a=g.context,b=a.documentElement;a=a.body;return{height:b.clientHeight||g.win.innerHeight||a.clientHeight,width:b.clientWidth||g.win.innerWidth||a.clientWidth}},pageSize:function(a){a=
a||g.win;var b=a.document,c=a.innerWidth;a=a.innerHeight;var d=b.compatMode!="CSS1Compat"?b.body:b.documentElement;if(b.compatMode&&!g.UA.opera){c=d.clientWidth;a=d.clientHeight}return{width:Math.max(d.scrollWidth,c),height:Math.max(d.scrollHeight,a)}}},u=function(a){var b=this._nodes[0];(b.ownerDocument||b).body?a.call(this):setTimeout(function(){u(a)},13);return this};k.prototype={each:function(a,b){var c,d=this._nodes,e=d.length;for(c=0;c<e;c++)a.call(b||d[c],d[c],c,d);return this},size:function(){return this._nodes.length},
map:function(a){var b=[];this.each(function(c){c=a(c);if(h.isValue(c))if(h.isArray(c))b.push.apply(b,c);else if(c instanceof k)c.each(function(d){if(m.indexOf(d,b)==-1)b[b.length]=d});else if(m.indexOf(c,b)==-1)b[b.length]=c});return new k(b)},filter:function(a){var b=[];this.each(function(c){if(a.call(this))b[b.length]=c});return new k(b)},hide:function(){return this.each(function(a){var b=a.style.display;if(!a.JET_oDisplay&&b!="none")a.JET_oDisplay=b;a.style.display="none"})},show:function(){return this.each(function(a){a.style.display=
a.JET_oDisplay||""})},toggle:function(){return this.each(function(a){var b=a.style;a=a.LIB_oDisplay;b.display=b.display!="none"?"none":a?a:""})},hasClass:function(a){return q(a).test(this._nodes[0].className)},removeClass:function(){var a=arguments;return this.each(function(b){m.each(t.call(a),function(c){b.className=h.trim(b.className.replace(q(c)," "))})})},addClass:function(){var a=arguments;return this.each(function(b){m.each(t.call(a),function(c){q(c).test(b.className)||(b.className+=(b.className?
" ":"")+c)})})},toggleClass:function(a){return this.each(function(b){b=g(b);b.hasClass(a)?b.removeClass(a):b.addClass(a)})},setClass:function(a){return this.each(function(b){b.className=a})},offset:function(a,b){if(h.isNumber(a)||h.isNumber(b))return this.each(function(i){i=g(i);var j=i.offsetParent().offset();h.isNumber(a)&&i.css("left",a-j.left+"px");h.isNumber(b)&&i.css("top",b-j.top+"px")});else{var c=this._nodes[0],d={left:0,top:0,width:c.offsetWidth,height:c.offsetHeight},e=c.ownerDocument;
if(c&&e)if(c.getBoundingClientRect){c=c.getBoundingClientRect();var f=e.body;e=e.documentElement;d.left=c.left+r.scrollLeft()-(e.clientLeft||f.clientLeft||0);d.top=c.top+r.scrollTop()-(e.clientTop||f.clientTop||0)}else{if(c.offsetParent){do{d.left+=c.offsetLeft;d.top+=c.offsetTop;c=c.offsetParent}while(c)}}else d=null;return d}},offsetParent:function(){return this.map(function(a){for(a=a.offsetParent||document.body;a&&!v.test(a.nodeName)&&g(a).css("position")==="static";)a=a.offsetParent;return a})},
width:function(a){if(h.isValue(a)){if(h.isNumber(a)&&a<0)a=0;a=h.isString(a)?a:a+"px";return this.each(function(b){b.style.width=a})}return this._nodes[0].offsetWidth},height:function(a){if(h.isValue(a)){if(h.isNumber(a)&&a<0)a=0;a=h.isString(a)?a:a+"px";return this.each(function(b){b.style.height=a})}return this._nodes[0].offsetHeight},clone:function(a){a=h.isValue(a)?a:true;return this.map(function(b){return b.cloneNode(a)})},append:function(a){a=g(a);return this.each(function(b){a.each(function(c){b.appendChild(c)})})},
appendTo:function(a){var b=g(a)._nodes[0];return this.each(function(c){b.appendChild(c)})},prepend:function(a){a=g(a);return this.each(function(b){a.each(function(c){b.firstChild?b.insertBefore(c,b.firstChild):b.appendChild(c)})})},prependTo:function(a){a=g(a)._nodes[0];return this.each(function(b){a.firstChild?a.insertBefore(b,a.firstChild):a.appendChild(b)})},insertBefore:function(a){a=g(a)._nodes[0];return this.each(function(b){a.parentNode.insertBefore(b,a)})},inDoc:function(){for(var a=this.parent();a._nodes[0];){if(a._nodes[0].nodeName.toLowerCase()==
"html")return true;a=a.parent()}return false},parent:function(){return this.map(function(a){if(a.parentNode)return a.parentNode})},first:function(){return this.map(function(a){if(a=g(a).children(0)._nodes[0])return a})},next:function(){return this.map(function(a){do a=a.nextSibling;while(a&&a.nodeType==1);return a})},previous:function(){return this.map(function(a){do a=a.previousSibling;while(a&&a.nodeType==3);return a})},last:function(){return this.map(function(a){for(var b=g(a).children(),c=-1;b[++c];)a=
b[c];return a})},html:function(a){return h.isValue(a)?this.each(function(b){b.innerHTML=a}):this._nodes[0].innerHTML},attr:function(a,b){a=a||{};var c={};if(h.isObject(a))c=a;else if(h.isValue(b))c[a]=b;else return this._nodes[0][a];return this.each(function(d){s.each(c,function(e,f){d[e]=f})})},css:function(a,b){var c={};if(h.isObject(a))c=a;else if(h.isValue(b))c[a]=b;else return g(this._nodes[0]).currentStyle()[a];return this.each(function(d){s.each(c,function(e,f){if(e=="opacity"&&g.UA.ie)d.style.filter=
"alpha(opacity="+Math.ceil(f*100)+")";else{if(h.isNumber(f)&&e!="zIndex"&&e!="zoom"&&e!="opacity")f+="px";d.style[e]=f}})})},find:function(a){return this.map(function(b){return g(a,b)})},children:function(a){a=!h.isValue(a)?false:h.isString(a)?a.toUpperCase():a;var b=[];this.each(function(c){c=c.childNodes;for(var d=[],e=c.length,f=0;f<e;f++)if(c[f].nodeType!=3)d[d.length]=c[f];if(a!==false){e=d.length;for(f=0;f<e;f++)if(f==a||d[f].nodeName==a)b.push(d[f])}else b.push.apply(b,d)});return new k(b)},
on:function(a,b,c){var d=[];this.each(function(e){d.push(o(e,a,b,c))});return{detach:function(){for(var e=0,f=d.length;e<f;e++)p(d[e].obj,d[e].type,d[e].fn)}}},unbind:function(a,b){return this.each(function(c){p(c,a,b)})},unbindAll:function(a){return this.each(function(b){a?g.walkTheDOM(b,l.clear):l.clear(b)})},remove:function(){return this.each(function(a){g.walkTheDOM(a,l.clear);a.parentNode&&a.parentNode.removeChild(a)})},setContent:function(a){this.children().unbindAll(true).remove();return this.html(a)},
detach:function(){return this.each(function(a){a.parentNode&&a.parentNode.removeChild(a)})},ownerDoc:function(){return this.map(function(a){return a.ownerDocument})},contentDoc:function(){return this.map(function(a){if(a.nodeName=="IFRAME")return a.contentDocument||a.contentWindow.document||a.document})},currentStyle:function(){var a=this._nodes[0];return g.win.getComputedStyle?g.win.getComputedStyle(a,null):a.currentStyle?a.currentStyle:a.style},ready:u,link:function(){var a=[];this.each(function(b){a.push(b)});
m.each(arguments,function(b){g(b).each(function(c){a.push(c)})});return new k(a)},blur:function(){return this.each(function(a){try{a.blur()}catch(b){g.error(b)}})},focus:function(){return this.each(function(a){try{a.focus()}catch(b){g.error(b)}})},value:function(a){return this.attr("value",a)},eq:function(a){return new k(this._nodes[a])}};k.is=h.is;m.each(["Left","Top"],function(a){k.prototype["offset"+a]=function(b){return h.isValue(b)?a=="Left"?this.offset(b):this.offset(null,b):this.offset()[a.toLowerCase()]}});
g.add({NodeList:k,DOM:r,pxToFloat:function(a){return h.isNumber(parseFloat(a))?parseFloat(a):h.isString(a)?parseFloat(a.substr(0,a.length-2)):a}});o(g.win,"unload",l.flush)});
