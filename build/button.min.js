/*
 Copyright (c) 2010, Juan Ignacio Dopazo. All rights reserved.
 Code licensed under the BSD License
 http://code.google.com/p/jet-js/wiki/Licence
*/
jet().add("button",function(e){var n=e.Array,v=e.Hash,m=e.Lang;if(!jet.buttons)jet.buttons={};if(!jet.buttons.buttons)jet.buttons.buttons=1;var o=function(){o.superclass.constructor.apply(this,arguments);this.on("disabledChange",function(a,c){this.get("buttonNode")[0].disabled=!!c});this.on("afterRender",function(){this.get("buttonNode")[0].disabled=!!this.get("disabled")})};e.extend(o,e.Widget,{disable:function(){return this.set("disabled",true)},enable:function(){return this.set("disabled",false)},
blur:function(){this.get("buttonNode").blur();this.fire("blur");return this},focus:function(){this.get("buttonNode").focus();this.fire("focus");return this}});var p=function(){p.superclass.constructor.apply(this,arguments);var a=this.set("className","button").addAttrs({type:{writeOnce:true,value:"push"},boundingBox:{readOnly:true,value:e("<span/>")},contentBox:{readOnly:true,value:e("<span/>")},disabled:{validator:m.isBoolean,value:false},text:{value:""},className:{value:p.NAME}}),c=a.get("type"),
b=++jet.buttons.buttons;a.addAttr("buttonNode",{readOnly:true,value:e("<"+(c=="link"?"a":c=="push"?"button":"input")+"/>")});c=="text"&&a.get("buttonNode").attr("type",c);a.on("render",function(){var d=a.get("className"),g=a.get("buttonNode"),f=a.get("text");c=="text"?g.attr("value",f):g.html(f);f=a.get("classPrefix");var k=f+d,i=f+c+d,h=a.get("boundingBox").addClass(k,f+c+"-"+d);d=a.get("contentBox").addClass("first-child");g.on("mouseover",function(){h.addClass(k+"-hover",i+"-hover")}).on("mouseout",
function(){h.removeClass(k+"-hover",i+"-hover")}).on("focus",function(){h.addClass(k+"-focus",i+"-focus");a.fire("focus")}).on("blur",function(){h.removeClass(k+"-focus",i+"-focus");a.fire("blur")}).on("click",function(l){a.fire("pressed")&&l.preventDefault()});b=a.get("classPrefix")+a.get("className")+"-"+b;g.attr("id",b).appendTo(d.appendTo(h))});a.on("afterRender",function(){a.get("boundingBox").css("visibility","inherit");var d=a.get("label");if(d){d=e("<label/>").html(d).insertBefore(a.get("boundingBox"));
d[0].setAttribute("for",b)}})};p.NAME="button";e.extend(p,o);var q=function(a,c,b){var d=e.context.createElement("select"),g=e.context.createElement("option"),f=false;try{d.add(g,null);f=true}catch(k){d.add(g)}q=f?function(i,h,l){var j=e.context.createElement("option");j.text=h;if(l)j.value=l;i.add(j,null)}:function(i,h,l){var j=e.context.createElement("option");j.text=h;if(l)j.value=l;i.add(j)};q(a,c,b)};if(!jet.buttons.combo)jet.buttons.combo=1;var s=function(){s.superclass.constructor.apply(this,
arguments);var a=this.addAttrs({options:{value:[]},buttonNode:{readOnly:true,value:e("<select/>")},className:{value:"combobox"},selected:{readOnly:true,getter:function(){var d=a.get("buttonNode")[0];return d.options[d.selectedIndex]}}}),c=function(d,g){n.each(g,function(f){m.isHash(f)?v.each(f,function(k,i){q(d,k,i)}):q(d,f)})},b=++jet.buttons.combo;a.on("optionsChange",function(d,g){var f=a.get("buttonNode")[0];f.options.length=0;c(f,g)});a.on("render",function(){var d=a.get("boundingBox"),g=a.get("buttonNode"),
f=a.get("label");b=a.get("classPrefix")+a.get("className")+"-"+b;if(f){f=e("<label/>").html(f).appendTo(d);f[0].setAttribute("for",b)}g.attr("id",b).appendTo(d);g.on("change",function(){a.fire("change",g[0].options[g[0].selectedIndex])});c(a.get("buttonNode")[0],a.get("options"))})};e.extend(s,o,{add:function(a,c){var b;if(c){b={};b[a]=c}else b=a;this.get("options").push(b);q(this.get("buttonNode")[0],a,c);return this},fill:function(a){var c=this;m.isArray(a)?n.each(a,function(b){c.add(b)}):v.each(a,
c.add);return c},clear:function(){return this.set("options",[])}});if(!jet.radioButtons)jet.radioButtons=1;var t=function(){t.superclass.constructor.apply(this,arguments);var a=++jet.radioButtons,c=[],b=this.addAttrs({options:{required:true},className:{value:"radio"},namePrefix:{value:"jet-radio"},buttons:{readOnly:true,value:c},selected:{value:0},value:{}});this.on("selectedChange",function(d,g,f){c[f][0].checked=false;if(m.isNumber(g))c[g][0].checked=true}).on("render",function(){var d=b.get("boundingBox");
b.get("classPrefix");b.get("className");var g=b.get("options"),f=b.get("namePrefix");n.each(g,function(k,i){var h=e("<span/>").appendTo(d),l=f+a+"-"+i,j=e("<input/>").attr({type:"radio",name:f+a,id:l,value:k.value}).appendTo(h);h=e("<label/>").html(k.label).appendTo(h);h[0].setAttribute("for",l);j.link(h).on("click",function(r,w){return function(){if(b.fire("click",r)&&r!==void 0){b.fire("change",r,j);b.set("selected",r);b.set("value",w[0].value)}}}(i,j));c.push(j);if(i===b.get("selected")){j[0].checked=
true;b.set("value",j[0].value)}})})};e.extend(t,e.Widget,{disable:function(a){var c=this.get("buttons");n.each(m.isNumber(a)?[c[a]]:c,function(b){b[0].disabled=true;b.next().addClass("disabled")});return this},enable:function(a){var c=this.get("buttons");n.each(m.isNumber(a)?[c[a]]:c,function(b){b[0].disabled=false;b.next().removeClass("disabled")});return this}});if(!jet.checkboxes)jet.checkboxes=1;var u=function(){u.superclass.constructor.apply(this,arguments);var a=this.addAttrs({buttonNode:{readOnly:true,
value:e("<input/>").attr("type","checkbox")},label:{value:""},className:{value:"checkbox"},checked:{value:false,getter:function(){return a.get("buttonNode")[0].checked}}}),c=++jet.checkboxes;this.on("render",function(){var b=a.get("boundingBox");c=a.get("classPrefix")+a.get("className")+"-"+c;var d=a.get("buttonNode").attr("id",c).appendTo(b);e("<label/>").html(a.get("label")).appendTo(b)[0].setAttribute("for",c);d[0].disabled=!!a.get("disabled");d.on("click",function(){var g=d[0].checked;if(g!=a.get("checked"))if(!a.fire("change",
g))d[0].checked=!g})})};e.extend(u,o);e.add({Button:p,ComboBox:s,RadioButton:t,CheckBox:u})});
