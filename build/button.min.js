/*
 Copyright (c) 2010, Juan Ignacio Dopazo. All rights reserved.
 Code licensed under the BSD License
 http://code.google.com/p/jet-js/wiki/Licence
*/
jet().add("button",function(f){var n=f.Array,v=f.Hash,m=f.Lang;if(!jet.buttons)jet.buttons={};if(!jet.buttons.buttons)jet.buttons.buttons=1;var o=function(){o.superclass.constructor.apply(this,arguments);this.on("disabledChange",function(a,c){this.get("buttonNode")[0].disabled=!!c});this.on("afterRender",function(){this.get("buttonNode")[0].disabled=!!this.get("disabled")})};f.extend(o,f.Widget,{disable:function(){return this.set("disabled",true)},enable:function(){return this.set("disabled",false)},
blur:function(){this.get("buttonNode").blur();this.fire("blur");return this},focus:function(){this.get("buttonNode").focus();this.fire("focus");return this}});var p=function(){p.superclass.constructor.apply(this,arguments);var a=this.set("className","button").addAttrs({type:{writeOnce:true,value:"push"},boundingBox:{readOnly:true,value:f("<span/>")},contentBox:{readOnly:true,value:f("<span/>")},disabled:{validator:m.isBoolean,value:false},text:{value:""},className:{value:p.NAME}}),c=a.get("type"),
b=++jet.buttons.buttons;a.addAttr("buttonNode",{readOnly:true,value:f("<"+(c=="link"?"a":c=="push"?"button":"input")+"/>")});c=="text"&&a.get("buttonNode").attr("type",c);a.on("render",function(){var d=a.get("className"),e=a.get("buttonNode"),g=a.get("text");c=="text"?e.attr("value",g):e.html(g);g=a.get("classPrefix");var k=g+d,i=g+c+d,h=a.get("boundingBox").addClass(k,g+c+"-"+d);d=a.get("contentBox").addClass("first-child");e.on("mouseover",function(){h.addClass(k+"-hover",i+"-hover")}).on("mouseout",
function(){h.removeClass(k+"-hover",i+"-hover")}).on("focus",function(){h.addClass(k+"-focus",i+"-focus");a.fire("focus")}).on("blur",function(){h.removeClass(k+"-focus",i+"-focus");a.fire("blur")}).on("click",function(l){a.fire("pressed")&&l.preventDefault()});b=a.get("classPrefix")+a.get("className")+"-"+b;e.attr("id",b).appendTo(d.appendTo(h))});a.on("afterRender",function(){a.get("boundingBox").css("visibility","inherit");var d=a.get("label");if(d){d=f("<label/>").html(d).insertBefore(a.get("boundingBox"));
d[0].setAttribute("for",b)}})};p.NAME="button";f.extend(p,o);var q=function(a,c,b){var d=f.context.createElement("select"),e=f.context.createElement("option"),g=false;try{d.add(e,null);g=true}catch(k){d.add(e)}q=g?function(i,h,l){var j=f.context.createElement("option");j.text=h;if(l)j.value=l;i.add(j,null)}:function(i,h,l){var j=f.context.createElement("option");j.text=h;if(l)j.value=l;i.add(j)};q(a,c,b)};if(!jet.buttons.combo)jet.buttons.combo=1;var s=function(){s.superclass.constructor.apply(this,
arguments);var a=this.addAttrs({options:{value:[]},buttonNode:{readOnly:true,value:f("<select/>")},className:{value:"combobox"},selected:{validator:m.isNumber,getter:function(){var d=a.get("buttonNode")[0];return d.options[d.selectedIndex]},setter:function(d){var e=a.get("buttonNode")[0];if(a.fire("change",e.options[d]))e.selectedIndex=d;return d}},count:{readOnly:true,getter:function(){return a.get("buttonNode")[0].options.length}}}),c=function(d,e){n.each(e,function(g){m.isHash(g)?v.each(g,function(k,
i){q(d,k,i)}):q(d,g)})},b=++jet.buttons.combo;a.on("optionsChange",function(d,e){var g=a.get("buttonNode")[0];g.options.length=0;c(g,e)});a.on("render",function(){var d=a.get("boundingBox"),e=a.get("buttonNode"),g=a.get("label");b=a.get("classPrefix")+a.get("className")+"-"+b;if(g){g=f("<label/>").html(g).appendTo(d);g[0].setAttribute("for",b)}e.attr("id",b).appendTo(d);e.on("change",function(){a.fire("change",e[0].options[e[0].selectedIndex])});c(a.get("buttonNode")[0],a.get("options"))})};f.extend(s,
o,{add:function(a,c){var b;if(c){b={};b[a]=c}else b=a;this.get("options").push(b);q(this.get("buttonNode")[0],a,c);return this},fill:function(a){var c=this;m.isArray(a)?n.each(a,function(b){c.add(b)}):v.each(a,c.add);return c},clear:function(){return this.set("options",[])},select:function(a){return this.set("selected",a)}});if(!jet.radioButtons)jet.radioButtons=1;var t=function(){t.superclass.constructor.apply(this,arguments);var a=++jet.radioButtons,c=[],b=this.addAttrs({options:{required:true},
className:{value:"radio"},namePrefix:{value:"jet-radio"},buttons:{readOnly:true,value:c},selected:{value:0},value:{}});this.on("selectedChange",function(d,e,g){c[g][0].checked=false;if(m.isNumber(e))c[e][0].checked=true}).on("render",function(){var d=b.get("boundingBox");b.get("classPrefix");b.get("className");var e=b.get("options"),g=b.get("namePrefix");n.each(e,function(k,i){var h=f("<span/>").appendTo(d),l=g+a+"-"+i,j=f("<input/>").attr({type:"radio",name:g+a,id:l,value:k.value}).appendTo(h);h=
f("<label/>").html(k.label).appendTo(h);h[0].setAttribute("for",l);j.link(h).on("click",function(r,w){return function(){if(b.fire("click",r)&&r!==void 0){b.fire("change",r,j);b.set("selected",r);b.set("value",w[0].value)}}}(i,j));c.push(j);if(i===b.get("selected")){j[0].checked=true;b.set("value",j[0].value)}})})};f.extend(t,f.Widget,{disable:function(a){var c=this.get("buttons");n.each(m.isNumber(a)?[c[a]]:c,function(b){b[0].disabled=true;b.next().addClass("disabled")});return this},enable:function(a){var c=
this.get("buttons");n.each(m.isNumber(a)?[c[a]]:c,function(b){b[0].disabled=false;b.next().removeClass("disabled")});return this}});if(!jet.checkboxes)jet.checkboxes=1;var u=function(){u.superclass.constructor.apply(this,arguments);var a=this.addAttrs({buttonNode:{readOnly:true,value:f("<input/>").attr("type","checkbox")},label:{value:""},className:{value:"checkbox"},checked:{value:false,getter:function(){return a.get("buttonNode")[0].checked},setter:function(b){return a.get("buttonNode")[0].checked=
b}}}),c=++jet.checkboxes;this.on("render",function(){var b=a.get("boundingBox");c=a.get("classPrefix")+a.get("className")+"-"+c;var d=a.get("buttonNode").attr("id",c).appendTo(b);f("<label/>").html(a.get("label")).appendTo(b)[0].setAttribute("for",c);d[0].disabled=!!a.get("disabled");d.on("click",function(){var e=d[0].checked;if(e!=a.get("checked"))if(!a.fire("change",e))d[0].checked=!e})})};f.extend(u,o);f.add({Button:p,ComboBox:s,RadioButton:t,CheckBox:u})});
