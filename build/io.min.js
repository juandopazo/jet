/*
 Copyright (c) 2010, Juan Ignacio Dopazo. All rights reserved.
 Code licensed under the BSD License
 http://code.google.com/p/jet-js/wiki/Licence
*/
jet().add("io",function(f){var l=f.win,u=f.Hash,o=!!l.ActiveXObject,v=!!l.XMLHttpRequest,g=function(a){return new l.ActiveXObject(a)},q=function(a){var b=[];u.each(a,function(d,c){b.push(d+"="+c)});return b.join("&")},n=function(a){var b;try{b=g("Msxml2.DOMDocument.6.0");n=function(e){return e=="xsl"?g("Msxml2.FreeThreadedDOMDocument.6.0"):g("Msxml2.DOMDocument.6.0")}}catch(d){try{b=g("Msxml2.DOMDocument.3.0");n=function(e){return e=="xsl"?g("Msxml2.FreeThreadedDOMDocument.3.0"):g("Msxml2.DOMDocument.3.0")}}catch(c){}}return n(a)},
m=function(){var a=location.host;if((location.protocol=="file:"||a=="localhost"||a=="127.0.0.1")&&o)m=function(){return g("Microsoft.XMLHTTP")};else if(v)m=function(){return new XMLHttpRequest};else if(o)m=function(){return g("Microsoft.XMLHTTP")};return m()},r=function(a,b,d){var c=null;if(a.responseXML)c=a.responseXML;else if(l.DOMParser){c=new l.DOMParser;c=c.parseFromString(a.responseText||a,"text/xml")}else if(o){c=n(b);c.async=false;c.loadXML(a.responseText||a);c.parseError.errorCode!==0&&d("Bad status",
c.parseError)}else d(0,{reason:"Can't find a suitable XML parser",srcText:a});return c},s=function(a,b,d){b=b||a.getResponseHeader("Content-type");switch(b){case "application/xml":case "xml":case "xsl":return r(a,b,d);case "json":try{return f.JSON.parse(a.responseText)}catch(c){f.error(c)}break;default:return a.responseText}};if(!jet.IO)jet.IO={};if(!jet.IO.jsonpCallbacks)jet.IO.jsonpCallbacks=[];f.add({ajax:function(a){var b=m(),d=a.success,c=null,e=a.dataType,h=a.timeout||1E4,i=a.method||"GET",
p=a.async||true,t=a.complete||function(){},w=function(){d&&d.apply(f,arguments);t.apply(f,arguments)},j=function(x,y,z){a.error&&a.error(x,y,z);t.apply(f,arguments)},k=a.url;if(b){if(e&&(e==="xml"||e==="xsl")&&b.overrideMimeType)b.overrideMimeType("text/xml");if(k){if(k.substr(k.length-1)!="?")k+="?";if(a.data)k+=q(a.data);if(p===true)b.onreadystatechange=function(){if(b.readyState===4)if(b.status===404)j("File not found",b.status,b);else if(b.status===408)j("timeout",b.status,b);else b.status===
200||b.responseText||b.responseXML?w(s(b,e,j),b):j("Bad status",b.status,b)};try{b.open(i,k,p);b.send(null)}catch(A){j("Bad status",404,b)}if(p===false)c=s(b,e,j);else setTimeout(function(){if(b.readyState!==4){b.abort();j("timeout",408,b)}},h)}}return c||f},jsonp:function(a){a=a||{};var b=a.jsonCallbackParam||"p",d=jet.IO.jsonpCallbacks,c=d.length,e=false,h=a.url;if(h){d[c]=function(i){e=true;a.success&&a.success(i);a.complete&&a.complete(i)};if(h.substr(h.length-1)!="?")h+="?";if(!a.data)a.data=
{};settins.data[b]="jet.IO.jsonpCallbacks["+c+"]";setTimeout(function(){f.Get.script(h+q(a.data))},0);setTimeout(function(){if(!e){var i={message:"Request failed",reason:"Timeout"};a.error&&a.error(i);a.complete&&a.complete(i)}},a.timeout||1E4)}}});f.IO={utils:{parseXML:r}}});
