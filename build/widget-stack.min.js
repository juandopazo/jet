/**
 * @module widget-stack
 * @requires base
 * 
 * Copyright (c) 2011, Juan Ignacio Dopazo. All rights reserved.
 * Code licensed under the BSD License
 * https://github.com/juandopazo/jet/blob/master/LICENSE.md
*/
jet.add("widget-stack",function(b){function e(){var a=this.get(d);if(a===0){c[a=c.length]=this;this.set(d,a)}else{c.splice(a,0,this);this._refreshZIndex()}this._shim=b("<iframe/>").attr({src:"javascript:false",frameborder:0}).addClass(this.getClassName(h)).css({zIndex:a})}var g=b.Lang,i=b.Array,c,d="zIndex",h="shim";if(!jet.layers)jet.layers=[];c=jet.layers;b.WidgetStack=b.mix(e,{ATTRS:{shim:{value:b.UA.ie==6,validator:g.isBoolean},zIndex:{value:0,setter:function(a){if(g.isString(a))a=parseInt(a,
10);g.isNumber(a)||(a=0);return a}}},MIN_ZINDEX:1,EVENTS:{render:function(){this.get("boundingBox").css(d,e.MIN_ZINDEX+this.get(d))},afterRender:function(){if(this.get(h)){this._shim.insertBefore(this.get("boundingBox"));this.syncShim();b.on("resize",this.syncShim,this)}},afterShimChange:function(a){var f=this._shim;if(a.newVal){f.insertBefore(this.get("boundingBox"));b.on("resize",this.syncShim,this)}else{f.remove();b.unbind("resize",this.syncShim)}},afterZIndexChange:function(a){this.get("boundingBox").css(d,
a.newVal)},focus:function(){this.bringToFront()},blur:function(){this.sendToBack()},destroy:function(){}},HTML_PARSER:{zIndex:function(a){return a.css(d)}}});e.prototype={_refreshZIndex:function(){for(var a=0,f=e.MIN_ZINDEX,j=c.length;a<j;a++)c[a].set(d,f+a);return this},syncShim:function(){var a=this.get("boundingBox").offset();this._shim.setPosition(a.left,a.top).width(a.width).height(a.height);return this},bringToFront:function(){i.remove(this,c).push(this);return this._refreshZIndex()},sendToBack:function(){i.remove(this,
c).unshift(this);return this._refreshZIndex()}}});
