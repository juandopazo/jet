/**
 * @module swf
 * @requires 
 * 
 * Copyright (c) 2011, Juan Ignacio Dopazo. All rights reserved.
 * Code licensed under the BSD License
 * https://github.com/juandopazo/jet/blob/master/LICENSE.md
*/
jet.add("swf",function(c){c.SWF=c.Base.create("swf",c.Widget,[],{ATTRS:{src:{required:true},swfNode:{getter:function(){return this._swfNode}},wmode:{value:"transparent"},nodeType:{value:"application/x-shockwave-flash"},flashvars:{valueFn:function(){return{}},getter:function(a){return c.Array.map(c.Object.keys(a),function(b){return b+"="+escape(a[b])}).join("&")}},allowFullscreen:{value:true,validator:c.Lang.isBoolean,getter:function(a){return a.toString()}},name:{valueFn:c.guid},allowScriptAccess:{value:"always"}},
OBJECT_INLINE_ATTRS:{name:1,id:1,type:1,width:1,height:1,data:1},SWF_ATTRS:{src:1,wmode:1,type:"nodeType",flashvars:1,allowFullscreen:1,name:1,movie:"src",data:"src",id:"name",allowScriptAccess:1,width:1,height:1}},{CONTENT_TEMPLATE:null,_getObjectString:function(){var a="<object ",b="";c.Object.each(c.SWF.SWF_ATTRS,function(d,e){if(e){var f=e===1?d:e;if(c.SWF.OBJECT_INLINE_ATTRS[d])a+=d+'="'+this.get(f)+'"';else b+='<param name="'+d+'" value="'+this.get(f)+'">'}},this);a+='style="width:'+this.get("width")+
"px;height:"+this.get("height")+'px;"';return a+">"+b+"</object>"},_setAttrObject:function(a,b){var d=false;this._swfNode.children().forEach(function(e){if(e.getAttribute("name")===a){e.setAttribute("value",b);d=true}});d||c("<param/>").attr({name:a,value:b}).appendTo(this._swfNode)},_syncSwfHeight:function(a){this.setAttr(a.attrName,a.newVal);this._swfNode&&this._swfNode[a.attrName](a.newVal)},setAttr:function(a,b){this.get("rendered")&&this._setAttrObject(a,b);return this},setAttrs:function(a){c.Object.each(a,
function(b,d){this.setAttr(b,d)},this);return this},_relayFSCommand:function(a,b){this.fire("fscommand",{cmd:a,args:b})},_attachFSCommand:function(a){if(a.attachEvent){this._fscmdHandler=c.bind(this._relayFSCommand,this);a.attachEvent("FSCommand",this._fscmdHandler)}else a.ownerDocument.defaultView[a.id+"_DoFSCommand"]=c.bind(this._relayFSCommand,this)},_trackLoadStatus:function(a){function b(){if(a.PercentLoaded()===100){loaded=true;e.fire("load")}else d=setTimeout(c.bind(b,e,a),50)}var d,e=this,
f=true;loaded=false;try{a.PercentLoaded()}catch(g){f=false}f&&b();setTimeout(function(){d&&clearTimeout(d);loaded||e.fire("load")},3E3)},initializer:function(){this.after("widthChange",this._syncSwfHeight);this.after("heightChange",this._syncSwfHeight)},renderUI:function(a,b){b.html(this._getObjectString());this._swfNode=b.first()},bindUI:function(){this._attachFSCommand(this._swfNode.getDOMNode())},syncUI:function(){this._swfNode.width(this.get("width")).height(this.get("height"))},destructor:function(){var a=
this._swfNode.getDOMNode();if(a.attachEvent){if(this._fscmdHandler){a.detachEvent("FSCommand",this._fscmdHandler);delete this._fscmdHandler}}else delete a.ownerDocument.defaultView[a.id+"_DoFSCommand"]}})});
