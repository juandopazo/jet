/**
 * @module resize
 * @requires base
 * 
 * Copyright (c) 2011, Juan Ignacio Dopazo. All rights reserved.
 * Code licensed under the BSD License
 * https://github.com/juandopazo/jet/blob/master/LICENSE.md
*/
jet.add("resize",function(g){var k=g.Lang,l=g.Hash,j=g.DOM,m=g.Resize=g.Base.create("resize",g.Utility,[],{ATTRS:{node:{required:true,setter:function(a){return g(a)}},handles:{value:["b","r","br"],validator:k.isArray},hiddenHandles:{value:false},prefix:{value:"yui"},minWidth:{value:0},minHeight:{value:0},constrain:{value:false},useProxy:{value:false,writeOnce:true},animate:{value:false,validator:function(){return this.get("proxy")}},reposition:{value:false},shim:{value:false},locked:{value:false},
capturing:{value:false},screenSize:{value:j.screenSize()}},EVENTS:{destroy:function(){this._tracker.destroy()}}},{initializer:function(){var a=this._tracker=new g.Mouse({shim:this.get("shim")});this._setupProxy();this._setupHandlers();a.on("up",this._stop,this);a.on("mousemove",this._during,this)},_setupProxy:function(){var a=this.get("node"),b=this.get("useProxy"),d=b=="clone"?a.clone():b?g("<div/>"):a,c=a.currentStyle();if(b){if(b===true){a.offset();d.addClass("yui-resize-proxy").css({left:c.left,
top:c.top,bottom:c.bottom,right:c.right,width:c.width,height:c.height})}else b=="clone"&&d.css({visibility:"hidden",opacity:0.5});d.appendTo(a.parent())}this.set("proxy",d)},_onHandleMouseDown:function(a){if(!this.get("locked")){var b=g(a.target);if(b.hasClass(this.get("prefix")+"-resize-handle-inner"))b=b.parent();var d=b._nodes[0].type,c=this.get("proxy").offset(),e=this._tracker;this.set("capturing",d);e.get("shields").css("cursor",b.currentStyle().cursor);e.set("tracking",true);this._start(a.clientX,
a.clientY,c.left,c.top,d);this.fire("resize:start",this.get("currentWidth"),this.get("currentHeight"),c.left,c.top,d)}},_onHandleMouseOver:function(a){a=g(a.target);var b=this.get("prefix")+"-resize",d=b+"-hover";b=b+"-handle";if(a.hasClass(b+"-inner"))a=a.parent();if(!this.get("locked")&&!this.get("capturing")){a.addClass([b,"-active ",b,"-",a._nodes[0].type,"-active"].join(""));this.get("hover")&&this.get("node").removeClass(d)}},_onHandleMouseOut:function(a){a=g(a.target);var b=this.get("prefix")+
"-resize",d=b+"-hover";b=b+"-handle";if(a.hasClass(b+"-inner"))a=a.parent();if(!this.get("locked")){a.removeClass(b+"-active").removeClass(b+"-"+a._nodes[0].type+"-active");this.get("hover")&&this.get("node").addClass(d)}},_setupHandlers:function(){var a=this,b=this.get("node");this.get("proxy");var d=this.get("prefix")+"-resize",c=d+"-hover",e=d+"-handle";g.Array.each(this.get("handles"),function(f){var h=g("<div/>");h.addClass([e," ",e,"-",f].join(""));h._nodes[0].type=f;a._handlers.push(h.on("mousedown",
a._onHandleMouseDown,a),h.on("mouseover",a._onHandleMouseOver,a),h.on("mouseout",a._onHandleMouseOut,a));h.append(g("<div/>").addClass(e+"-inner",e+"-inner-"+f)).appendTo(b)});b.addClass(d).css("display","block");if(this.get("hiddenHandles"))b.addClass(d+"-hidden");else this.get("hover")&&b.addClass(c)},_getNew:function(a,b,d){var c=a=="height",e=this.get(c?"resizeVertical":"resizeHorizontal"),f=this.get(c?"originalHeight":"originalWidth"),h=c?"Y":"X";b=e==(c?"t":"l")?f-(c?d:b)+this.get("start"+h):
e==(c?"b":"r")?f+(c?d:b)-this.get("start"+h):f;d=this.get("min"+a.substr(0,1).toUpperCase()+a.substr(1));c=this.get("max"+a.substr(0,1).toUpperCase()+a.substr(1));e=this.get("screenSize");return b<d?d:c&&b>c?c:this.get("constrain")&&b>e[a]?e[a]:b},_start:function(a,b,d,c){var e=this.get("node"),f=this.get("capturing"),h=f.indexOf("t")>-1?"t":f.indexOf("b")>-1?"b":false;f=f.indexOf("r")>-1?"r":f.indexOf("l")>-1?"l":false;this.set({resizeVertical:h,resizeHorizontal:f,startX:a,startY:b});a=j.screenSize();
b=e.width();var i=e.height();this.set({currentWidth:b,currentHeight:i,originalWidth:b,originalHeight:i,screenSize:a});f&&e.width(b);h&&e.height(i);if(this.get("reposition"))e.css({top:h=="t"?"auto":c+"px",bottom:h=="b"?"auto":a.height-c-i+"px",left:f=="l"?"auto":d+"px",right:f=="r"?"auto":a.width-d-b+"px"});this.get("useProxy")&&this.get("proxy").css("visibility","visible")},_during:function(a,b,d){this.set({lastX:b,lastY:d});if(!this.get("locked")&&this.get("capturing")){a=this.get("proxy");var c=
a.offset(),e=this.get("currentWidth"),f=this.get("currentHeight"),h=this.get("resizeHorizontal"),i=this.get("resizeVertical");if(this.fire("beforeResize",e,f,c.left,c.top)){j.screenSize();if(i)this.set("currentHeight",f=this._getNew("height",b,d));if(h)this.set("currentWidth",e=this._getNew("width",b,d));if(this.fire("resize",e,f,c.left,c.top)){i&&k.isNumber(f)&&a.height(f);h&&k.isNumber(e)&&a.width(e)}}else this._stop(null,b,d)}},_stop:function(a,b,d){if(!this.get("locked")){var c=this.get("node");
a=this._getNew("width",b,d);b=this._getNew("height",b,d);if(this.get("capturing")){j.screenSize();d=this.get("resizeVertical");var e=this.get("resizeHorizontal");if(this.get("animate")){if(g.Tween){var f={};if(d)f.height=b;if(e)f.width=a;(new g.Tween({node:c,to:f,duration:"fast"})).start()}}else{d&&c.height(b);e&&c.width(a)}}this.set("capturing",false);d=this.get("proxy");if(this.get("useProxy")){d.css("visibility","hidden");c=d.offset()}else c=c.offset();this.fire("resize:end",a,b,c.left,c.top)}},
stop:function(){this._stop(null,this.get("lastX"),this.get("lastY"));return this},lock:function(){return this.set("locked",true)},unlock:function(){return this.set("locked",false)}});l.each({Top:"t",Bottom:"b",Left:"l",Right:"r",TopLeft:"tl",TopRight:"t"*"r",BottomLeft:"bl",BottomRight:"br"},function(a,b){m[a]=b})});
