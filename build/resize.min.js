/*
 Copyright (c) 2010, Juan Ignacio Dopazo. All rights reserved.
 Code licensed under the BSD License
 http://code.google.com/p/jet-js/wiki/Licence
*/
jet().add("resize",function(e){var y=e.Lang,H=e.Hash,m=function(){m.superclass.constructor.apply(this,arguments);var b=this;b.addAttrs({node:{required:true,setter:function(a){return e(a)}},handles:{value:[m.Bottom,m.Right,m.BottomRight],validator:y.isArray},hiddenHandles:{value:false},prefix:{value:"yui"},minWidth:{value:0},minHeight:{value:0},constrain:{value:false},proxy:{value:false},animate:{value:false,validator:function(){return b.get("proxy")}},reposition:{value:false},shim:{value:false},locked:{value:false}});
var c=b.get("node"),E={height:b.get("minHeight"),width:b.get("minWidth")},z={height:b.get("maxHeight"),width:b.get("maxWidth")},n=b.get("proxy"),k=n=="clone"?c.clone():n?e("<div/>"):c,j=c.currentStyle();if(n){if(n===true){c.offset();k.addClass("yui-resize-proxy").css({left:j.left,top:j.top,bottom:j.bottom,right:j.right,width:j.width,height:j.height})}else n=="clone"&&k.css({visibility:"hidden",opacity:0.5});k.appendTo(c.parent())}var l=false,u={X:0,Y:0},A,B,g,h,o={width:0,height:0},p=false,q=false,
w=function(a,d,f){var i=a=="height",v=i?p:q,s=i?B:A,t=i?"Y":"X";d=v==(i?"t":"l")?s-(i?f:d)+u[t]:v==(i?"b":"r")?s+(i?f:d)-u[t]:s;return d<E[a]?E[a]:z[a]&&d>z[a]?z[a]:b.get("constrain")&&d>o[a]?o[a]:d},x=new e.utils.MouseTracker({shim:b.get("shim")}),C=function(a,d,f){if(!b.get("locked")){if(l){o=e.screenSize();g=w("width",d,f);h=w("height",d,f);if(b.get("animate")){if(e.Anim){a={};if(p)a.height=h;if(q)a.width=g;(new e.Anim({node:c,to:a,duration:"fast"})).start()}}else{p&&c.height(h);q&&c.width(g)}}l=
false;if(n){k.css("visibility","hidden");a=k.offset()}else a=c.offset();b.fire("endResize",g,h,a.left,a.top)}},F,G;j=b.get("prefix")+"-resize";var D=j+"-hover",r=j+"-handle";e.Array.each(b.get("handles"),function(a){var d=e("<div/>");d.addClass([r," ",r,"-",a].join(""));d.on("mousedown",function(f){if(!b.get("locked")){var i=k.offset();l=a;x.get("shim").css("cursor",d.currentStyle().cursor);x.set("tracking",true);var v=f.clientX;f=f.clientY;var s=i.left,t=i.top;p=l.indexOf("t")>-1?"t":l.indexOf("b")>
-1?"b":false;q=l.indexOf("r")>-1?"r":l.indexOf("l")>-1?"l":false;u.X=v;u.Y=f;o=e.screenSize();g=A=c.width();h=B=c.height();c.width(A).height(B);if(b.get("reposition"))c.css({top:p=="t"?"auto":t+"px",bottom:p=="b"?"auto":o.height-t-h+"px",left:q=="l"?"auto":s+"px",right:q=="r"?"auto":o.width-s-g+"px"});n&&k.css("visibility","visible");b.fire("startResize",g,h,i.left,i.top,a)}}).on("mouseover",function(){if(!b.get("locked")&&!l){d.addClass([r,"-active ",r,"-",a,"-active"].join(""));b.get("hover")&&
c.removeClass(D)}}).on("mouseout",function(){if(!b.get("locked")){d.removeClass(r+"-active").removeClass(r+"-"+a+"-active");b.get("hover")&&c.addClass(D)}}).append(e("<div/>").addClass(r+"-inner-"+a)).appendTo(c)});c.addClass(j).css("display","block");if(b.get("hiddenHandles"))c.addClass(j+"-hidden");else b.get("hover")&&c.addClass(D);x.on("mouseup",C);x.on("mousemove",function(a,d,f){F=d;G=f;if(!b.get("locked")&&l){a=k.offset();if(b.fire("beforeResize",g,h,a.left,a.top)){o=e.screenSize();if(p)h=
w("height",d,f);if(q)g=w("width",d,f);a=k.offset();b.fire("resize",g,h,a.left,a.top)&&y.isNumber(h)&&y.isNumber(g)&&k.height(h).width(g)}else C(d,f)}});this.stop=function(){C(F,G);return this}};e.extend(m,e.Utility,{lock:function(){return this.set("locked",true)},unlock:function(){return this.set("locked",false)}});H.each({Top:"t",Bottom:"b",Left:"l",Right:"r",TopLeft:"tl",TopRight:"t"*"r",BottomLeft:"bl",BottomRight:"br"},function(b,c){m[b]=c});e.Resize=m});
