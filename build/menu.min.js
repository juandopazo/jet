/**
 * @module menu
 * @requires base,container
 * 
 * Copyright (c) 2011, Juan Ignacio Dopazo. All rights reserved.
 * Code licensed under the BSD License
 * https://github.com/juandopazo/jet/blob/master/LICENSE.md
*/
jet.add("menu",function(b){var g=b.Lang,h=b.Array,e=b.Base,f=b.Widget;b.MenuItem=e.create("menuitem",f,[b.WidgetParent,b.WidgetChild],{ATTRS:{labelNode:{value:"<span/>",setter:b},labelContent:{value:""},defaultChildType:{value:"MenuItem"},align:{value:{align:[b.WidgetAlignment.TopLeft,b.WidgetAlignment.TopRight]}},atLeastOne:{value:false}}},{BOUNDING_TEMPLATE:"<li/>",CONTENT_TEMPLATE:"<a/>",CONTAINER_TEMPLATE:"<ul/>",initializer:function(){this.set("childrenContainer",this.CONTAINER_TEMPLATE);this.set("labelNode",
this.get("labelNode"))},_uiMenuMouseover:function(){var a=this.get("parent");this.get("boundingBox").addClass(this.getClassName("hover"));a.get("interaction")=="os"&&a.get("selection")&&this.select()},_uiMenuMouseout:function(){this.get("boundingBox").removeClass(this.getClassName("hover"))},_uiMenuLabelContentChange:function(a){this.get("labelNode").setContent(a.newVal)},_uiMenuAfterSelected:function(a){var c=this._olay;if(this.get("children").length>0){c.get("rendered")||c.render(this.get("boundingBox"));
c.set("visible",a.newVal)}},renderUI:function(a){var c=this.get("contentBox").attr("href","#"),d=this.get("align");d.node=a;d=this._olay=new b.Overlay({align:d,visible:this.get("selected")});this.get("labelNode").addClass(this.getClassName("label")).appendTo(c);if(this.get("children").length>0){d.render(a);a.addClass(this.getClassName("submenu"))}this.get("childrenContainer").addClass(this.getClassName("container")).appendTo(d.get("body"))},bindUI:function(){this._handlers.push(this.get("contentBox").on("click",
this._toggleSelected,this));this.on("mouseover",this._uiMenuMouseover);this.on("mouseout",this._uiMenuMouseout);this.after("labelContentChange",this._uiMenuLabelContentChange);this.after("selectedChange",this._uiMenuAfterSelected)},syncUI:function(){this.get("labelNode").setContent(this.get("labelContent"))},_toggleSelected:function(a){a.preventDefault();this.toggle()}});b.Menu=e.create("menu",f,[b.WidgetParent],{ATTRS:{defaultChildType:{value:"MenuItem"},align:{value:{align:[b.WidgetAlignment.TopLeft,
b.WidgetAlignment.BottomLeft]}},multiple:{value:false,readOnly:true},interaction:{value:"os",writeOnce:true}},EVENTS:{addChild:function(a){a=a.child;if(!(a instanceof b.MenuItem))a.align=a.align||this.get("align")},afterAddChild:function(a){a=a.child;if(this.get("interaction")=="os"){a._handlers.push(a.on("mouseover",b.bind(this._onMenuMouseOver,this)));a._handlers.push(a.on("mouseout",b.bind(this._onMenuMouseOut,this)))}},click:function(a){a=a.domEvent.target;if(!this.get("multiple")&&a==this.get("boundingBox")[0]||
a==this.get("contentBox")[0])(a=this.get("selection"))&&a.unselect()}}},{CONTENT_TEMPLATE:"<ul/>",_onMenuMouseOver:function(){this._menuTimeout&&clearTimeout(this._menuTimeout)},_onMenuMouseOut:function(){var a=this;this._menuTimeout&&clearTimeout(this._menuTimeout);this._menuTimeout=setTimeout(function(){var c=a.get("selection");if(g.isArray(c))h.each(c,function(d){d.unselect()});else c&&c.unselect()},1E3)},initializer:function(){if(this.get("interaction")=="os"){this.on("mouseout",this._onMenuMouseOut);
this.on("mouseover",this._onMenuMouseOver)}}})});
