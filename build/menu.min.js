/**
 * @module menu
 * @requires base,widget-parentchild,widget-alignment
 * 
 * Copyright (c) 2011, Juan Ignacio Dopazo. All rights reserved.
 * Code licensed under the BSD License
 * https://github.com/juandopazo/jet/blob/master/LICENSE.md
*/
jet.add("menu",function(b){b.MenuItem=b.Base.create("menuitem",b.Widget,[b.WidgetChild,b.WidgetParent,b.WidgetAlignment],{ATTRS:{labelNode:{value:"<span/>",setter:b},label:{value:""},align:{valueFn:function(){return{points:["tl","bl"],offset:[0,0]}}},constrain:{value:true},defaultChildType:{value:"MenuItem"}}},{BOUNDING_TEMPLATE:"<li/>",CONTENT_TEMPLATE:"<a/>",CONTAINER_TEMPLATE:"<ul/>",_toggleContainer:function(a){this._container.toggleClass(this.getClassName("container","hidden"),this.size()==0?
true:!a)},_updateLabel:function(a){this.get("labelNode").html(a)},initializer:function(){this.set("labelNode",this.get("labelNode"));this._container=b(this.CONTAINER_TEMPLATE);this.set("childrenContainer",this._container);this.set("alignedNode","childrenContainer");this.get("align").node=this.get("contentBox");this.after("labelContentChange",function(a){this._updateLabel(a.newVal)});this.after("selectedChange",function(){b.wait(0,this,this._repositionUI)})},renderUI:function(a,c){c.attr("href","#").append(this.get("labelNode").addClass(this.getClassName("label")));
this._container.addClass(this.getClassName("container")).appendTo(a)},bindUI:function(){this.after("selectedChange",function(a){this._toggleContainer(a.newVal)});this.on("click",function(a){if(a.currentTarget===this){a.domEvent.preventDefault();this.set("selected",!this.get("selected"))}})},syncUI:function(){this._toggleContainer(this.get("selected"));this._updateLabel(this.get("label"))}});b.MenuBar=b.Base.create("menubar",b.Widget,[b.WidgetParent],{ATTRS:{defaultChildType:{value:"MenuItem"}}},{CONTENT_TEMPLATE:"<ul/>",
renderUI:function(){this.size()>0&&this.item(0).unselect()},bindUI:function(a){this._handlers.push(b(b.config.doc).on("click",function(c){var d=this.get("selection");d&&!a.contains(c.target)&&d.unselect()},this))}});b.SimpleMenu=b.Base.create("simplemenu",b.Widget,[b.WidgetParent],{ATTRS:{defaultChildType:{value:"MenuItem"},multiple:{value:false}}},{CONTENT_TEMPLATE:"<ul/>",_smPreventNoSelection:function(a){var c=this.get("selection");if(!a.newVal&&(!c||c===a.target))a.preventDefault()},initializer:function(){this.after("addChild",
function(a){a.child.on("selectedChange",this._smPreventNoSelection,this)})}})});
