/**
 * @module menu
 * @requires base,container
 * 
 * Copyright (c) 2011, Juan Ignacio Dopazo. All rights reserved.
 * Code licensed under the BSD License
 * https://github.com/juandopazo/jet/blob/master/LICENSE.md
*/
jet.add("menu",function(b){var g=b.Lang,h=b.Array,e=b.Base,f=b.Widget;b.MenuItem=e.create("menuitem",f,[b.WidgetParent,b.WidgetChild],{ATTRS:{labelNode:{value:"<span/>",setter:b},labelContent:{value:""},defaultChildType:{value:"MenuItem"},align:{value:[b.WidgetAlignment.TopLeft,b.WidgetAlignment.TopRight]}},EVENTS:{render:function(){var c=this.get("boundingBox"),a=this.get("contentBox").attr("href","#"),d=this._olay=new b.Overlay({align:{node:c,points:this.get("align")}});this.get("labelNode").addClass(this.getClassName("label")).html(this.get("labelContent")).appendTo(a);
this.get("children").length>0&&d.render(c);this.get("childrenContainer").appendTo(d.get("body"));this.get("children").length>0&&c.addClass(this.getClassName("submenu"));this.get("selected")||d.hide();c.on("click",this._toggleSelected,this)},mouseover:function(){var c=this.get("parent");this.get("boundingBox").addClass(this.getClassName("hover"));c.get("interaction")=="os"&&c.get("selection")&&this.select()},mouseout:function(){this.get("boundingBox").removeClass(this.getClassName("hover"))},afterLabelContentChange:function(c,
a){this.get("labelNode").setContent(a)},afterSelectedChange:function(c,a){var d=this._olay;if(a&&this.get("children").length>0){d.get("rendered")||d.render(this.get("boundingBox"));d.show()}else d.hide()}}},{BOUNDING_TEMPLATE:"<li/>",CONTENT_TEMPLATE:"<a/>",initializer:function(){this.set("childrenContainer","<ul/>");this.set("labelNode",this.get("labelNode"))},_toggleSelected:function(c){if(c.target==this.get("labelNode")[0]){c.preventDefault();this.toggle()}}});b.Menu=e.create("menu",f,[b.WidgetParent],
{ATTRS:{defaultChildType:{value:"MenuItem"},align:{value:[b.WidgetAlignment.TopLeft,b.WidgetAlignment.BottomLeft]},multiple:{value:false,readOnly:true},interaction:{value:"os",writeOnce:true}},EVENTS:{addChild:function(c,a){if(!(a instanceof b.MenuItem))a.align=a.align||this.get("align")},afterAddChild:function(c,a){if(this.get("interaction")=="os"){a._handlers.push(a.on("mouseover",b.bind(this._onMenuMouseOver,this)));a._handlers.push(a.on("mouseout",b.bind(this._onMenuMouseOut,this)))}},click:function(c,
a){var d=a.target;if(!this.get("multiple")&&d==this.get("boundingBox")[0]||d==this.get("contentBox")[0])(d=this.get("selection"))&&d.unselect()}}},{CONTENT_TEMPLATE:"<ul/>",_onMenuMouseOver:function(){this._menuTimeout&&clearTimeout(this._menuTimeout)},_onMenuMouseOut:function(){var c=this;this._menuTimeout&&clearTimeout(this._menuTimeout);this._menuTimeout=setTimeout(function(){var a=c.get("selection");if(g.isArray(a))h.each(a,function(d){d.unselect()});else a&&a.unselect()},1E3)},initializer:function(){if(this.get("interaction")==
"os"){this.on("mouseout",this._onMenuMouseOut);this.on("mouseover",this._onMenuMouseOver)}}})});
