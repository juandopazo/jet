/**
 * @module imageloader
 * @requires base
 * 
 * Copyright (c) 2011, Juan Ignacio Dopazo. All rights reserved.
 * Code licensed under the BSD License
 * https://github.com/juandopazo/jet/blob/master/LICENSE.md
*/
jet.add("imageloader",function(c){var h=c.Lang,g=c.Base,i=c.Array,j=c.Img=g.create("image",g,[],{ATTRS:{src:{required:true,writeOnce:true,validator:h.isString},image:{value:null},node:{value:null},timeout:{value:5E3},type:{value:"",validator:h.isString,getter:function(a){return a.toLowerCase()}},loaded:{value:false}},EVENTS:{load:function(){var a=this.get("image");this.get("type")=="png"&&c.UA.ie&&this.set("node",c("<span/>").css({display:"inline-block",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader (src='"+
this.get("src")+"',sizingMethod='crop');"}).height(a.height).width(a.width))}}},{initializer:function(){this.set("image",new Image).set("node",c(this.get("image")))},load:function(){var a=this,b=false,d=this.get("image");d.onload=function(){a.fire("load");a.fire("complete");b=true;a.set("loaded",true)};d.onerror=function(){a.fire("error");a.fire("complete");b=true};setTimeout(function(){if(!b){a.fire("timeout");a.fire("complete")}},a.get("timeout"));d.src=this.get("src");return this},setAsBackground:function(a){a=
c(a);var b=this,d=function(){var f=b.get("src");b.get("type")=="png"&&c.UA.ie?a.css("filter","progid:DXImageTransform.Microsoft.AlphaImageLoader (src='"+f+"',sizingMethod='crop');"):a.css("backgroundImage","url("+f+")")};b.get("loaded")?d():b.on("load",d);return b}});c.ImageLoader=g.create("imageloader",g,[],{ATTRS:{srcs:{validator:h.isArray}}},{load:function(){var a=this,b=0,d=this.get("srcs"),f=d.length;i.each(d,function(k){var e=new j({src:k,on:{load:function(){a.fire("image:load",e)},error:function(){a.fire("image:error",
e)},timeout:function(){a.fire("image:timeout",e)},complete:function(){a.fire("image:complete",e);b++;a.fire("progress",Math.round(b*100/f),e);b==f&&a.fire("complete")}}});e.load()});return this}})});
