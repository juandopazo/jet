/*
 Copyright (c) 2010, Juan Ignacio Dopazo. All rights reserved.
 Code licensed under the BSD License
 http://code.google.com/p/jet-js/wiki/Licence
*/
jet().add("imageloader",function(c){var i=c.Lang,k=c.Array,h=function(){h.superclass.constructor.apply(this,arguments);var a=new Image,d=c(a),b=this.addAttrs({src:{required:true,writeOnce:true,validator:i.isString},image:{readOnly:true,value:a},node:{value:d},timeout:{value:5E3}}),e=false;b.addAttrs({type:{value:"",validator:i.isString,getter:function(f){return f.toLowerCase()}},loaded:{readOnly:true,getter:function(){return!!e}}}).load=function(){var f=false;a.onload=function(){b.get("type")=="png"&&
c.UA.ie&&b.set("node",c("<span/>").css({display:"inline-block",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader (src='"+b.get("src")+"',sizingMethod='crop');"}).height(a.height).width(a.width));b.fire("load");b.fire("complete");e=f=true};a.onerror=function(){b.fire("error");b.fire("complete");f=true};setTimeout(function(){if(!f){b.fire("timeout");b.fire("complete")}},b.get("timeout"));a.src=b.get("src");return b}};c.extend(h,c.Base,{setAsBackground:function(a){a=c(a);var d=this,b=function(){var e=
d.get("src");d.get("type")=="png"&&c.UA.ie?a.css("filter","progid:DXImageTransform.Microsoft.AlphaImageLoader (src='"+e+"',sizingMethod='crop');"):a.css("backgroundImage","url("+e+")")};d.get("loaded")?b():d.on("load",b);return d}});var j=function(){j.superclass.constructor.apply(this,arguments);this.addAttrs({srcs:{validator:i.isArray}})};c.extend(j,c.Base,{load:function(){var a=this,d=0,b=a.get("srcs"),e=b.length;k.each(b,function(f){var g=new h({src:f,on:{load:function(){a.fire("image:load",g)},
error:function(){a.fire("image:error",g)},timeout:function(){a.fire("image:timeout",g)},complete:function(){a.fire("image:complete",g);d++;a.fire("progress",Math.round(d*100/e),g);d==e&&a.fire("complete")}}});g.load()});return a}});c.add({Image:h,ImageLoader:j})});
