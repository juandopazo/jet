/*
 Copyright (c) 2010, Juan Ignacio Dopazo. All rights reserved.
 Code licensed under the BSD License
 http://code.google.com/p/jet-js/wiki/Licence
*/
jet().add("base",function(f){var v=Object.prototype,o=f.Hash,l=f.Lang,w=function(a){var c=function(){};c.prototype=a;return new c},p=function(a,c,h){if(!c||!a)f.error("extend failed, verify dependencies");var i=c.prototype,e=w(i);a.prototype=e;e.constructor=a;a.superclass=i;if(c!=Object&&i.constructor==v.constructor)i.constructor=c;h&&f.mix(e,h,true)},u=function(){var a={},c=this,h=[];this.on=function(i,e){a[i]||(a[i]=[]);l.isObject(e)&&a[i].push(e);return c};this.once=function(i,e){h.push(e);return c.on(i,
e)};this.unbind=function(i,e){if(i)f.Array.remove(e,a[i]||[]);else a={};return c};this.fire=function(i){var e=a[i]||[],b=true;if(a["*"])e=e.concat(a["*"]);var d,g=e.length,k=false,m=Array.prototype.slice.call(arguments,1);m.unshift({stopPropagation:function(){k=true},preventDefault:function(){b=false},type:i,target:c});for(d=0;d<g;d++){if(l.isFunction(e[d]))e[d].apply(c,m);else l.isObject(e[d])&&e[d].handleEvent&&e[d].handleEvent.apply(e[d],m);if(h.indexOf(e[d])>-1){A.remove(h,e[d]);A.remove(e,e[d]);
d--}if(k)break}return b}},r=function(a){r.superclass.constructor.apply(this);a=a||{};var c=this,h={},i=function(b,d){h[b]=d;var g=l.isValue(a[b]);d.required&&d.readOnly&&f.error("You can't have both 'required' and 'readOnly'");d.readOnly&&g&&delete a[b];d.required&&!g&&f.error("Missing required attribute: "+b);if(g&&d.setter)a[b]=d.setter.call(c,a[b]);return c},e=function(b,d){h[b]=h[b]||{};var g=h[b];if(g.readOnly)f.error(b+" is a "+(g.writeOnce?"write-once":"read-only")+" attribute");else{if(!g.validator||
g.validator(d)){d=g.setter?g.setter.call(c,d):d;if(!l.isValue(a[b])&&g.value)a[b]=g.value;a[b]=a[b]==d?d:c.fire(b+"Change",d,a[b])?d:a[b]}if(g.writeOnce&&!g.readOnly)h[b].readOnly=true}};c.get=function(b){h[b]=h[b]||{};var d=h[b];if(d.writeOnce&&!d.readOnly)h[b].readOnly=true;if(!l.isValue(a[b]))a[b]=d.value;return d.getter?d.getter.call(c,a[b],b):a[b]};c.set=function(b,d){l.isHash(b)?o.each(b,function(g,k){e(g,k)}):e(b,d);return c};c.unset=function(b){delete a[b];return c};c.addAttr=i;c.addAttrs=
function(b){o.each(b,i);return c};c.getAttrs=function(){var b={};o.each(a,function(d){b[d]=c.get(d)});return b};c.isSet=function(b){return l.isValue(a[b])}};p(r,u);var q=function(){q.superclass.constructor.apply(this,arguments);var a=this.addAttr("on",{writeOnce:true,value:{}});o.each(a.get("on"),function(c,h){a.on(c,h)})};p(q,r);var s=function(){s.superclass.constructor.apply(this,arguments);var a=this;f(f.win).on("unload",function(){a.destroy&&a.destroy()})};p(s,q,{destroy:function(){var a=this;
a.fire("destroy")&&o.each(a,function(c){delete a[c]})}});var n=function(){n.superclass.constructor.apply(this,arguments);var a=this.addAttrs(n.ATTRS).addAttr("boundingBox",{readOnly:true,value:f("<div/>")});f(f.win).on("unload",function(){a.destroy&&a.destroy()})};n.CSS_PREFIX="yui";n.ATTRS={srcNode:{setter:f},classPrefix:{value:n.CSS_PREFIX+"-"},className:{value:"widget"},rendered:{value:false}};p(n,q,{hide:function(){this.fire("hide")&&this.get("boundingBox").css("visibility","hidden");return this.fire("afterHide")},
show:function(){this.fire("show")&&this.get("boundingBox").css("visibility","visible");return this.fire("afterShow")},focus:function(){this.fire("focus")&&this.set("focused",true);return this},blur:function(){this.fire("blur")&&this.set("focused",false);return this},render:function(a){var c=this;a&&c.set("srcNode",a);if(c.fire("render")){a=c.get("srcNode");c.get("boundingBox").addClass(c.get("classPrefix")+c.get("className")).appendTo(a).css("visibility","visible");c.set("rendered",true).focus();
setTimeout(function(){c.fire("afterRender")},0)}return c},destroy:function(){var a=this;if(a.fire("destroy")){a.get("boundingBox").unbindAll(true).remove();o.each(a,function(c){delete a[c]})}}});var t=function(){t.superclass.constructor.apply(this,arguments);var a=this.addAttr("frequency",{value:20}),c,h,i,e=false,b=new f([]),d;a.addAttr("tracking",{value:false,validator:l.isBoolean}).on("trackingChange",function(g,k){if(k){if(a.get("shim")){var m=[];d=f("iframe").each(function(j){j=f(j);j=j.offset();
m.push(f("<div/>").height(j.height).width(j.width).css({position:"absolute",left:j.left,top:j.top}).hide().appendTo(f.context.body)[0])});b=f(m)}if(!e){b.show();i=setInterval(function(){a.fire("mousemove",c,h)},a.get("frequency"));e=true}}else{b.hide();clearInterval(i);e=false}});f(f.context).on("selectstart",function(g){e&&g.preventDefault()});b.link(f(f.context),true).on("mousemove",function(g){c=g.clientX;h=g.clientY;a.get("tracking")&&a.get("shim")&&d.each(function(k,m){k=f(k);var j=k.offset();
f(b[m]).height(j.height).width(j.width).css({left:j.left+"px",top:j.top+"px"})})}).on("mouseup",function(){a.set("tracking",false).fire("up",c,h)});a.on("destroy",function(){b.unbindAll()})};p(t,s,{down:function(){return this.set("tracking",true)},up:function(){return this.set("tracking",false)}});f.utils.Mouse=t;f.add({Attribute:r,Base:q,Utility:s,Widget:n,EventTarget:u,extend:p})});
