/*
 Copyright (c) 2010, Juan Ignacio Dopazo. All rights reserved.
 Code licensed under the BSD License
 http://code.google.com/p/jet-js/wiki/Licence
*/
jet().add("base",function(h){var m=h.Hash,j=h.Lang,n=h.extend,u=function(){var a={},c=this;c.on=function(e,g){a[e]||(a[e]=[]);j.isObject(g)&&a[e].push(g);return c};c.unbind=function(e,g){h.Array.remove(g,a[e]||[]);return c};c.fire=function(e){var g=a[e]||[],i=true;if(a["*"])g=g.concat(a["*"]);var b,d=g.length,f=false,k=Array.prototype.slice.call(arguments,1);k.unshift({stopPropagation:function(){f=true},preventDefault:function(){i=false},type:e,target:c});for(b=0;b<d;b++){if(j.isFunction(g[b]))g[b].apply(c,
k);else j.isObject(g[b])&&g[b].handleEvent&&g[b].handleEvent.apply(g[b],k);if(f)break}return i};c.unbindAll=function(){a={};return c}},q=function(a){q.superclass.constructor.apply(this);a=a||{};var c=this,e={},g=function(b,d){e[b]=d;var f=j.isValue(a[b]);d.required&&d.readOnly&&h.error("You can't have both 'required' and 'readOnly'");d.readOnly&&f&&delete a[b];d.required&&!f&&h.error("Missing required attribute: "+b);if(f&&d.setter)a[b]=d.setter.call(c,a[b]);return c},i=function(b,d){e[b]=e[b]||{};
var f=e[b];if(f.readOnly)h.error(b+" is a "+(f.writeOnce?"write-once":"read-only")+" attribute");else{if(!f.validator||f.validator(d)){d=f.setter?f.setter.call(c,d):d;if(!j.isValue(a[b])&&f.value)a[b]=f.value;a[b]=a[b]==d?d:c.fire(b+"Change",d,a[b])?d:a[b]}if(f.writeOnce&&!f.readOnly)e[b].readOnly=true}};c.get=function(b){e[b]=e[b]||{};var d=e[b];if(d.writeOnce&&!d.readOnly)e[b].readOnly=true;if(!j.isValue(a[b]))a[b]=d.value;return d.getter?d.getter.call(c,a[b],b):a[b]};c.set=function(b,d){j.isHash(b)?
m.each(b,function(f,k){i(f,k)}):i(b,d);return c};c.unset=function(b){delete a[b];return c};c.addAttr=g;c.addAttrs=function(b){m.each(b,g);return c};c.getAttrs=function(){var b={};m.each(a,function(d){b[d]=c.get(d)});return b};c.isSet=function(b){return j.isValue(a[b])}};n(q,u);var o=function(){o.superclass.constructor.apply(this,arguments);var a=this.addAttr("on",{writeOnce:true,value:{}});m.each(a.get("on"),function(c,e){a.on(c,e)})};n(o,q);var r=function(){r.superclass.constructor.apply(this,arguments);
var a=this;h(h.win).on("unload",function(){a.destroy&&a.destroy()})};n(r,o,{destroy:function(){var a=this;a.fire("destroy")&&m.each(a,function(c){delete a[c]})}});var p=function(){p.superclass.constructor.apply(this,arguments);var a=this.addAttrs({srcNode:{setter:h},classPrefix:{value:p.CSS_PREFIX+"-"},className:{value:"widget"},rendered:{value:false}}).addAttr("boundingBox",{readOnly:true,value:h("<div/>")});h(h.win).on("unload",function(){a.destroy&&a.destroy()})};n(p,o,{hide:function(){this.fire("hide")&&
this.get("boundingBox").css("visibility","hidden");return this},show:function(){this.fire("show")&&this.get("boundingBox").css("visibility","visible");return this},render:function(a){a&&this.set("srcNode",a);if(this.fire("render")){a=this.get("srcNode");this.get("boundingBox").addClass(this.get("classPrefix")+this.get("className")).appendTo(a).css("visibility","visible");this.set("rendered",true);this.fire("afterRender")}return this},destroy:function(){var a=this;if(a.fire("destroy")){a.get("boundingBox").unbindAll(true).remove();
m.each(a,function(c){delete a[c]})}}});p.CSS_PREFIX="yui";var t=function(){t.superclass.constructor.apply(this,arguments);var a=this.addAttr("frequency",{value:20}),c,e,g,i=false,b=new h.NodeList([]),d;a.addAttr("tracking",{value:false,validator:j.isBoolean}).on("trackingChange",function(f,k){if(k){if(a.get("shim")){b.splice(0,b.length);d=h("iframe").each(function(s){var l=s.offset();b.push(h("<div/>").height(l.height).width(l.width).css({position:"absolute",left:l.left,top:l.top}).hide().appendTo(s.parent())[0])})}if(!i){b.show();
g=setInterval(function(){a.fire("mousemove",c,e)},a.get("frequency"));i=true}}else{b.hide();clearInterval(g);i=false}});h(h.context).on("selectstart",function(f){i&&f.preventDefault()});b.link(h(h.context),true).on("mousemove",function(f){c=f.clientX;e=f.clientY;a.get("tracking")&&a.get("shim")&&d.each(function(k,s){var l=k.offset();b[s].height(l.height).width(l.width).css({left:l.left+"px",top:l.top+"px"})})}).on("mouseup",function(){a.set("tracking",false).fire("up",c,e)});a.on("destroy",function(){b.unbindAll()})};
n(t,r,{down:function(){return this.set("tracking",true)},up:function(){return this.set("tracking",false)}});h.utils.Mouse=t;h.add({Attribute:q,Base:o,Utility:r,Widget:p,EventTarget:u,augment:function(a,c,e){if(j.isFunction(c))c=new c;var g=function(i,b){if((!a.prototype[i]||e)&&i!="constructor")a.prototype[i]=b};m.each(c,g);c.constructor!=Object&&m.each(c.prototype,g)},extend:n})});
